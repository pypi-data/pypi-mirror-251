import{_ as k}from"./change-password-dialog-9i9SZGmU.js";import{A as I,a as j,b as x,_,V as N}from"./VDataTableVirtual-oL2PAKTi.js";import{M as f,t as d,N as v,_ as y,Q as u,R as p,aE as b,L as a,b1 as A,aH as D,aI as L,m as B,aJ as n,P as l,O,aa as i}from"./admin-drawer-panel-JjJ1iA6R.js";import{D as z}from"./datetime-column-hS6FHx6v.js";import{b as V}from"./main-fEXxBNBg.js";import{V as c}from"./VTextField-1s8i2nK8.js";import{V as C}from"./VCheckbox-MGquS0QE.js";import{V as U}from"./VCheckboxBtn-yxvU5omH.js";import"./confirm-footer-IJHq21-K.js";import"./confirm-dialog-3RjVRgsv.js";import"./VSelect-Yw9YsgjJ.js";import"./VSelectionControl-9CzKd8rG.js";import"./VTable-q30xy1Qm.js";import"./filter-jwn1nJiw.js";const R=["username","isStaff","isActive","groups"];Object.freeze(R);const g={username:"",password:"",passwordConfirm:"",isStaff:!1,isActive:!0,groups:[]};Object.freeze(g);const J={name:"AdminUserCreateUpdateInputs",components:{AdminRelationPicker:I},props:{oldRow:{type:[Object,Boolean],default:!1}},emits:["change"],data(){return{rules:{username:[e=>!!e||"Username is required",e=>!!e&&!this.usernames.has(e.trim())||"Username already used"],password:[e=>!!e||"Password is required"],passwordConfirm:[e=>e===this.row.password||"Passwords must match"]},row:V.cloneDeep(this.oldRow||g)}},computed:{...f(d,{groups:e=>e.groups,users:e=>e.users}),usernames(){return this.nameSet(this.users,"username",this.oldRow,!0)}},watch:{row:{handler(e){this.$emit("change",e)},deep:!0},oldRow:{handler(e){this.row=V.cloneDeep(e)},deep:!0}},methods:{...v(d,["nameSet"])},UPDATE_KEYS:R,EMPTY_ROW:g},K={key:0};function M(e,o,h,S,s,T){const m=u("AdminRelationPicker");return p(),b("div",null,[a(c,{modelValue:s.row.username,"onUpdate:modelValue":o[0]||(o[0]=r=>s.row.username=r),autocomplete:"username",label:"Username",rules:s.rules.username,clearable:"",autofocus:"",onKeydown:o[1]||(o[1]=A(r=>e.$refs.password.focus(),["enter"]))},null,8,["modelValue","rules"]),h.oldRow?D("",!0):(p(),b("div",K,[a(c,{ref:"password",modelValue:s.row.password,"onUpdate:modelValue":o[2]||(o[2]=r=>s.row.password=r),autocomplete:"new-password",label:"Password",rules:s.rules.password,clearable:"",type:"password",onKeydown:o[3]||(o[3]=A(r=>e.$refs.passwordConfirm.focus(),["enter"]))},null,8,["modelValue","rules"]),a(c,{ref:"passwordConfirm",modelValue:s.row.passwordConfirm,"onUpdate:modelValue":o[4]||(o[4]=r=>s.row.passwordConfirm=r),autocomplete:"new-password",label:"Confirm Password",rules:s.rules.passwordConfirm,clearable:"",type:"password"},null,8,["modelValue","rules"])])),a(C,{modelValue:s.row.isStaff,"onUpdate:modelValue":o[5]||(o[5]=r=>s.row.isStaff=r),label:"Is Staff"},null,8,["modelValue"]),a(C,{modelValue:s.row.isActive,"onUpdate:modelValue":o[6]||(o[6]=r=>s.row.isActive=r),label:"Is Active"},null,8,["modelValue"]),a(m,{modelValue:s.row.groups,"onUpdate:modelValue":o[7]||(o[7]=r=>s.row.groups=r),label:"Groups",objs:e.groups,"title-key":"name","group-type":""},null,8,["modelValue","objs"])])}const Y=y(J,[["render",M]]),G={name:"AdminUsersTab",components:{AdminDeleteRowDialog:j,ChangePasswordDialog:k,AdminCreateUpdateDialog:x,DateTimeColumn:z,RelationChips:_},data(){return{AdminUserCreateUpdateInputs:L(Y),headers:[{title:"Username",key:"username",align:"start"},{title:"Staff",key:"isStaff"},{title:"Active",key:"isActive"},{title:"Groups",key:"groups"},{title:"Last Active",key:"lastActive"},{title:"Last Login",key:"lastLogin"},{title:"Joined",key:"dateJoined"},{title:"Actions",key:"actions",sortable:!1}]}},computed:{...f(d,{users:e=>e.users,groups:e=>e.groups}),...f(B,{me:e=>e.user})},mounted(){this.loadTables(["Group","User"])},methods:{...v(d,["loadTables"])}},q={class:"tabHeader"},H=n("td",{class:"adminNoData",colspan:"100%"},[i(" No Users. "),n("div",null,[i(" This is an error. There should always be at least one Staff user."),n("br"),i(" You should not be able to see this page"),n("br"),i(" You should restart Codex with the CODEX_RESET_ADMIN=1 variable set."),n("br"),i(" See the "),n("a",{href:"https://github.com/ajslater/codex#reset-the-admin-password",target:"_blank"}," README ")])],-1);function F(e,o,h,S,s,T){const m=u("AdminCreateUpdateDialog"),r=_,w=u("DateTimeColumn"),P=k,E=u("AdminDeleteRowDialog");return p(),b("div",null,[n("header",q,[a(m,{table:"User",inputs:s.AdminUserCreateUpdateInputs,"max-width":"20em"},null,8,["inputs"])]),a(N,{"fixed-header":"","item-value":"pk","item-title":"username",headers:s.headers,items:e.users,class:"adminTable"},{"no-data":l(()=>[H]),"item.isStaff":l(({item:t})=>[a(U,{"model-value":t.isStaff,disabled:""},null,8,["model-value"])]),"item.isActive":l(({item:t})=>[a(U,{"model-value":t.isActive,disabled:""},null,8,["model-value"])]),"item.groups":l(({item:t})=>[a(r,{pks:t.groups,objs:e.groups,"title-key":"name","group-type":""},null,8,["pks","objs"])]),"item.lastActive":l(({item:t})=>[a(w,{dttm:t.lastActive},null,8,["dttm"])]),"item.lastLogin":l(({item:t})=>[a(w,{dttm:t.lastLogin},null,8,["dttm"])]),"item.dateJoined":l(({item:t})=>[a(w,{dttm:t.dateJoined},null,8,["dttm"])]),"item.actions":l(({item:t})=>[a(m,{table:"User",inputs:s.AdminUserCreateUpdateInputs,"old-row":t,"max-width":"20em",size:"small",density:"compact"},null,8,["inputs","old-row"]),a(P,{user:t,"is-admin-mode":!0,size:"small",density:"compact"},null,8,["user"]),e.me.id!==t.pk?(p(),O(E,{key:0,table:"User",pk:t.pk,name:t.username,size:"small",density:"compact"},null,8,["pk","name"])):D("",!0)]),_:2},1032,["headers","items"])])}const me=y(G,[["render",F]]);export{me as default};
