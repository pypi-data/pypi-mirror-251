import{m as ye,u as pe,a as Ce,b as ke,c as we}from"./VSelect-Yw9YsgjJ.js";import{m as Ie,V as Q}from"./VTextField-1s8i2nK8.js";import{x as Se,ah as Fe,bh as De,G as Pe,bH as Ae,r as E,s as F,ax as X,h as V,cr as Re,aj as _e,cs as L,a as D,n as Y,V as Te,K as Me,L as o,al as K,am as N,aU as Ee,ag as Z,ct as Le,ad as ee,cu as Ne,ck as Ke,aa as Ue,cv as Oe,cw as Be,cx as je}from"./admin-drawer-panel-JjJ1iA6R.js";import{m as He,u as ze}from"./filter-jwn1nJiw.js";import{g as $e}from"./VSelectionControl-9CzKd8rG.js";import{f as qe}from"./confirm-footer-IJHq21-K.js";import{V as Ge}from"./VCheckboxBtn-yxvU5omH.js";function We(e,h,P){if(h==null)return e;if(Array.isArray(h))throw new Error("Multiple matches is not implemented");return typeof h=="number"&&~h?o(K,null,[o("span",{class:"v-combobox__unmask"},[e.substr(0,h)]),o("span",{class:"v-combobox__mask"},[e.substr(h,P)]),o("span",{class:"v-combobox__unmask"},[e.substr(h+P)])]):e}const Je=Se({autoSelectFirst:{type:[Boolean,String]},delimiters:Array,...He({filterKeys:["title"]}),...ye({hideNoData:!0,returnObject:!0}),...Fe(Ie({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...De({transition:!1})},"VCombobox"),tl=Pe()({name:"VCombobox",props:Je(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,h){var G;let{emit:P,slots:n}=h;const{t:U}=Ae(),y=E(),b=F(!1),p=F(!0),A=F(!1),z=E(),$=E(),O=X(e,"menu"),r=V({get:()=>O.value,set:l=>{var t;O.value&&!l&&((t=z.value)!=null&&t.Î¨openChildren)||(O.value=l)}}),i=F(-1);let B=!1;const le=V(()=>{var l;return(l=y.value)==null?void 0:l.color}),q=V(()=>r.value?e.closeText:e.openText),{items:ae,transformIn:te,transformOut:ne}=Re(e),{textColorClasses:ue,textColorStyles:oe}=_e(le),u=X(e,"modelValue",[],l=>te(je(l)),l=>{const t=ne(l);return e.multiple?t:t[0]??null}),I=$e(),S=F(e.multiple?"":((G=u.value[0])==null?void 0:G.title)??""),c=V({get:()=>S.value,set:l=>{var t;if(S.value=l??"",e.multiple||(u.value=[L(e,l)]),l&&e.multiple&&((t=e.delimiters)!=null&&t.length)){const s=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));s.length>1&&(s.forEach(d=>{d=d.trim(),d&&g(L(e,d))}),S.value="")}l||(i.value=-1),p.value=!l}}),ie=V(()=>typeof e.counterValue=="function"?e.counterValue(u.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?u.value.length:c.value.length);D(S,l=>{B?Y(()=>B=!1):b.value&&!r.value&&(r.value=!0),P("update:search",l)}),D(u,l=>{var t;e.multiple||(S.value=((t=l[0])==null?void 0:t.title)??"")});const{filteredItems:R,getMatches:se}=ze(e,ae,()=>p.value?"":c.value),m=V(()=>e.hideSelected?R.value.filter(l=>!u.value.some(t=>t.value===l.value)):R.value),re=V(()=>u.value.map(l=>l.value)),_=V(()=>{var t;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&c.value===((t=m.value[0])==null?void 0:t.title))&&m.value.length>0&&!p.value&&!A.value}),j=V(()=>e.hideNoData&&!m.value.length||e.readonly||(I==null?void 0:I.isReadonly.value)),H=E(),{onListScroll:ce,onListKeydown:ve}=pe(H,y);function de(l){B=!0,e.openOnClear&&(r.value=!0)}function fe(){j.value||(r.value=!0)}function me(l){j.value||(b.value&&(l.preventDefault(),l.stopPropagation()),r.value=!r.value)}function he(l){var d;if(Be(l)||e.readonly||I!=null&&I.isReadonly.value)return;const t=y.value.selectionStart,s=u.value.length;if((i.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(_.value&&["Enter","Tab"].includes(l.key)&&g(R.value[0]),p.value=!0),l.key==="ArrowDown"&&_.value&&((d=H.value)==null||d.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(i.value<0){l.key==="Backspace"&&!c.value&&(i.value=s-1);return}const a=i.value,v=u.value[i.value];v&&!v.props.disabled&&g(v,!1),i.value=a>=s-1?s-2:a}if(l.key==="ArrowLeft"){if(i.value<0&&t>0)return;const a=i.value>-1?i.value-1:s-1;u.value[a]?i.value=a:(i.value=-1,y.value.setSelectionRange(c.value.length,c.value.length))}if(l.key==="ArrowRight"){if(i.value<0)return;const a=i.value+1;u.value[a]?i.value=a:(i.value=-1,y.value.setSelectionRange(0,0))}l.key==="Enter"&&c.value&&(g(L(e,c.value)),c.value="")}}function be(){var l;b.value&&(p.value=!0,(l=y.value)==null||l.focus())}function g(l){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.multiple){const s=u.value.findIndex(a=>e.valueComparator(a.value,l.value)),d=t??!~s;if(~s){const a=d?[...u.value,l]:[...u.value];a.splice(s,1),u.value=a}else d&&(u.value=[...u.value,l]);c.value=""}else{const s=t!==!1;u.value=s?[l]:[],S.value=s?l.title:"",Y(()=>{r.value=!1,p.value=!0})}}function ge(l){b.value=!0,setTimeout(()=>{A.value=!0})}function xe(l){A.value=!1}function Ve(l){(l==null||l===""&&!e.multiple)&&(u.value=[])}return D(b,(l,t)=>{l||l===t||(i.value=-1,r.value=!1,_.value&&!A.value&&!u.value.some(s=>{let{value:d}=s;return d===m.value[0].value})?g(m.value[0]):e.multiple&&c.value&&g(L(e,c.value)))}),D(r,()=>{if(!e.hideSelected&&r.value&&u.value.length){const l=m.value.findIndex(t=>u.value.some(s=>e.valueComparator(s.value,t.value)));Te&&window.requestAnimationFrame(()=>{var t;l>=0&&((t=$.value)==null||t.scrollToIndex(l))})}}),D(m,(l,t)=>{b.value&&(!l.length&&e.hideNoData&&(r.value=!1),!t.length&&l.length&&(r.value=!0))}),Me(()=>{const l=!!(e.chips||n.chip),t=!!(!e.hideNoData||m.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),s=u.value.length>0,d=Q.filterProps(e);return o(Q,N({ref:y},d,{modelValue:c.value,"onUpdate:modelValue":[a=>c.value=a,Ve],focused:b.value,"onUpdate:focused":a=>b.value=a,validationValue:u.externalValue,counterValue:ie.value,dirty:s,class:["v-combobox",{"v-combobox--active-menu":r.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!n.selection,"v-combobox--selecting-index":i.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:e.readonly,placeholder:s?void 0:e.placeholder,"onClick:clear":de,"onMousedown:control":fe,onKeydown:he}),{...n,default:()=>o(K,null,[o(Ce,N({ref:z,modelValue:r.value,"onUpdate:modelValue":a=>r.value=a,activator:"parent",contentClass:"v-combobox__content",disabled:j.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:be},e.menuProps),{default:()=>[t&&o(Ee,{ref:H,selected:re.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),onKeydown:ve,onFocusin:ge,onFocusout:xe,onScrollPassive:ce,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},{default:()=>{var a,v,x;return[(a=n["prepend-item"])==null?void 0:a.call(n),!m.value.length&&!e.hideNoData&&(((v=n["no-data"])==null?void 0:v.call(n))??o(Z,{title:U(e.noDataText)},null)),o(ke,{ref:$,renderless:!0,items:m.value},{default:C=>{var J;let{item:f,index:k,itemRef:w}=C;const W=N(f.props,{ref:w,key:k,active:_.value&&k===0?!0:void 0,onClick:()=>g(f,null)});return((J=n.item)==null?void 0:J.call(n,{item:f,index:k,props:W}))??o(Z,W,{prepend:T=>{let{isSelected:M}=T;return o(K,null,[e.multiple&&!e.hideSelected?o(Ge,{key:f.value,modelValue:M,ripple:!1,tabindex:"-1"},null):void 0,f.props.prependAvatar&&o(Le,{image:f.props.prependAvatar},null),f.props.prependIcon&&o(ee,{icon:f.props.prependIcon},null)])},title:()=>{var T,M;return p.value?f.title:We(f.title,(T=se(f))==null?void 0:T.title,((M=c.value)==null?void 0:M.length)??0)}})}}),(x=n["append-item"])==null?void 0:x.call(n)]}})]}),u.value.map((a,v)=>{function x(w){w.stopPropagation(),w.preventDefault(),g(a,!1)}const C={"onClick:close":x,onMousedown(w){w.preventDefault(),w.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},f=l?!!n.chip:!!n.selection,k=f?Ne(l?n.chip({item:a,index:v,props:C}):n.selection({item:a,index:v})):void 0;if(!(f&&!k))return o("div",{key:a.value,class:["v-combobox__selection",v===i.value&&["v-combobox__selection--selected",ue.value]],style:v===i.value?oe.value:{}},[l?n.chip?o(Ke,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:a.title}}},{default:()=>[k]}):o(we,N({key:"chip",closable:e.closableChips,size:"small",text:a.title,disabled:a.props.disabled},C),null):k??o("span",{class:"v-combobox__selection-text"},[a.title,e.multiple&&v<u.value.length-1&&o("span",{class:"v-combobox__selection-comma"},[Ue(",")])])])})]),"append-inner":function(){var C;for(var a=arguments.length,v=new Array(a),x=0;x<a;x++)v[x]=arguments[x];return o(K,null,[(C=n["append-inner"])==null?void 0:C.call(n,...v),(!e.hideNoData||e.items.length)&&e.menuIcon?o(ee,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:me,onClick:Oe,"aria-label":U(q.value),title:U(q.value)},null):void 0])}})}),qe({isFocused:b,isPristine:p,menu:r,search:c,selectionIndex:i,filteredItems:R,select:g},y)}});export{tl as V};
