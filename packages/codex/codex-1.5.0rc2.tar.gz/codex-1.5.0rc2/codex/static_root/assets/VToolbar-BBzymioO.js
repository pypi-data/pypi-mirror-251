import{x as J,bZ as we,E as re,bN as ke,bM as Se,aq as ie,F as ye,G as Q,I as Pe,az as se,aA as K,b_ as Ce,bQ as Ve,bT as Re,s as F,y as St,h as _,K as ee,L as r,z as j,b5 as We,b$ as yt,M as H,k as ae,aD as le,m as M,N as ue,_ as N,R as p,O as S,P as h,aJ as A,ae as P,aE as Y,aH as $,c0 as Ge,c1 as Pt,c2 as Ct,aa as C,ad as U,bn as Vt,bk as Rt,at as Tt,Q as Z,am as z,ak as je,c3 as xt,ax as be,c4 as Dt,r as Ye,C as Bt,c5 as It,al as Te,bR as Et,c6 as Lt,bU as At,c7 as $t,af as qe,b7 as Mt,b8 as Nt,ag as Xe,b1 as de,c8 as Ke,c9 as Ot,aI as Ze,br as Je,aG as xe,aZ as pe,ca as te,bV as Qe,H as De,cb as et,l as Ut,cc as Ft,cd as Ht,B as tt,a as X,o as ot,ce as zt,J as nt,cf as Wt,bK as Gt,cg as jt,ch as me,ci as Yt,aB as st,cj as qt,n as Xt,a9 as Kt,bo as Zt,bW as Jt,ck as ge}from"./admin-drawer-panel-JjJ1iA6R.js";import{c as at,d as rt,_ as it,C as $e,r as he,u as Qt,A as Me,m as eo,a as to}from"./main-fEXxBNBg.js";import{c as oo}from"./index-RrPhDVxT.js";import{V as lt,a as no}from"./confirm-footer-IJHq21-K.js";import{_ as ut}from"./change-password-dialog-9i9SZGmU.js";import{_ as ct,V as fe,a as so}from"./VTextField-1s8i2nK8.js";import{a as ao,c as ro,u as io,V as Ne,d as Oe}from"./VSelectionControl-9CzKd8rG.js";const lo=J({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...we(),...re(),...ke(),...at(),...Se(),...ie({tag:"footer"}),...ye()},"VFooter"),dt=Q()({name:"VFooter",props:lo(),setup(e,t){let{slots:o}=t;const{themeClasses:a}=Pe(e),{backgroundColorClasses:n,backgroundColorStyles:s}=se(K(e,"color")),{borderClasses:i}=Ce(e),{elevationClasses:l}=Ve(e),{roundedClasses:w}=Re(e),v=F(32),{resizeRef:u}=St(b=>{b.length&&(v.value=b[0].target.clientHeight)}),g=_(()=>e.height==="auto"?v.value:parseInt(e.height,10)),{layoutItemStyles:m}=rt({id:e.name,order:_(()=>parseInt(e.order,10)),position:_(()=>"bottom"),layoutSize:g,elementSize:_(()=>e.height==="auto"?void 0:g.value),active:_(()=>e.app),absolute:K(e,"absolute")});return ee(()=>r(e.tag,{ref:u,class:["v-footer",a.value,n.value,i.value,l.value,w.value,e.class],style:[s.value,e.app?m.value:{height:j(e.height)},e.style]},o)),{}}}),uo={name:"VersionFooter",data(){return{mdiOpenInNew:We,mdiContentCopy:yt}},computed:{...H(ae,{versions:e=>e.versions}),...le(M,["isUserAdmin"]),outdated:function(){return this.isUserAdmin&&this.semverGreaterThan(this.versions.latest>this.versions.installed)},versionTitle:function(){return this.outdated?`v${this.versions.latest} is available`:"up to date"}},created(){this.loadVersions()},methods:{...ue(ae,["loadVersions"]),semverGreaterThan(e,t){try{if(!e||!t)return!1;const o=e.split("."),a=t.split(".");for(const[n,s]of o.entries())if(+s>+a[n])return!0}catch(o){console.debug("compare codex versions",e,">",t,o)}return!1}}},co={id:"version"},mo={key:0,id:"latest"};function go(e,t,o,a,n,s){return p(),S(dt,{id:"version-footer",title:s.versionTitle},{default:h(()=>[A("div",co,"codex v"+P(e.versions.installed),1),s.outdated?(p(),Y("div",mo," codex v"+P(e.versions.latest)+" is available ",1)):$("",!0)]),_:1},8,["title"])}const mt=N(uo,[["render",go],["__scopeId","data-v-cd481730"]]),ho={name:"OPDSUrl",props:{title:{type:String,required:!0},subtitle:{type:String,default:void 0},url:{type:String,required:!0}},data(){return{mdiRss:Ge,showTooltip:{show:!1}}},computed:{clipBoardEnabled(){return location.protocol=="https:"},clipBoardIcon(){return this.showTooltip.show?Pt:Ct},tooltip(){return this.clipBoardEnabled}},methods:{onClickURL(){this.clipBoardEnabled&&oo(this.url,this.showTooltip)}}},fo=["title"],vo={key:0},bo={class:"copied"},po={key:0,class:"subtitle"},_o={class:"opdsUrl"};function wo(e,t,o,a,n,s){return p(),Y("div",{class:"opdsVersion",title:s.tooltip,onClick:t[0]||(t[0]=(...i)=>s.onClickURL&&s.onClickURL(...i))},[A("h3",null,[C(P(o.title)+" ",1),s.clipBoardEnabled?(p(),Y("span",vo,[r(U,{class:"clipBoardIcon",size:"small"},{default:h(()=>[C(P(s.clipBoardIcon),1)]),_:1}),r(Tt,null,{default:h(()=>[Rt(A("span",bo,"Copied",512),[[Vt,n.showTooltip.show]])]),_:1})])):$("",!0)]),o.subtitle?(p(),Y("div",po,P(o.subtitle),1)):$("",!0),A("div",_o,P(o.url),1)],8,fo)}const ko=N(ho,[["render",wo],["__scopeId","data-v-7c7d7ea4"]]),So={name:"OPDSDialog",components:{OPDSUrl:ko},data(){return{mdiRss:Ge,opdsV1URL:window.origin+window.CODEX.OPDS_V1_PATH,opdsV2URL:window.origin+window.CODEX.OPDS_V2_PATH}}},yo={id:"opds"};function Po(e,t,o,a,n,s){const i=Z("OPDSUrl");return p(),S(lt,{"max-width":"30em"},{activator:h(({props:l})=>[r(je,z({id:"opdsButton",icon:"",size:"small",variant:"plain"},l),{default:h(()=>[r(U,null,{default:h(()=>[C(P(n.mdiRss),1)]),_:1}),C(" OPDS ")]),_:2},1040)]),default:h(()=>[A("div",yo,[A("h2",null,[r(U,{size:"x=small",class:"inline"},{default:h(()=>[C(P(n.mdiRss),1)]),_:1}),C(" OPDS ")]),r(i,{title:"v1.2",url:n.opdsV1URL},null,8,["url"]),r(i,{title:"v2.0",url:n.opdsV2URL,subtitle:"OPDS v2 is experimental and not widely or well supported by clients"},null,8,["url"])])]),_:1})}const Co=N(So,[["render",Po],["__scopeId","data-v-b21152f5"]]),Vo={name:"SettingsFooter",components:{OPDSDialog:Co},data(){return{mdiOpenInNew:We,mdiSourceRepository:xt}},computed:{...le(M,["isCodexViewable"])}},Ro={id:"repo",href:"https://github.com/ajslater/codex",title:"Codex Source Repository",target:"_blank"};function To(e,t,o,a,n,s){const i=Z("OPDSDialog");return p(),S(dt,{id:"settingsFooter"},{default:h(()=>[e.isCodexViewable?(p(),S(i,{key:0})):$("",!0),A("a",Ro,[r(U,{id:"repoIcon",size:"x-small"},{default:h(()=>[C(P(n.mdiSourceRepository),1)]),_:1}),C(" repository"),r(U,{color:e.$vuetify.theme.current.colors.iconsInactive,size:"x-small"},{default:h(()=>[C(P(n.mdiOpenInNew),1)]),_:1},8,["color"])])]),_:1})}const gt=N(Vo,[["render",To],["__scopeId","data-v-f9eb593e"]]),xo=J({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...ao(),...ro()},"VSwitch"),Do=Q()({name:"VSwitch",inheritAttrs:!1,props:xo(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,t){let{attrs:o,slots:a}=t;const n=be(e,"indeterminate"),s=be(e,"modelValue"),{loaderClasses:i}=Dt(e),{isFocused:l,focus:w,blur:v}=io(e),u=Ye(),g=_(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),m=Bt(),b=_(()=>e.id||`switch-${m}`);function V(){n.value&&(n.value=!1)}function y(B){var T,x;B.stopPropagation(),B.preventDefault(),(x=(T=u.value)==null?void 0:T.input)==null||x.click()}return ee(()=>{const[B,T]=It(o),x=Ne.filterProps(e),D=Oe.filterProps(e);return r(Ne,z({class:["v-switch",{"v-switch--inset":e.inset},{"v-switch--indeterminate":n.value},i.value,e.class]},B,x,{modelValue:s.value,"onUpdate:modelValue":I=>s.value=I,id:b.value,focused:l.value,style:e.style}),{...a,default:I=>{let{id:d,messagesId:c,isDisabled:f,isReadonly:k,isValid:E}=I;return r(Oe,z({ref:u},D,{modelValue:s.value,"onUpdate:modelValue":[R=>s.value=R,V],id:d.value,"aria-describedby":c.value,type:"checkbox","aria-checked":n.value?"mixed":void 0,disabled:f.value,readonly:k.value,onFocus:w,onBlur:v},T),{...a,default:R=>{let{backgroundColorClasses:W,backgroundColorStyles:O}=R;return r("div",{class:["v-switch__track",...W.value],style:O.value,onClick:y},null)},input:R=>{let{inputNode:W,icon:O,backgroundColorClasses:ce,backgroundColorStyles:oe}=R;return r(Te,null,[W,r("div",{class:["v-switch__thumb",{"v-switch__thumb--filled":O||e.loading},e.inset?void 0:ce.value],style:e.inset?void 0:oe.value},[r(Et,null,{default:()=>[e.loading?r(Lt,{name:"v-switch",active:!0,color:E.value===!1?void 0:g.value},{default:q=>a.loader?a.loader(q):r(At,{active:q.isActive,color:q.color,indeterminate:!0,size:"16",width:"2"},null)}):O&&r(U,{key:O,icon:O,size:"x-small"},null)]})])])}})}})}),{}}}),Bo={name:"AuthLoginDialog",components:{SubmitFooter:ct},data(){return{rules:{username:[e=>!!e||"Username is required"],password:[e=>e?this.registerMode&&e.length<this.MIN_PASSWORD_LEN?`Password must be ${this.MIN_PASSWORD_LEN} characters long`:!0:"Password is required"],passwordConfirm:[e=>e===this.credentials.password||"Passwords must match"]},formModel:{},credentials:{username:"",password:"",passwordConfirm:""},submitButtonEnabled:!1,showDialog:!1,registerMode:!1,mdiLogin:$t}},computed:{...H(ae,{formErrors:e=>e.form.errors,formSuccess:e=>e.form.success}),...H(M,{adminFlags:e=>e.adminFlags,MIN_PASSWORD_LEN:e=>e.MIN_PASSWORD_LEN}),submitButtonLabel:function(){return this.registerMode?"Register":"Login"}},watch:{showDialog(e){e&&(this.loadAdminFlags(),this.$refs.form&&this.$refs.form.reset())},credentials:{handler(){const e=this.$refs.form;e?e.validate().then(({valid:t})=>this.submitButtonEnabled=t).catch(console.error):this.submitButtonEnabled=!1},deep:!0}},mounted(){window.addEventListener("keyup",this._keyListener)},beforeUnmount(){window.removeEventListener("keyup",this._keyListener)},methods:{...ue(M,["loadAdminFlags","login","register"]),doAuth(e){return this[e](this.credentials).then(()=>this.showDialog=this.formErrors&&this.formErrors.length>0).catch(console.error)},submit(){this.$refs.form.validate().then(({valid:t})=>{if(!t)return;const o=this.registerMode?"register":"login";return this.doAuth(o)}).catch(console.error)},_keyListener(e){e.stopImmediatePropagation()}}};function Io(e,t,o,a,n,s){const i=ct;return p(),S(lt,{modelValue:n.showDialog,"onUpdate:modelValue":t[7]||(t[7]=l=>n.showDialog=l),origin:"center-top",transition:"slide-y-transition","max-width":"20em"},{activator:h(({props:l})=>[r(Xe,Mt(Nt(l)),{default:h(()=>[r(qe,null,{default:h(()=>[r(U,null,{default:h(()=>[C(P(n.mdiLogin),1)]),_:1}),C(" Login ")]),_:1})]),_:2},1040)]),default:h(()=>[r(so,{id:"authDialog",ref:"form"},{default:h(()=>[r(fe,{modelValue:n.credentials.username,"onUpdate:modelValue":t[0]||(t[0]=l=>n.credentials.username=l),autocomplete:"username",label:"Username",rules:n.rules.username,clearable:"",autofocus:"",onKeydown:t[1]||(t[1]=de(l=>e.$refs.password.focus(),["enter"]))},null,8,["modelValue","rules"]),r(fe,{ref:"password",modelValue:n.credentials.password,"onUpdate:modelValue":t[2]||(t[2]=l=>n.credentials.password=l),autocomplete:n.registerMode?"new-password":"current-password",label:"Password",rules:n.rules.password,clearable:"",type:"password",onKeydown:t[3]||(t[3]=de(l=>{n.registerMode?e.$refs.passwordConfirm.focus():s.submit()},["enter"]))},null,8,["modelValue","autocomplete","rules"]),r(Ke,null,{default:h(()=>[n.registerMode?(p(),S(fe,{key:0,ref:"passwordConfirm",modelValue:n.credentials.passwordConfirm,"onUpdate:modelValue":t[4]||(t[4]=l=>n.credentials.passwordConfirm=l),autocomplete:"new-password",label:"Confirm Password",rules:n.rules.passwordConfirm,clearable:"",type:"password",onKeydown:de(s.submit,["enter"])},null,8,["modelValue","rules","onKeydown"])):$("",!0)]),_:1}),e.adminFlags.registration?(p(),S(Do,{key:0,modelValue:n.registerMode,"onUpdate:modelValue":t[5]||(t[5]=l=>n.registerMode=l),label:"Register"},{default:h(()=>[C(" Register ")]),_:1},8,["modelValue"])):$("",!0),r(i,{verb:n.registerMode?"Register":"Login",table:"",disabled:!n.submitButtonEnabled,onSubmit:s.submit,onCancel:t[6]||(t[6]=l=>n.showDialog=!1)},null,8,["verb","disabled","onSubmit"])]),_:1},512)]),_:1},8,["modelValue"])}const Eo=N(Bo,[["render",Io],["__scopeId","data-v-ef06f84f"]]),Lo={name:"AuthLogoutItem",data:function(){return{mdiLogout:Ot}},computed:{...H(M,{username:e=>e.user.username})},methods:{...ue(M,["logout"])}};function Ao(e,t,o,a,n,s){return p(),S(Xe,{onClick:e.logout},{default:h(()=>[r(qe,null,{default:h(()=>[r(U,null,{default:h(()=>[C(P(e.mdiLogout),1)]),_:1}),C("Logout "+P(e.username),1)]),_:1})]),_:1},8,["onClick"])}const $o=N(Lo,[["render",Ao]]),Mo={name:"AuthMenu",components:{ChangePasswordDialog:ut,AuthLoginDialog:Eo,AuthLogoutItem:$o},computed:{...H(M,{user:e=>e.user})},methods:{...ue(M,["logout"])}};function No(e,t,o,a,n,s){const i=Z("AuthLogoutItem"),l=ut,w=Z("AuthLoginDialog");return p(),Y(Te,null,[e.user?(p(),S(i,{key:0})):$("",!0),e.user?(p(),S(l,{key:1,user:e.user},null,8,["user"])):(p(),S(w,{key:2}))],64)}const ht=N(Mo,[["render",No]]),Ue=Ze(Je(()=>it(()=>import("./admin-drawer-panel-JjJ1iA6R.js").then(e=>e.dt),__vite__mapDeps([0,1])))),Oo={name:"SettingsCommonPanel",components:{AuthMenu:ht,AdminMenu:Ue},props:{adminMenu:{type:Boolean,default:!0}},data(){return{AdminMenu:Ue}},computed:{...le(M,["isUserAdmin"])}},Uo={id:"commonPanel"};function Fo(e,t,o,a,n,s){const i=ht;return p(),Y("div",Uo,[r(i),e.isUserAdmin?(p(),S(pe,{key:0})):$("",!0),e.isUserAdmin?(p(),S(xe(n.AdminMenu),{key:1,menu:o.adminMenu},null,8,["menu"])):$("",!0)])}const Ho=N(Oo,[["render",Fo],["__scopeId","data-v-a21632a4"]]),zo=e=>{const t=e.pk,o=te();return e={...e,...o},delete e.pk,De.get(`c/${t}`,{params:e})},Wo=()=>{const e=te();return De.get("c/settings",{params:e})},Go=e=>De.put("c/settings",e),Tn=e=>{const t=et(e),o=te().ts;return`${t}/download/comic-${e}.cbz?ts=${o}`},xn=({pk:e,page:t})=>{const o=et(e),a=te().ts;return`${o}/${t}/page.jpg?ts=${a}`},jo=({pk:e,page:t})=>{const o=Qe(e),a=te().ts;return`${o}/${t}/page.jpg?ts=${a}`},ve={getReaderBasePath:Qe,getReaderInfo:zo,getReaderSettings:Wo,setReaderSettings:Go},Yo=function(e){let t;return e?t=e.length===4&&!Number.isNaN(e)?" ("+e+")":" v"+e:t="",t},qo=function({issueNumber:e,issueSuffix:t},o){let a;try{e==null&&!t&&(e=0);const n=Number.parseFloat(e),s=Math.floor(n);o===void 0&&(o=0),n===s?a=s.toString():(a=n.toString(),o+=a.split(".")[1].length+1),a=a.padStart(o,"0")}catch{a=""}return t&&(a+=t),a},Xo=function({issueNumber:e,issueSuffix:t,issueCount:o},a){let n="#"+qo({issueNumber:e,issueSuffix:t},a);return o&&(n+=` of ${o}`),n},Ko=function({seriesName:e,volumeName:t,issueNumber:o,issueSuffix:a,issueCount:n},s){const i=Yo(t),l=Xo({issueNumber:o,issueSuffix:a,issueCount:n},s);return[e,i,l].filter(Boolean).join(" ")},ft={fitTo:"",twoPages:null,readingDirection:"",readRtlInReverse:null};Object.freeze(ft);const ne=new Set(["",null,void 0]);Object.freeze(ne);const vt={prev:"next",next:"prev"};Object.freeze(vt);const bt={rel:"prefetch",as:"image"};Object.freeze(bt);const _e=new Set(["ttb","btt"]);Object.freeze(_e);const pt=new Set(["rtl","btt"]);Object.freeze(pt);const Zo=()=>Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)>600?"HEIGHT":"WIDTH",Jo=Ut("reader",{state:()=>({choices:{fitTo:$e.reader.fitTo,readingDirection:$e.reader.readingDirection,nullValues:ne},readerSettings:{fitTo:Zo(),twoPages:!1,readingDirection:"ltr",readRtlInReverse:!1},books:{current:void 0,prev:!1,next:!1},arcs:[],arc:{},page:void 0,routes:{prev:!1,next:!1,books:{prev:!1,next:!1}},bookChange:void 0,reactWithScroll:!1}),getters:{groupBooks(e){const t=[];return e.books.prev[0]&&t.push[e.books.prev[0]],t.push[e.books.current],e.books.next[0]&&t.push[e.books.next[0]],t},activeSettings(e){return e.getSettings(e.books.current)||{}},activeTitle(e){var a;const t=e.books.current;let o;return((a=e.arcs[0])==null?void 0:a.group)==="f"&&(o=t==null?void 0:t.filename),o||(o=t?Ko(t):""),o},isOnCoverPage(e){return this._isCoverPage(e.books.current,e.page)},routeParams(e){return{pk:+e.books.current.pk,page:+e.page}},isVertical(e){return _e.has(e.activeSettings.readingDirection)},isReadInReverse(e){return pt.has(e.activeSettings.readingDirection)},isBTT(e){return e.activeSettings.readingDirection==="btt"},isFirstPage(e){return e.page===0},isLastPage(e){const t=e.books.current?e.books.current.maxPage:0,o=e.activeSettings.twoPages?1:0,a=t-o;return this.page>=a}},actions:{setReadRTLInReverse(e){return this.readerSettings.readRtlInReverse&&e.readingDirection==="rtl"?{...e,readingDirection:"ltr"}:e},getSettings(e){const t={...ne};let o=e?e.settings:{};o=this.setReadRTLInReverse(o);const a=[this.readerSettings,o];for(const n of a)for(const[s,i]of Object.entries(n))ne.has(i)||(t[s]=i);return t.twoPages=_e.has(t.readingDirection)&&t.twoPages,t},bookChangeLocation(e){let t;return this.isBTT?t=e==="next"?"left":"right":t=e==="next"?"right":"left",t},bookChangeCursorClass(e){let t;return this.isReadInReverse?t=e==="next"?"up":"down":t=e==="next"?"down":"up",t+"Cursor"},bookChangeShow(e){return e==="prev"?this.books.prev&&this.isFirstPage:this.books.next&&this.isLastPage},bookChangeIcon(e){let t=e==="next";return this.isBTT&&(t=!t),t?Ft:Ht},_isCoverPage(e,t){return e.readLtr!==!1&&t===0||e.readLtr&&t===e.maxPage},_getRouteParams(e,t,o){const a=o==="prev"?-1:1;let n=1;this.getSettings(e).twoPages&&!this._isCoverPage(e,+t+a)&&(n=2),n=n*a;const i=+t+n;let l=!1;return i>=0&&i<=e.maxPage&&(l={pk:e.pk,page:i}),l},_updateSettings(e,t){t?this.books.current.settings={...this.books.current.settings,...e}:this.readerSettings={...this.readerSettings,...e}},_getBookRoutePage(e,t){let o=0;if(t&&e.readLtr!==!1||!t&&e.readLtr===!1){const n=this.getSettings(e).twoPages?-1:0;o=e.maxPage+n}return o},_getBookRoute(e,t){if(!e)return!1;const o=this._getBookRoutePage(e,t);return{pk:e.pk,page:o}},_getBookRoutes(e,t){return{prev:this._getBookRoute(e,!0),next:this._getBookRoute(t,!1)}},async setRoutesAndBookmarkPage(e){const t=this.books.current;this.$patch(o=>{o.routes.prev=this._getRouteParams(t,e,"prev"),o.routes.next=this._getRouteParams(t,e,"next")}),await this._setBookmarkPage(e).then(()=>(this.bookChange=void 0,!0))},setActivePage(e,t=!0){if(e<0)return console.warn("Page out of bounds. Redirecting to 0."),this.routeToPage(0);if(e>this.books.current.maxPage)return console.warn(`Page out of bounds. Redirecting to ${this.books.current.maxPage}.`),this.routeToPage(this.books.current.maxPage);if(this.reactWithScroll=!!t,this.page=+e,this.setRoutesAndBookmarkPage(e),this.isVertical){const o={params:{pk:this.books.current.pk,page:e}},{href:a}=he.resolve(o);window.history.pushState({},void 0,a)}else window.scrollTo(0,0)},async loadReaderSettings(){return ve.getReaderSettings().then(e=>{const t=e.data;return this._updateSettings(t,!1),!0}).catch(console.error)},async loadBooks(e){await ve.getReaderInfo(e).then(t=>{const o=t.data,a=[o.books.prevBook,o.books.current,o.books.nextBook];for(const s of a)s&&!s.settings&&(s.settings={});const n=this._getBookRoutes(o.books.prevBook,o.books.nextBook);return this.$patch(s=>{s.books.current=o.books.current,s.books.prev=o.books.prevBook,s.books.next=o.books.nextBook,s.arcs=o.arcs,s.arc=o.arc,s.routes.prev=this._getRouteParams(s.books.current,e.page,"prev"),s.routes.next=this._getRouteParams(s.books.current,e.page,"next"),s.routes.books=n}),!0}).catch(t=>{console.debug(t);const o=Qt().page,a=o&&o.routes?o.routes.last:{name:"home"};return he.push(a)})},async _setBookmarkPage(e){const t={group:"c",pk:this.books.current.pk};e=Math.max(Math.min(this.books.current.maxPage,e),0);const o={page:e};await Me.setGroupBookmarks(t,o)},async setSettingsLocal(e){this._updateSettings(e,!0),await Me.setGroupBookmarks({group:"c",pk:+this.books.current.pk},this.books.current.settings)},async clearSettingsLocal(){await this.setSettingsLocal(ft)},async setSettingsGlobal(e){this._updateSettings(e,!1),await ve.setReaderSettings(this.readerSettings),await this.clearSettingsLocal()},setBookChangeFlag(e){e=this.normalizeDirection(e),this.bookChange=this.routes.books[e]?e:void 0},normalizeDirection(e){return this.isReadInReverse?vt[e]:e},_validateRoute(e,t){if(t||(t=this.books.current),!t)return{};const o=t.maxPage??0;return e.page>o?(e.page=o,console.warn("Tried to navigate past the end of the book.")):e.page<0&&(e.page=0,console.warn("Tried to navigate before the beginning of the book.")),e},_routeTo(e,t){if(e=this._validateRoute(e,t),this.isVertical&&+e.pk===this.books.current.pk)this.setActivePage(+e.page,!0);else{const o={name:"reader",params:e};he.push(o).catch(console.debug)}},routeToDirectionOne(e){e=this.normalizeDirection(e);const t=e==="prev"?-1:1,o=this.page+=t;if(o<0||o>this.books.current.maxPage)return;const a={pk:this.books.current.pk,page:o};this._routeTo(a)},routeToDirection(e){if(e=this.normalizeDirection(e),this.routes[e]){const t=this.routes[e];this._routeTo(t)}else this.routes.books[e]?this.bookChange===e?this._routeTo(this.routes.books[e],this.books[e]):this.setBookChangeFlag(e):console.debug("No route to direction",e)},routeToPage(e){const t={pk:this.books.current.pk,page:e};this._routeTo(t)},routeToBook(e){this._routeTo(this.routes.books[e],this.books[e])},_prefetchSrc(e,t,o=!1,a=!1){if(!e)return!1;const n=o?this.books[t]:this.books.current;if(!n)return!1;let s=e.page;if(a){if(!this.getSettings(n).twoPages)return!1;s+=1}if(s>n.maxPage)return!1;const i={pk:e.pk,page:s};return jo(i)},prefetchLinks(e,t,o=!1){const a=[this._prefetchSrc(e,t,o,!1),this._prefetchSrc(e,t,o,!0)],n=[];for(const s of a)s&&n.push({...bt,href:s});return{link:n}},toRoute(e){return e?{params:e}:{}},linkLabel(e,t){return`${e==="prev"?"Previous":"Next"} ${t}`}}});function Qo(e){let{rootEl:t,isSticky:o,layoutItemStyles:a}=e;const n=F(!1),s=F(0),i=_(()=>{const v=typeof n.value=="boolean"?"top":n.value;return[o.value?{top:"auto",bottom:"auto",height:void 0}:void 0,n.value?{[v]:j(s.value)}:{top:a.value.top}]});tt(()=>{X(o,v=>{v?window.addEventListener("scroll",w,{passive:!0}):window.removeEventListener("scroll",w)},{immediate:!0})}),ot(()=>{window.removeEventListener("scroll",w)});let l=0;function w(){const v=l>window.scrollY?"up":"down",u=t.value.getBoundingClientRect(),g=parseFloat(a.value.top??0),m=window.scrollY-Math.max(0,s.value-g),b=u.height+Math.max(s.value,g)-window.scrollY-window.innerHeight,V=parseFloat(getComputedStyle(t.value).getPropertyValue("--v-body-scroll-y"))||0;u.height<window.innerHeight-g?(n.value="top",s.value=g):v==="up"&&n.value==="bottom"||v==="down"&&n.value==="top"?(s.value=window.scrollY+u.top-V,n.value=!0):v==="down"&&b<=0?(s.value=0,n.value="bottom"):v==="up"&&m<=0&&(V?n.value!=="top"&&(s.value=-m+V+g,n.value="top"):(s.value=u.top+m,n.value="top")),l=window.scrollY}return{isStuck:n,stickyStyles:i}}const en=100,tn=20;function Fe(e){return(e<0?-1:1)*Math.sqrt(Math.abs(e))*1.41421356237}function He(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let t=0;for(let o=e.length-1;o>0;o--){if(e[o].t===e[o-1].t)continue;const a=Fe(t),n=(e[o].d-e[o-1].d)/(e[o].t-e[o-1].t);t+=(n-a)*Math.abs(n),o===e.length-1&&(t*=.5)}return Fe(t)*1e3}function on(){const e={};function t(n){Array.from(n.changedTouches).forEach(s=>{(e[s.identifier]??(e[s.identifier]=new zt(tn))).push([n.timeStamp,s])})}function o(n){Array.from(n.changedTouches).forEach(s=>{delete e[s.identifier]})}function a(n){var v;const s=(v=e[n])==null?void 0:v.values().reverse();if(!s)throw new Error(`No samples for touch id ${n}`);const i=s[0],l=[],w=[];for(const u of s){if(i[0]-u[0]>en)break;l.push({t:u[0],d:u[1].clientX}),w.push({t:u[0],d:u[1].clientY})}return{x:He(l),y:He(w),get direction(){const{x:u,y:g}=this,[m,b]=[Math.abs(u),Math.abs(g)];return m>b&&u>=0?"right":m>b&&u<=0?"left":b>m&&g>=0?"down":b>m&&g<=0?"up":nn()}}}return{addMovement:t,endTouch:o,getVelocity:a}}function nn(){throw new Error}function sn(e){let{isActive:t,isTemporary:o,width:a,touchless:n,position:s}=e;tt(()=>{window.addEventListener("touchstart",T,{passive:!0}),window.addEventListener("touchmove",x,{passive:!1}),window.addEventListener("touchend",D,{passive:!0})}),ot(()=>{window.removeEventListener("touchstart",T),window.removeEventListener("touchmove",x),window.removeEventListener("touchend",D)});const i=_(()=>["left","right"].includes(s.value)),{addMovement:l,endTouch:w,getVelocity:v}=on();let u=!1;const g=F(!1),m=F(0),b=F(0);let V;function y(d,c){return(s.value==="left"?d:s.value==="right"?document.documentElement.clientWidth-d:s.value==="top"?d:s.value==="bottom"?document.documentElement.clientHeight-d:G())-(c?a.value:0)}function B(d){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const f=s.value==="left"?(d-b.value)/a.value:s.value==="right"?(document.documentElement.clientWidth-d-b.value)/a.value:s.value==="top"?(d-b.value)/a.value:s.value==="bottom"?(document.documentElement.clientHeight-d-b.value)/a.value:G();return c?Math.max(0,Math.min(1,f)):f}function T(d){if(n.value)return;const c=d.changedTouches[0].clientX,f=d.changedTouches[0].clientY,k=25,E=s.value==="left"?c<k:s.value==="right"?c>document.documentElement.clientWidth-k:s.value==="top"?f<k:s.value==="bottom"?f>document.documentElement.clientHeight-k:G(),R=t.value&&(s.value==="left"?c<a.value:s.value==="right"?c>document.documentElement.clientWidth-a.value:s.value==="top"?f<a.value:s.value==="bottom"?f>document.documentElement.clientHeight-a.value:G());(E||R||t.value&&o.value)&&(u=!0,V=[c,f],b.value=y(i.value?c:f,t.value),m.value=B(i.value?c:f),w(d),l(d))}function x(d){const c=d.changedTouches[0].clientX,f=d.changedTouches[0].clientY;if(u){if(!d.cancelable){u=!1;return}const E=Math.abs(c-V[0]),R=Math.abs(f-V[1]);(i.value?E>R&&E>3:R>E&&R>3)?(g.value=!0,u=!1):(i.value?R:E)>3&&(u=!1)}if(!g.value)return;d.preventDefault(),l(d);const k=B(i.value?c:f,!1);m.value=Math.max(0,Math.min(1,k)),k>1?b.value=y(i.value?c:f,!0):k<0&&(b.value=y(i.value?c:f,!1))}function D(d){if(u=!1,!g.value)return;l(d),g.value=!1;const c=v(d.changedTouches[0].identifier),f=Math.abs(c.x),k=Math.abs(c.y);(i.value?f>k&&f>400:k>f&&k>3)?t.value=c.direction===({left:"right",right:"left",top:"down",bottom:"up"}[s.value]||G()):t.value=m.value>.5}const I=_(()=>g.value?{transform:s.value==="left"?`translateX(calc(-100% + ${m.value*a.value}px))`:s.value==="right"?`translateX(calc(100% - ${m.value*a.value}px))`:s.value==="top"?`translateY(calc(-100% + ${m.value*a.value}px))`:s.value==="bottom"?`translateY(calc(100% - ${m.value*a.value}px))`:G(),transition:"none"}:void 0);return{isDragging:g,dragProgress:m,dragStyles:I}}function G(){throw new Error}const an=["start","end","left","right","top","bottom"],rn=J({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:e=>an.includes(e)},sticky:Boolean,...we(),...re(),...eo(),...ke(),...at(),...Se(),...ie({tag:"nav"}),...ye()},"VNavigationDrawer"),ln=Q()({name:"VNavigationDrawer",props:rn(),emits:{"update:modelValue":e=>!0,"update:rail":e=>!0},setup(e,t){let{attrs:o,emit:a,slots:n}=t;const{isRtl:s}=nt(),{themeClasses:i}=Pe(e),{borderClasses:l}=Ce(e),{backgroundColorClasses:w,backgroundColorStyles:v}=se(K(e,"color")),{elevationClasses:u}=Ve(e),{displayClasses:g,mobile:m}=to(e),{roundedClasses:b}=Re(e),V=Wt(),y=be(e,"modelValue",null,L=>!!L),{ssrBootStyles:B}=Gt(),{scopeId:T}=no(),x=Ye(),D=F(!1),I=_(()=>e.rail&&e.expandOnHover&&D.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),d=_(()=>jt(e.location,s.value)),c=_(()=>!e.permanent&&(m.value||e.temporary)),f=_(()=>e.sticky&&!c.value&&d.value!=="bottom");me(()=>e.expandOnHover&&e.rail!=null,()=>{X(D,L=>a("update:rail",!L))}),me(()=>!e.disableResizeWatcher,()=>{X(c,L=>!e.permanent&&Xt(()=>y.value=!L))}),me(()=>!e.disableRouteWatcher&&!!V,()=>{X(V.currentRoute,()=>c.value&&(y.value=!1))}),X(()=>e.permanent,L=>{L&&(y.value=!0)}),Yt(()=>{e.modelValue!=null||c.value||(y.value=e.permanent||!m.value)});const{isDragging:k,dragProgress:E,dragStyles:R}=sn({isActive:y,isTemporary:c,width:I,touchless:K(e,"touchless"),position:d}),W=_(()=>{const L=c.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):I.value;return k.value?L*E.value:L}),{layoutItemStyles:O,layoutItemScrimStyles:ce}=rt({id:e.name,order:_(()=>parseInt(e.order,10)),position:d,layoutSize:W,elementSize:I,active:_(()=>y.value||k.value),disableTransitions:_(()=>k.value),absolute:_(()=>e.absolute||f.value&&typeof oe.value!="string")}),{isStuck:oe,stickyStyles:q}=Qo({rootEl:x,isSticky:f,layoutItemStyles:O}),Be=se(_(()=>typeof e.scrim=="string"?e.scrim:null)),_t=_(()=>({...k.value?{opacity:E.value*.2,transition:"none"}:void 0,...ce.value}));st({VList:{bgColor:"transparent"}});function wt(){D.value=!0}function kt(){D.value=!1}return ee(()=>{const L=n.image||e.image;return r(Te,null,[r(e.tag,z({ref:x,onMouseenter:wt,onMouseleave:kt,class:["v-navigation-drawer",`v-navigation-drawer--${d.value}`,{"v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":D.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--temporary":c.value,"v-navigation-drawer--active":y.value,"v-navigation-drawer--sticky":f.value},i.value,w.value,l.value,g.value,u.value,b.value,e.class],style:[v.value,O.value,R.value,B.value,q.value,e.style]},T,o),{default:()=>{var Ie,Ee,Le,Ae;return[L&&r("div",{key:"image",class:"v-navigation-drawer__img"},[n.image?(Ie=n.image)==null?void 0:Ie.call(n,{image:e.image}):r("img",{src:e.image,alt:""},null)]),n.prepend&&r("div",{class:"v-navigation-drawer__prepend"},[(Ee=n.prepend)==null?void 0:Ee.call(n)]),r("div",{class:"v-navigation-drawer__content"},[(Le=n.default)==null?void 0:Le.call(n)]),n.append&&r("div",{class:"v-navigation-drawer__append"},[(Ae=n.append)==null?void 0:Ae.call(n)])]}}),r(qt,{name:"fade-transition"},{default:()=>[c.value&&(k.value||y.value)&&!!e.scrim&&r("div",z({class:["v-navigation-drawer__scrim",Be.backgroundColorClasses.value],style:[_t.value,Be.backgroundColorStyles.value],onClick:()=>y.value=!1},T),null)]})])}),{isStuck:oe}}}),un={name:"SettingsDrawer",components:{SettingsCommonPanel:Ho,SettingsFooter:gt,VersionFooter:mt},props:{title:{type:String,required:!0},panel:{type:Object,required:!0},admin:{type:Boolean,default:!1}},computed:{...le(M,["isCodexViewable"]),...Kt(ae,["isSettingsDrawerOpen"]),...H(Jo,{invisibleHack:e=>e.bookChange==="next"}),adminAndNotSmall(){return this.admin&&!this.$vuetify.display.smAndDown}},mounted(){this.isSettingsDrawerOpen=this.adminAndNotSmall}},cn={class:"settingsDrawerContainer"},dn={id:"topBlock"},mn={class:"settingsHeader"},gn={id:"footerGroup"};function hn(e,t,o,a,n,s){const i=Z("SettingsCommonPanel"),l=gt,w=mt;return p(),S(ln,z(e.$attrs,{modelValue:e.isSettingsDrawerOpen,"onUpdate:modelValue":t[0]||(t[0]=v=>e.isSettingsDrawerOpen=v),"disable-resize-watcher":"","disable-route-watcher":"",location:"right",scrim:!s.adminAndNotSmall,temporary:!s.adminAndNotSmall,touchless:""}),{append:h(()=>[r(w)]),default:h(()=>[A("div",cn,[A("div",dn,[A("header",mn,[A("h3",null,P(o.title),1)]),e.isCodexViewable?(p(),S(xe(o.panel),{key:0})):$("",!0),e.isCodexViewable?(p(),S(pe,{key:1})):$("",!0),r(i,{"admin-menu":!o.admin},null,8,["admin-menu"]),r(pe)]),A("div",gn,[r(l)])])]),_:1},16,["modelValue","scrim","temporary"])}const Dn=N(un,[["render",hn],["__scopeId","data-v-881e9ee1"]]),ze=Ze(Je(()=>it(()=>import("./admin-drawer-panel-JjJ1iA6R.js").then(e=>e.du),__vite__mapDeps([0,1])))),fn={name:"SettingsDrawerButton",components:{AdminSettingsButtonProgress:ze},data(){return{mdiMenu:Zt,AdminSettingsButtonProgress:ze}},computed:{...H(M,["isUserAdmin"])}};function vn(e,t,o,a,n,s){return p(),S(je,z(e.$attrs,{icon:"",title:"Settings"}),{default:h(()=>[r(U,null,{default:h(()=>[C(P(n.mdiMenu),1)]),_:1}),e.isUserAdmin?(p(),S(xe(n.AdminSettingsButtonProgress),{key:0})):$("",!0)]),_:1},16)}const Bn=N(fn,[["render",vn]]),bn=J({text:String,...re(),...ie()},"VToolbarTitle"),pn=Q()({name:"VToolbarTitle",props:bn(),setup(e,t){let{slots:o}=t;return ee(()=>{const a=!!(o.default||o.text||e.text);return r(e.tag,{class:["v-toolbar-title",e.class],style:e.style},{default:()=>{var n;return[a&&r("div",{class:"v-toolbar-title__placeholder"},[o.text?o.text():e.text,(n=o.default)==null?void 0:n.call(o)])]}})}),{}}}),_n=[null,"prominent","default","comfortable","compact"],wn=J({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:e=>_n.includes(e)},extended:Boolean,extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...we(),...re(),...ke(),...Se(),...ie({tag:"header"}),...ye()},"VToolbar"),In=Q()({name:"VToolbar",props:wn(),setup(e,t){var b;let{slots:o}=t;const{backgroundColorClasses:a,backgroundColorStyles:n}=se(K(e,"color")),{borderClasses:s}=Ce(e),{elevationClasses:i}=Ve(e),{roundedClasses:l}=Re(e),{themeClasses:w}=Pe(e),{rtlClasses:v}=nt(),u=F(!!(e.extended||(b=o.extension)!=null&&b.call(o))),g=_(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),m=_(()=>u.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return st({VBtn:{variant:"text"}}),ee(()=>{var T;const V=!!(e.title||o.title),y=!!(o.image||e.image),B=(T=o.extension)==null?void 0:T.call(o);return u.value=!!(e.extended||B),r(e.tag,{class:["v-toolbar",{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},a.value,s.value,i.value,l.value,w.value,v.value,e.class],style:[n.value,e.style]},{default:()=>[y&&r("div",{key:"image",class:"v-toolbar__image"},[o.image?r(ge,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},o.image):r(Jt,{key:"image-img",cover:!0,src:e.image},null)]),r(ge,{defaults:{VTabs:{height:j(g.value)}}},{default:()=>{var x,D,I;return[r("div",{class:"v-toolbar__content",style:{height:j(g.value)}},[o.prepend&&r("div",{class:"v-toolbar__prepend"},[(x=o.prepend)==null?void 0:x.call(o)]),V&&r(pn,{key:"title",text:e.title},{text:o.title}),(D=o.default)==null?void 0:D.call(o),o.append&&r("div",{class:"v-toolbar__append"},[(I=o.append)==null?void 0:I.call(o)])])]}}),r(ge,{defaults:{VTabs:{height:j(m.value)}}},{default:()=>[r(Ke,null,{default:()=>[u.value&&r("div",{class:"v-toolbar__extension",style:{height:j(m.value)}},[B])]})]})]})}),{contentHeight:g,extensionHeight:m}}});export{Bn as S,pn as V,Dn as _,In as a,Xo as b,jo as c,ln as d,Tn as e,Yo as f,Ko as g,xn as h,qo as i,Jo as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/admin-drawer-panel-JjJ1iA6R.js","assets/admin-drawer-panel-qf94Ysts.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
