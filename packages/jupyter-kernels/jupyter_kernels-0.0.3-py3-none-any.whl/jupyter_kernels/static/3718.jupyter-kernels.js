"use strict";(self.webpackChunk_datalayer_jupyter_kernels=self.webpackChunk_datalayer_jupyter_kernels||[]).push([[3718],{83718:(e,t,s)=>{s.r(t),s.d(t,{default:()=>L});var r=s(83243),i=s(2245),a=s(71514),n=s(45331),o=s(18168),l=s(16781),c=s(98209);class h{constructor(e=o.Sr){this.translator=e,this._changed=new c.Signal(this),this._providerMap=new Map}add(e,t){return this._providerMap.set(e,t),this._changed.emit(),new l.DisposableDelegate((()=>{this._providerMap.delete(e),this._changed.emit()}))}getProvider(e){for(const t of this._providerMap.values())if(t.isApplicable(e))return t.createNew(e,this.translator)}hasProvider(e){for(const t of this._providerMap.values())if(t.isApplicable(e))return!0;return!1}get changed(){return this._changed}}var d,p=s(55616),u=s(35109);class g extends p.I_{constructor(e,t){if(super(),this.searchProvider=e,this._caseSensitive=!1,this._disposed=new c.Signal(this),this._parsingError="",this._preserveCase=!1,this._initialQuery="",this._filters={},this._replaceText="",this._searchActive=!1,this._searchExpression="",this._useRegex=!1,this._wholeWords=!1,this._filters={},this.searchProvider.getFilters){const e=this.searchProvider.getFilters();for(const t in e)this._filters[t]=e[t].default}e.stateChanged.connect(this._onProviderStateChanged,this),this._searchDebouncer=new u.Debouncer((()=>{this._updateSearch().catch((e=>{console.error("Failed to update search on document.",e)}))}),t)}get caseSensitive(){return this._caseSensitive}set caseSensitive(e){this._caseSensitive!==e&&(this._caseSensitive=e,this.stateChanged.emit(),this.refresh())}get currentIndex(){return this.searchProvider.currentMatchIndex}get disposed(){return this._disposed}get filters(){return this._filters}get filtersDefinition(){var e,t,s;return null!==(s=null===(t=(e=this.searchProvider).getFilters)||void 0===t?void 0:t.call(e))&&void 0!==s?s:{}}get filtersDefinitionChanged(){return this.searchProvider.filtersChanged||null}get initialQuery(){return this._initialQuery}set initialQuery(e){this._initialQuery=e||this._searchExpression}get suggestedInitialQuery(){return this.searchProvider.getInitialQuery()}get isReadOnly(){return this.searchProvider.isReadOnly}get replaceOptionsSupport(){return this.searchProvider.replaceOptionsSupport}get parsingError(){return this._parsingError}get preserveCase(){return this._preserveCase}set preserveCase(e){this._preserveCase!==e&&(this._preserveCase=e,this.stateChanged.emit(),this.refresh())}get replaceText(){return this._replaceText}set replaceText(e){this._replaceText!==e&&(this._replaceText=e,this.stateChanged.emit())}get searchExpression(){return this._searchExpression}set searchExpression(e){this._searchExpression!==e&&(this._searchExpression=e,this.stateChanged.emit(),this.refresh())}get totalMatches(){return this.searchProvider.matchesCount}get useRegex(){return this._useRegex}set useRegex(e){this._useRegex!==e&&(this._useRegex=e,this.stateChanged.emit(),this.refresh())}get wholeWords(){return this._wholeWords}set wholeWords(e){this._wholeWords!==e&&(this._wholeWords=e,this.stateChanged.emit(),this.refresh())}dispose(){this.isDisposed||(this._searchExpression&&this.endQuery().catch((e=>{console.error(`Failed to end query '${this._searchExpression}.`,e)})),this.searchProvider.stateChanged.disconnect(this._onProviderStateChanged,this),this._searchDebouncer.dispose(),super.dispose())}async endQuery(){this._searchActive=!1,await this.searchProvider.endQuery(),this.stateChanged.emit()}async highlightNext(){await this.searchProvider.highlightNext(),this.stateChanged.emit()}async highlightPrevious(){await this.searchProvider.highlightPrevious(),this.stateChanged.emit()}refresh(){this._searchDebouncer.invoke().catch((e=>{console.error("Failed to invoke search document debouncer.",e)}))}async replaceAllMatches(){await this.searchProvider.replaceAllMatches(this._replaceText,{preserveCase:this.preserveCase,regularExpression:this.useRegex}),this.stateChanged.emit()}async replaceCurrentMatch(){await this.searchProvider.replaceCurrentMatch(this._replaceText,!0,{preserveCase:this.preserveCase,regularExpression:this.useRegex}),this.stateChanged.emit()}async setFilter(e,t){this._filters[e]!==t&&(this.searchProvider.validateFilter?(this._filters[e]=await this.searchProvider.validateFilter(e,t),this._filters[e]===t&&(this.stateChanged.emit(),this.refresh())):(this._filters[e]=t,this.stateChanged.emit(),this.refresh()))}async _updateSearch(){this._parsingError&&(this._parsingError="",this.stateChanged.emit());try{const e=this.searchExpression?d.parseQuery(this.searchExpression,this.caseSensitive,this.useRegex,this.wholeWords):null;e&&(this._searchActive=!0,await this.searchProvider.startQuery(e,this._filters),this.stateChanged.emit())}catch(e){this._parsingError=e.toString(),this.stateChanged.emit(),console.error(`Failed to parse expression ${this.searchExpression}`,e)}}_onProviderStateChanged(){this._searchActive&&this.refresh()}}!function(e){e.parseQuery=function(e,t,s,r){const i=t?"gm":"gim";let a=s?e:e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");r&&(a="\\b"+a+"\\b");const n=new RegExp(a,i);return n.test("")?null:n}}(d||(d={}));var m=s(64163),v=s(74882),_=s(56769);const x="jp-DocumentSearch-overlay-row",f="jp-DocumentSearch-input",C="jp-DocumentSearch-input-label",b="jp-DocumentSearch-input-wrapper",y="jp-DocumentSearch-input-button-off",E="jp-DocumentSearch-input-button-on",S="jp-DocumentSearch-up-down-button",R="jp-DocumentSearch-search-filter",w="jp-DocumentSearch-replace-button",N="jp-DocumentSearch-replace-button-wrapper",P="jp-DocumentSearch-button-content",T="jp-DocumentSearch-button-wrapper";function D(e){const[t,s]=(0,_.useState)(1),r=(0,_.useCallback)((t=>{var r;const i=t?t.target:null===(r=e.inputRef)||void 0===r?void 0:r.current;if(i){const e=i.value.split(/\n/);let t=e.reduce(((e,t)=>e.length>t.length?e:t),"");i.parentNode&&i.parentNode instanceof HTMLElement&&(i.parentNode.dataset.value=t),s(e.length)}}),[]);return(0,_.useEffect)((()=>{var t,s;null===(s=null===(t=e.inputRef)||void 0===t?void 0:t.current)||void 0===s||s.select(),r()}),[e.initialValue]),_.createElement("label",{className:C},_.createElement("textarea",{onChange:t=>{e.onChange(t),r(t)},onKeyDown:t=>{e.onKeyDown(t),r(t)},rows:t,placeholder:e.placeholder,className:f,key:e.autoUpdate?e.initialValue:null,tabIndex:0,ref:e.inputRef,title:e.title,defaultValue:e.initialValue,autoFocus:e.autoFocus}))}function I(e){var t;const s=(null!==(t=e.translator)&&void 0!==t?t:o.Sr).load("jupyterlab"),r=(0,m.Sh)(e.caseSensitive?E:y,P),i=(0,m.Sh)(e.useRegex?E:y,P),a=(0,m.Sh)(e.wholeWords?E:y,P),n=b;return _.createElement("div",{className:n},_.createElement(D,{placeholder:s.__("Find"),onChange:t=>e.onChange(t),onKeyDown:t=>e.onKeydown(t),inputRef:e.inputRef,initialValue:e.initialSearchText,title:s.__("Find"),autoFocus:!0,autoUpdate:!0}),_.createElement("button",{className:T,onClick:()=>{e.onCaseSensitiveToggled()},tabIndex:0,title:s.__("Match Case")},_.createElement(v.AJ.react,{className:r,tag:"span"})),_.createElement("button",{className:T,onClick:()=>e.onWordToggled(),tabIndex:0,title:s.__("Match Whole Word")},_.createElement(v.zD.react,{className:a,tag:"span"})),_.createElement("button",{className:T,onClick:()=>e.onRegexToggled(),tabIndex:0,title:s.__("Use Regular Expression")},_.createElement(v.MU.react,{className:i,tag:"span"})))}function j(e){var t,s,r;const i=(null!==(t=e.translator)&&void 0!==t?t:o.Sr).load("jupyterlab"),a=(0,m.Sh)(e.preserveCase?E:y,P);return _.createElement("div",{className:"jp-DocumentSearch-replace-wrapper-class"},_.createElement("div",{className:b},_.createElement(D,{placeholder:i.__("Replace"),initialValue:null!==(s=e.replaceText)&&void 0!==s?s:"",onKeyDown:t=>e.onReplaceKeydown(t),onChange:t=>e.onChange(t),title:i.__("Replace"),autoFocus:!1,autoUpdate:!1}),(null===(r=e.replaceOptionsSupport)||void 0===r?void 0:r.preserveCase)?_.createElement("button",{className:T,onClick:()=>e.onPreserveCaseToggled(),tabIndex:0,title:i.__("Preserve Case")},_.createElement(v.AJ.react,{className:a,tag:"span"})):null),_.createElement("button",{className:N,onClick:()=>e.onReplaceCurrent(),tabIndex:0},_.createElement("span",{className:`${w} ${P}`,tabIndex:0},i.__("Replace"))),_.createElement("button",{className:N,tabIndex:0,onClick:()=>e.onReplaceAll()},_.createElement("span",{className:`${w} ${P}`,tabIndex:-1},i.__("Replace All"))))}function F(e){return _.createElement("div",{className:"jp-DocumentSearch-up-down-wrapper"},_.createElement("button",{className:T,onClick:()=>e.onHighlightPrevious(),tabIndex:0,title:e.trans.__("Previous Match")},_.createElement(v.lJ.react,{className:(0,m.Sh)(S,P),tag:"span"})),_.createElement("button",{className:T,onClick:()=>e.onHighlightNext(),tabIndex:0,title:e.trans.__("Next Match")},_.createElement(v.EN.react,{className:(0,m.Sh)(S,P),tag:"span"})))}function W(e){return _.createElement("div",{className:"jp-DocumentSearch-index-counter"},0===e.totalMatches?"-/-":`${null===e.currentIndex?"-":e.currentIndex+1}/${e.totalMatches}`)}function k(e){let t=`jp-DocumentSearch-filter-button ${P}`;e.visible&&(t=`${t} jp-DocumentSearch-filter-button-enabled`);const s=e.anyEnabled?v.oT:v.QR;return _.createElement("button",{className:T,onClick:()=>e.toggleVisible(),tabIndex:0,title:e.visible?e.trans.__("Hide Search Filters"):e.trans.__("Show Search Filters")},_.createElement(s.react,{className:t,tag:"span",height:"20px",width:"20px"}))}function M(e){return _.createElement("label",{className:e.isEnabled?R:`${R} jp-DocumentSearch-search-filter-disabled`,title:e.description},_.createElement("input",{type:"checkbox",className:"jp-mod-styled",disabled:!e.isEnabled,checked:e.value,onChange:e.onToggle}),e.title)}class V extends _.Component{constructor(e){super(e),this.translator=e.translator||o.Sr}_onSearchChange(e){const t=e.target.value;this.props.onSearchChanged(t)}_onSearchKeydown(e){if(13===e.keyCode)if(e.stopPropagation(),e.preventDefault(),e.ctrlKey){const t=e.target;this._insertNewLine(t),this.props.onSearchChanged(t.value)}else e.shiftKey?this.props.onHighlightPrevious():this.props.onHighlightNext()}_onReplaceKeydown(e){13===e.keyCode&&(e.stopPropagation(),e.preventDefault(),e.ctrlKey?this._insertNewLine(e.target):this.props.onReplaceCurrent())}_insertNewLine(e){const[t,s]=[e.selectionStart,e.selectionEnd];e.setRangeText("\n",t,s,"end")}_onClose(){this.props.onClose()}_onReplaceToggled(){if(!this.props.replaceEntryVisible)for(const e in this.props.filtersDefinition){const t=this.props.filtersDefinition[e];t.supportReplace||this.props.onFilterChanged(e,!1).catch((e=>{console.error(`Fail to update filter value for ${t.title}:\n${e}`)}))}this.props.onReplaceEntryShown(!this.props.replaceEntryVisible)}_toggleFiltersVisibility(){this.props.onFiltersVisibilityChanged(!this.props.filtersVisible)}render(){var e;const t=this.translator.load("jupyterlab"),s=!this.props.isReadOnly&&this.props.replaceEntryVisible,r=this.props.filtersDefinition,i=Object.keys(r).length>0,a=i?_.createElement(k,{visible:this.props.filtersVisible,anyEnabled:Object.keys(r).some((e=>{var t;const s=r[e];return null!==(t=this.props.filters[e])&&void 0!==t?t:s.default})),toggleVisible:()=>this._toggleFiltersVisibility(),trans:t}):null,n=i?_.createElement("div",{className:"jp-DocumentSearch-search-options"},Object.keys(r).map((e=>{var t;const i=r[e];return _.createElement(M,{key:e,title:i.title,description:i.description,isEnabled:!s||i.supportReplace,onToggle:async()=>{await this.props.onFilterChanged(e,!this.props.filters[e])},value:null!==(t=this.props.filters[e])&&void 0!==t?t:i.default})}))):null,o=this.props.replaceEntryVisible?v.h4:v.dz;return _.createElement(_.Fragment,null,_.createElement("div",{className:x},this.props.isReadOnly?_.createElement("div",{className:"jp-DocumentSearch-toggle-placeholder"}):_.createElement("button",{className:"jp-DocumentSearch-toggle-wrapper",onClick:()=>this._onReplaceToggled(),tabIndex:0,title:t.__("Toggle Replace")},_.createElement(o.react,{className:`jp-DocumentSearch-replace-toggle ${P}`,tag:"span",elementPosition:"center",height:"20px",width:"20px"})),_.createElement(I,{inputRef:this.props.searchInputRef,useRegex:this.props.useRegex,caseSensitive:this.props.caseSensitive,wholeWords:this.props.wholeWords,onCaseSensitiveToggled:this.props.onCaseSensitiveToggled,onRegexToggled:this.props.onRegexToggled,onWordToggled:this.props.onWordToggled,onKeydown:e=>this._onSearchKeydown(e),onChange:e=>this._onSearchChange(e),initialSearchText:this.props.initialSearchText,translator:this.translator}),a,_.createElement(W,{currentIndex:this.props.currentIndex,totalMatches:null!==(e=this.props.totalMatches)&&void 0!==e?e:0}),_.createElement(F,{onHighlightPrevious:()=>{this.props.onHighlightPrevious()},onHighlightNext:()=>{this.props.onHighlightNext()},trans:t}),_.createElement("button",{className:T,onClick:()=>this._onClose(),tabIndex:0},_.createElement(v.UF.react,{className:"jp-icon-hover",elementPosition:"center",height:"16px",width:"16px"}))),_.createElement("div",{className:x},s?_.createElement(_.Fragment,null,_.createElement(j,{onPreserveCaseToggled:this.props.onPreserveCaseToggled,onReplaceKeydown:e=>this._onReplaceKeydown(e),onChange:e=>this.props.onReplaceChanged(e.target.value),onReplaceCurrent:()=>this.props.onReplaceCurrent(),onReplaceAll:()=>this.props.onReplaceAll(),replaceOptionsSupport:this.props.replaceOptionsSupport,replaceText:this.props.replaceText,preserveCase:this.props.preserveCase,translator:this.translator}),_.createElement("div",{className:"jp-DocumentSearch-spacer"})):null),this.props.filtersVisible?n:null,!!this.props.errorMessage&&_.createElement("div",{className:"jp-DocumentSearch-regex-error"},this.props.errorMessage))}}class A extends p.UB{constructor(e,t){super(e),this.translator=t,this._showReplace=!1,this._showFilters=!1,this._closed=new c.Signal(this),this.addClass("jp-DocumentSearch-overlay"),this._searchInput=_.createRef()}get closed(){return this._closed}focusSearchInput(){var e;null===(e=this._searchInput.current)||void 0===e||e.select()}setSearchText(e){this.model.initialQuery=e,e&&(this.model.searchExpression=e)}setReplaceText(e){this.model.replaceText=e}showReplace(){this.setReplaceInputVisibility(!0)}onCloseRequest(e){super.onCloseRequest(e),this._closed.emit(),this.model.endQuery()}setReplaceInputVisibility(e){this._showReplace!==e&&(this._showReplace=e,this.update())}setFiltersVisibility(e){this._showFilters!==e&&(this._showFilters=e,this.update())}render(){return this.model.filtersDefinitionChanged?_.createElement(p.lA,{signal:this.model.filtersDefinitionChanged},(()=>this._renderOverlay())):this._renderOverlay()}_renderOverlay(){return _.createElement(V,{caseSensitive:this.model.caseSensitive,currentIndex:this.model.currentIndex,isReadOnly:this.model.isReadOnly,errorMessage:this.model.parsingError,filters:this.model.filters,filtersDefinition:this.model.filtersDefinition,preserveCase:this.model.preserveCase,replaceEntryVisible:this._showReplace,filtersVisible:this._showFilters,replaceOptionsSupport:this.model.replaceOptionsSupport,replaceText:this.model.replaceText,initialSearchText:this.model.initialQuery,searchInputRef:this._searchInput,totalMatches:this.model.totalMatches,translator:this.translator,useRegex:this.model.useRegex,wholeWords:this.model.wholeWords,onCaseSensitiveToggled:()=>{this.model.caseSensitive=!this.model.caseSensitive},onRegexToggled:()=>{this.model.useRegex=!this.model.useRegex},onWordToggled:()=>{this.model.wholeWords=!this.model.wholeWords},onFilterChanged:async(e,t)=>{await this.model.setFilter(e,t)},onFiltersVisibilityChanged:e=>{this.setFiltersVisibility(e)},onHighlightNext:()=>{this.model.highlightNext()},onHighlightPrevious:()=>{this.model.highlightPrevious()},onPreserveCaseToggled:()=>{this.model.preserveCase=!this.model.preserveCase},onSearchChanged:e=>{this.model.searchExpression=e},onClose:()=>{this.close()},onReplaceEntryShown:e=>{this.setReplaceInputVisibility(e)},onReplaceChanged:e=>{this.model.replaceText=e},onReplaceCurrent:()=>{this.model.replaceCurrentMatch()},onReplaceAll:()=>{this.model.replaceAllMatches()}})}}var O=s(35909),Q=s(92279);const $="jp-mod-searchable";var K;!function(e){e.search="documentsearch:start",e.searchAndReplace="documentsearch:startWithReplace",e.findNext="documentsearch:highlightNext",e.findPrevious="documentsearch:highlightPrevious",e.end="documentsearch:end"}(K||(K={}));const H={id:"@jupyterlab/documentsearch-extension:labShellWidgetListener",description:"Active search on valid document",requires:[r.r,n.x],autoStart:!0,activate:(e,t,s)=>{const r=e=>{e&&(s.hasProvider(e)?e.addClass($):e.removeClass($))};s.changed.connect((()=>r(t.activeWidget))),t.activeChanged.connect(((e,t)=>{const s=t.oldValue;s&&s.removeClass($),r(t.newValue)}))}},U={id:"@jupyterlab/documentsearch-extension:plugin",description:"Provides the document search registry.",provides:n.x,requires:[o.gv],optional:[i.WW,O.O],autoStart:!0,activate:(e,t,s,r)=>{const i=t.load("jupyterlab");let n=500;const o=new h(t),l=new Map;if(r){const t=r.load(U.id),s=e=>{n=e.get("searchDebounceTime").composite};Promise.all([t,e.restored]).then((([e])=>{s(e),e.changed.connect((e=>{s(e)}))})).catch((e=>{console.error(e.message)}))}const c=()=>{const t=e.shell.currentWidget;return!!t&&o.hasProvider(t)},d=s=>{if(!s)return;const r=s.id;let i=l.get(r);if(!i){const a=o.getProvider(s);if(!a)return;const c=new g(a,n),h=new A(c,t);l.set(r,h),[K.findNext,K.findPrevious,K.end].forEach((t=>{e.commands.notifyCommandChanged(t)})),h.closed.connect((()=>{s.isDisposed||s.activate()})),h.disposed.connect((()=>{s.isDisposed||s.activate(),l.delete(r),[K.findNext,K.findPrevious,K.end].forEach((t=>{e.commands.notifyCommandChanged(t)}))})),s.disposed.connect((()=>{h.dispose(),c.dispose(),a.dispose()})),i=h}return i.isAttached||(Q.$L.attach(i,s.node),s instanceof a.k&&(i.node.style.top=`${s.toolbar.node.getBoundingClientRect().height+s.contentHeader.node.getBoundingClientRect().height}px`),i.model.searchExpression&&i.model.refresh()),i};return e.commands.addCommand(K.search,{label:i.__("Find…"),isEnabled:c,execute:t=>{const s=d(e.shell.currentWidget);if(s){const e=t.searchText;e?s.setSearchText(e):s.setSearchText(s.model.suggestedInitialQuery),s.focusSearchInput()}}}),e.commands.addCommand(K.searchAndReplace,{label:i.__("Find and Replace…"),isEnabled:c,execute:t=>{const s=d(e.shell.currentWidget);if(s){const e=t.searchText;e?s.setSearchText(e):s.setSearchText(s.model.suggestedInitialQuery);const r=t.replaceText;r&&s.setReplaceText(r),s.showReplace(),s.focusSearchInput()}}}),e.commands.addCommand(K.findNext,{label:i.__("Find Next"),isEnabled:()=>!!e.shell.currentWidget&&l.has(e.shell.currentWidget.id),execute:async()=>{var t;const s=e.shell.currentWidget;s&&await(null===(t=l.get(s.id))||void 0===t?void 0:t.model.highlightNext())}}),e.commands.addCommand(K.findPrevious,{label:i.__("Find Previous"),isEnabled:()=>!!e.shell.currentWidget&&l.has(e.shell.currentWidget.id),execute:async()=>{var t;const s=e.shell.currentWidget;s&&await(null===(t=l.get(s.id))||void 0===t?void 0:t.model.highlightPrevious())}}),e.commands.addCommand(K.end,{label:i.__("End Search"),isEnabled:()=>!!e.shell.currentWidget&&l.has(e.shell.currentWidget.id),execute:async()=>{var t;const s=e.shell.currentWidget;s&&(null===(t=l.get(s.id))||void 0===t||t.close())}}),s&&[K.search,K.findNext,K.findPrevious,K.end].forEach((e=>{s.addItem({command:e,category:i.__("Main Area")})})),o}},L=[U,H]},45331:(e,t,s)=>{s.d(t,{x:()=>r});const r=new(s(47963).Token)("@jupyterlab/documentsearch:ISearchProviderRegistry","A service for a registry of search\n  providers for the application. Plugins can register their UI elements with this registry\n  to provide find/replace support.")}}]);