"use strict";(self.webpackChunkhintbot=self.webpackChunkhintbot||[]).push([[144],{144:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var a=n(539),i=n(576),o=n(160),l=n(770),r=n(178),s=n(29),d=n.n(s);class c extends r.ReactWidget{constructor(e){super(),this._message="",this._message=e}getValue(){var e;return null===(e=this.node.querySelector("textarea"))||void 0===e?void 0:e.value}render(){return d().createElement("div",{className:"reflection"},d().createElement("label",null,this._message,d().createElement("textarea",{name:"reflection-input",className:"reflection-input",rows:10})))}}const u=e=>(0,r.showDialog)({title:"Reflection",body:new c(e),buttons:[r.Dialog.createButton({label:"Cancel"}),r.Dialog.createButton({label:"Submit"})],hasClose:!1}),g=async(e,t,n,a,i)=>{var o;const l=null===(o=i.getMetadata("nbgrader"))||void 0===o?void 0:o.grade_id,s=i.getMetadata("remaining_hints");let d="HintRequested";if(document.getElementById("hint-banner"))d="HintAlreadyExists",(0,r.showDialog)({title:"Please review previous hint first",buttons:[r.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]});else if(s<1)d="NotEnoughHint",(0,r.showDialog)({title:"No hint left",buttons:[r.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]});else{const o=n.get("preReflection").composite,r=n.get("postReflection").composite;if((async(e,t,n,a,i)=>{var o;const l=a.getMetadata("nbgrader").grade_id,r=a.getMetadata("remaining_hints"),s=document.createElement("div");s.id="hint-banner-placeholder",t.content.node.insertBefore(s,t.content.node.firstChild);const d=document.createElement("div");d.id="hint-banner",null===(o=t.content.node.parentElement)||void 0===o||o.insertBefore(d,t.content.node),d.innerText="Fetching hint... Please do not refresh the page. \n (It usually takes 1-2 minutes to generate a hint.)";const c=await new Promise((e=>{setTimeout((()=>{e("This is a hint."),console.log(1)}),2e4)}));d.innerText=c,a.setMetadata("remaining_hints",r-1),document.getElementById(l).innerText=`Hint (${r-1} left)`,e.contextForWidget(t).save();const g=document.createElement("div");g.id="hint-banner-buttons-container";const m=document.createElement("div");m.id="hint-banner-buttons";const h=document.createElement("button");h.classList.add("hint-banner-button"),h.innerText="Helpful 👍";const b=document.createElement("button");b.classList.add("hint-banner-button"),b.innerText="Unhelpful 👎";const v=async e=>{if(n.exporters.forEach((a=>{n.publishEvent(t,{eventName:"HintEvaluated",eventTime:Date.now(),eventInfo:{gradeId:l,hintContent:c,evaluation:e}},a,!0)})),i){const e=await u("Write a brief statement of what you learned from the hint and how you will use it to solve the problem.");"Submit"===e.button.label&&(d.remove(),s.remove()),n.exporters.forEach((a=>{n.publishEvent(t,{eventName:"PostReflection",eventTime:Date.now(),eventInfo:{status:e.button.label,gradeId:l,reflection:e.value}},a,!1)}))}else d.remove(),s.remove()};h.onclick=()=>{v("helpful")},b.onclick=()=>{v("unhelpful")},m.appendChild(h),m.appendChild(b),g.appendChild(m),d.appendChild(g)})(e,t,a,i,r),o){document.getElementById("hint-banner").style.filter="blur(10px)";const e=await u("Write a brief statement of what the problem is that you are facing and why you think your solution is not working.");document.getElementById("hint-banner").style.filter="none",a.exporters.forEach((n=>{a.publishEvent(t,{eventName:"PreReflection",eventTime:Date.now(),eventInfo:{status:e.button.label,gradeId:l,reflection:e.value}},n,!1)}))}}a.exporters.forEach((e=>{a.publishEvent(t,{eventName:"HintRequest",eventTime:Date.now(),eventInfo:{status:d,gradeId:l}},e,!1)}))},m={id:"hintbot:plugin",description:"A JupyterLab extension.",autoStart:!0,requires:[o.IDocumentManager,i.INotebookTracker,a.ISettingRegistry,l.IJupyterLabPioneer],activate:async(e,t,n,a,i)=>{console.log("JupyterLab extension hintbot is activated!");const o=await a.load(m.id),l=o.get("hintQuantity").composite;n.widgetAdded.connect((async(e,n)=>{var a,r,s;await n.revealed,await i.loadExporters(n);const d=null===(a=n.content.model)||void 0===a?void 0:a.cells;if(d)for(let e=0;e<d.length;e++)if(d.get(e).getMetadata("nbgrader")&&(null===(r=d.get(e).getMetadata("nbgrader"))||void 0===r?void 0:r.grade_id)&&"markdown"===(null===(s=d.get(e).getMetadata("nbgrader"))||void 0===s?void 0:s.cell_type)){const a=document.createElement("button");a.classList.add("hint-button"),a.id=d.get(e).getMetadata("nbgrader").grade_id,a.onclick=()=>g(t,n,o,i,d.get(e)),n.content.widgets[e].node.appendChild(a),void 0===d.get(e).getMetadata("remaining_hints")?(d.get(e).setMetadata("remaining_hints",l),a.innerText=`Hint (${l} left)`):a.innerText=`Hint (${d.get(e).getMetadata("remaining_hints")} left)`}}))}},h=m}}]);