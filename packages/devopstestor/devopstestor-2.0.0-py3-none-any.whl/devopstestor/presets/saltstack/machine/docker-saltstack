# syntax=docker/dockerfile:1.3-labs
# FROM artifactory-registry.forge.diplomatie.gouv.fr/docker-images-core/debian:bullseye-13a82fb127443db94f66a90b3dd1a9f423ac12db
FROM debian:bullseye-slim

ENV container docker
ENV LC_ALL C
ENV DEBIAN_FRONTEND noninteractive

COPY ressources/tmp /tmp/ressources

#Â run install and cleanup
RUN bash /tmp/ressources/install_base.bash
# RUN rm -rf {/tmp/deb,/tmp/ressources} && apt -y autoremove && apt clean

# Mock salt sdb
COPY ressources/usr/lib/python3/dist-packages/salt/modules/sdb.py /usr/lib/python3/dist-packages/salt/modules/sdb.py
COPY ressources/usr/lib/python3/dist-packages/salt/runners/sdb.py /usr/lib/python3/dist-packages/salt/runners/sdb.py

# Config saltstack
COPY ressources/etc/salt/master.d/override.conf /etc/salt/master.d/override.conf

# Start systemd
CMD ["/lib/systemd/systemd"]
