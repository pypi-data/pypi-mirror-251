image: python:3.8-slim-bookworm

cache:
  paths:
    - $CI_PROJECT_DIR/.cache/pip

stages:  
  - test        
  - build
  - deploy

unit-test-job:   
  stage: test   
  before_script:
    - pip3 install hatch==1.9.1 
  script:
    - echo "Running unit tests..."
    - hatch run test

lint-test-job:   
  stage: test    
  before_script:
    - pip3 install hatch==1.9.1 
  script:
    - echo "Linting code... This will take about 10 seconds."
    - echo "No lint issues found."

build-job:       
  stage: build
  before_script:
    - pip3 install hatch==1.9.1
    - sed -i -e "s/0.1.1/$CI_COMMIT_TAG/" src/inter_jamisson/__about__.py #$CI_COMMIT_TAG
    - cat src/inter_jamisson/__about__.py
  script:
    - echo "Compiling the code..."
    - hatch build
  artifacts:
    paths:
      - dist/
      - src/inter_jamisson/__about__.py
  only:
    - tags

deploy-job:
  stage: deploy
  variables:
    HATCH_INDEX_USER: $PYPI_USERNAME
    HATCH_INDEX_AUTH: $PYPI_PASSWORD
  before_script:
    - pip3 install hatch==1.9.1 
  script:
    - echo "Deploying application..."
    - hatch publish
    - echo "Application successfully deployed."
  dependencies:
    - build-job

