{"version":3,"sources":["create-plugin-ui.js","Molstar.jsx","MolstarComponent.tsx","index.tsx"],"names":["i","createPluginUI","target","spec","options","ctx","PluginUIContext","DefaultPluginUISpec","init","onBeforeUIRender","ReactDOM","render","createElement","Plugin","plugin","canvas3dInitialized","CustomMaterial","Material","roughness","metalness","PresetParams","StructureRepresentationPresetProvider","CommonParams","get_url_from_data","data","isBinary","blob","Blob","type","URL","createObjectURL","addTrajectory","params","model","kind","builders","rawData","label","modelLabel","download","url","structure","parseTrajectory","format","trajectory","createModel","provider","dataFormats","get","parse","coordinates","coordinatesLabel","coords","build","toRoot","apply","TrajectoryFromModelAndCoordinates","modelRef","ref","coordinatesRef","dependsOn","StateTransforms","Model","ModelFromTrajectory","modelIndex","commit","createStructure","representation","applyPreset","InteractionsPreset","id","display","name","structureCell","StateObjectRef","resolveAndCheck","state","obj","presetStaticComponent","components","ligand","interactions","reprBuilder","update","builder","typeParams","representations","buildRepresentation","material","sizeFactor","color","colorParams","carbonColor","tag","revertOnError","managers","interactivity","setProps","granularity","ViewerAutoPreset","group","description","isApplicable","a","models","some","m","QualityAssessment","sourceData","structures","length","modelNum","config","set","animation","_animations","QualityAssessmentPLDDTPreset","QualityAssessmentQmeanPreset","PresetStructureRepresentations","auto","Molstar","props","modelFile","trajFile","height","width","showAxes","defaultShowControls","showExpand","showControls","showSettings","showSelectionMode","showAnimation","showTrajectoryControls","parentRef","useRef","useEffect","layout","initial","isExpanded","controlsDisplay","PluginConfig","Viewport","ShowExpand","ShowControls","ShowSettings","ShowSelectionMode","ShowAnimation","Structure","DefaultRepresentationPreset","ShowTrajectoryControls","behaviors","filter","behavior","transformer","definition","current","registerPreset","canvas3d","camera","helper","axes","loadStructure","ParamDefinition","getDefaultValues","CameraHelperParams","clear","undefined","preset","asset","Asset","File","runTask","applyAction","OpenFiles","files","visuals","isGhost","style","position","overflow","left","top","right","bottom","MyFullScreen","handler","useFullScreenHandle","className","onClick","enter","handle","children","MolstarComponent","args","StreamlitComponentBase","withStreamlitConnection","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.ff8aa7fb.chunk.js","sourcesContent":["import { createElement } from 'react';\nimport ReactDOM from 'react-dom';\nimport { Plugin } from '@dp-launching/molstar/lib/mol-plugin-ui/plugin';\nimport { PluginUIContext } from '@dp-launching/molstar/lib/mol-plugin-ui/context';\nimport { DefaultPluginUISpec } from '@dp-launching/molstar/lib/mol-plugin-ui/spec';\n\nconst createPluginUI = async (target, spec, options) => {\n  const ctx = new PluginUIContext(spec || DefaultPluginUISpec());\n  await ctx.init();\n  if (options && options.onBeforeUIRender) {\n    await options.onBeforeUIRender(ctx);\n  }\n  ReactDOM.render(createElement(Plugin, { plugin: ctx }), target);\n  try {\n    await ctx.canvas3dInitialized;\n  } catch {\n    // Error reported in UI/console elsewhere.\n  }\n  return ctx;\n};\n\nexport { createPluginUI };","import React, { useEffect, useRef } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { DefaultPluginUISpec } from \"@dp-launching/molstar/lib/mol-plugin-ui/spec\";\nimport { QualityAssessmentPLDDTPreset, QualityAssessmentQmeanPreset } from '@dp-launching/molstar/lib/extensions/model-archive/quality-assessment/behavior';\nimport { QualityAssessment } from '@dp-launching/molstar/lib/extensions/model-archive/quality-assessment/prop';\nimport { TrajectoryFromModelAndCoordinates } from '@dp-launching/molstar/lib/mol-plugin-state/transforms/model';\nimport { StateTransforms } from '@dp-launching/molstar/lib/mol-plugin-state/transforms';\nimport { PluginConfig } from \"@dp-launching/molstar/lib/mol-plugin/config\";\nimport \"@dp-launching/molstar/build/viewer/molstar.css\";\nimport { ParamDefinition } from \"@dp-launching/molstar/lib/mol-util/param-definition\";\nimport { CameraHelperParams } from \"@dp-launching/molstar/lib/mol-canvas3d/helper/camera-helper\";\nimport { OpenFiles } from '@dp-launching/molstar/lib/mol-plugin-state/actions/file';\nimport { Asset } from '@dp-launching/molstar/lib/mol-util/assets';\nimport { PresetStructureRepresentations, StructureRepresentationPresetProvider } from '@dp-launching/molstar/lib/mol-plugin-state/builder/structure/representation-preset';\nimport { StateObjectRef } from '@dp-launching/molstar/lib/mol-state';\nimport { presetStaticComponent } from '@dp-launching/molstar/lib/mol-plugin-state/builder/structure/representation-preset';\n\nimport { Material } from '@dp-launching/molstar/lib/mol-util/material';\n\nimport { createPluginUI } from './create-plugin-ui';\nconst CustomMaterial = Material({ roughness: 0.2, metalness: 0 });\nconst PresetParams = {\n  ...StructureRepresentationPresetProvider.CommonParams,\n};\n\n\nfunction get_url_from_data(data, isBinary) {\n  var blob;\n  if (isBinary){\n    blob = new Blob([data], {type: 'application/octet-stream'});\n  } else {\n    blob = new Blob([data], {type: 'text/plain'});\n  }\n  return URL.createObjectURL(blob);\n}\n\nexport const addTrajectory = async (plugin, params) => {\n  if (!plugin) return;\n  let model;\n  let coords;\n  if (params.model.kind === 'model-data' || params.model.kind === 'model-url') {\n    const data =\n      params.model.kind === 'model-data'\n        ? await plugin.builders.data.rawData({ data: params.model.data, label: params.modelLabel })\n        : await plugin.builders.data.download({\n          url: params.model.url,\n          isBinary: params.model.isBinary,\n          label: params.modelLabel,\n        });\n\n    const trajectory = await plugin.builders.structure.parseTrajectory(data, params.model.format ?? 'mmcif');\n    model = await plugin.builders.structure.createModel(trajectory);\n  } else {\n    const data =\n      params.model.kind === 'topology-data'\n        ? await plugin.builders.data.rawData({ data: params.model.data, label: params.modelLabel })\n        : await plugin.builders.data.download({\n          url: params.model.url,\n          isBinary: params.model.isBinary,\n          label: params.modelLabel,\n        });\n\n    const provider = plugin.dataFormats.get(params.model.format);\n    model = await provider.parse(plugin, data);\n  }\n  {\n    // FIXME coordinates-data is not supported\n    if (params.coordinates.kind === 'coordinates-data'){\n      params.coordinates.url = get_url_from_data(params.coordinates.data, params.coordinates.isBinary);\n      params.coordinates.kind = 'coordinates-url';\n    }\n    const data =\n      params.coordinates.kind === 'coordinates-data'\n        ? await plugin.builders.data.rawData({\n          data: params.coordinates.data,\n          label: params.coordinatesLabel,\n        })\n        : await plugin.builders.data.download({\n          url: params.coordinates.url,\n          isBinary: params.coordinates.isBinary,\n          label: params.coordinatesLabel,\n        });\n\n    const provider = plugin.dataFormats.get(params.coordinates.format);\n    coords = await provider.parse(plugin, data);\n  }\n  const trajectory = await plugin\n    .build()\n    .toRoot()\n    .apply(\n      TrajectoryFromModelAndCoordinates,\n      {\n        modelRef: model.ref,\n        coordinatesRef: coords.ref,\n      },\n      { dependsOn: [model.ref, coords.ref] }\n    )\n    .apply(StateTransforms.Model.ModelFromTrajectory, { modelIndex: 0 })\n    .commit();\n  const structure = await plugin.builders.structure.createStructure(trajectory);\n  await plugin.builders.structure.representation.applyPreset(structure, 'auto');\n};\n\nconst InteractionsPreset = StructureRepresentationPresetProvider({\n  id: 'preset-interactions',\n  display: { name: 'Interactions' },\n  params: () => PresetParams,\n  async apply(ref, params, plugin) {\n      const structureCell = StateObjectRef.resolveAndCheck(plugin.state.data, ref);\n      const structure = structureCell?.obj?.data;\n      if (!structureCell || !structure) return {};\n\n      const components = {\n          ligand: await presetStaticComponent(plugin, structureCell, 'all'),\n          interactions: await presetStaticComponent(plugin, structureCell, 'all'),\n      };\n\n      const { update, builder, typeParams } = StructureRepresentationPresetProvider.reprBuilder(plugin, params);\n      const representations = {\n          ligand: builder.buildRepresentation(update, components.ligand, { type: 'ball-and-stick', typeParams: { ...typeParams, material: CustomMaterial, sizeFactor: 0.3 }, color: 'element-symbol', colorParams: { carbonColor: { name: 'element-symbol', params: {} } } }, { tag: 'all' }),\n      };\n\n      await update.commit({ revertOnError: true });\n      plugin.managers.interactivity.setProps({ granularity: 'element' });\n\n      return { components, representations };\n  }\n});\n\nconst ViewerAutoPreset = StructureRepresentationPresetProvider({\n  id: 'preset-structure-representation-viewer-auto',\n  display: {\n    name: 'Automatic (w/ Annotation)', group: 'Annotation',\n    description: 'Show standard automatic representation but colored by quality assessment (if available in the model).'\n  },\n  isApplicable(a) {\n    return (\n      !!a.data.models.some(m => QualityAssessment.isApplicable(m, 'pLDDT')) ||\n      !!a.data.models.some(m => QualityAssessment.isApplicable(m, 'qmean'))\n    );\n  },\n  params: () => StructureRepresentationPresetProvider.CommonParams,\n  async apply(ref, params, plugin) {\n    const structureCell = StateObjectRef.resolveAndCheck(plugin.state.data, ref);\n    const structure = structureCell && structureCell.obj && structureCell.obj.data;\n    const nmodels = structure.state.models[0].sourceData.data.structures? structure.state.models[0].sourceData.data.structures.length: structure.state.models[0].modelNum;\n    if (nmodels > 1){\n      plugin.config.set(\"viewer.show-animation-button\", true);\n    } else {\n      plugin.config.set(\"viewer.show-animation-button\", false);\n      plugin.managers.animation._animations.length = [];\n    }\n\n    if (!structureCell || !structure) return {};\n    \n    if (structure.model.sourceData.kind === 'gro'){\n      return await InteractionsPreset.apply(ref, params, plugin);\n      \n    } else if (structure.models.some(m => QualityAssessment.isApplicable(m, 'pLDDT'))) {\n      return await QualityAssessmentPLDDTPreset.apply(ref, params, plugin);\n    } else if (structure.models.some(m => QualityAssessment.isApplicable(m, 'qmean'))) {\n      return await QualityAssessmentQmeanPreset.apply(ref, params, plugin);\n    } else {\n      return await PresetStructureRepresentations.auto.apply(ref, params, plugin);\n    }\n  }\n});\n\n\nconst Molstar = props => {\n\n  const {\n    modelFile, trajFile,\n    height = '100%', width = '100%',\n    showAxes = true,\n    defaultShowControls = false,\n    showExpand = true, showControls = true, showSettings = true, showSelectionMode = true, showAnimation = false, showTrajectoryControls = true\n  } = props;\n  const parentRef = useRef(null);\n  const canvasRef = useRef(null);\n  const plugin = useRef(null);\n\n  useEffect(() => {\n    (async () => {\n      const spec = DefaultPluginUISpec();\n      spec.layout = {\n        initial: {\n          isExpanded: false,\n          controlsDisplay: \"reactive\",\n          showControls: defaultShowControls,\n        },\n      };\n      spec.config = [\n        [PluginConfig.Viewport.ShowExpand, showExpand],\n        [PluginConfig.Viewport.ShowControls, showControls],\n        [PluginConfig.Viewport.ShowSettings, showSettings],\n        [PluginConfig.Viewport.ShowSelectionMode, showSelectionMode],\n        [PluginConfig.Viewport.ShowAnimation, true],\n        [PluginConfig.Structure.DefaultRepresentationPreset, ViewerAutoPreset.id],\n        [PluginConfig.Viewport.ShowTrajectoryControls, showTrajectoryControls],\n      ];\n      if (modelFile?.format === \"gro\" || trajFile?.format === \"gro\") {\n        spec.behaviors = spec.behaviors.filter(behavior => (behavior.transformer.definition.name !== \"create-structure-focus-representation\"));\n      }\n      plugin.current = await createPluginUI(parentRef.current, spec, {\n        onBeforeUIRender: plugin => {\n            // the preset needs to be added before the UI renders otherwise\n            // \"Download Structure\" wont be able to pick it up\n            plugin.builders.structure.representation.registerPreset(ViewerAutoPreset);\n        }\n      });\n      if (!showAxes) {\n        // eslint-disable-next-line\n        plugin.current.canvas3d?.setProps({\n          camera: {\n            helper: {\n              axes: {\n                name: \"off\", params: {}\n              }\n            }\n          }\n        });\n      }\n      await loadStructure(modelFile, trajFile, plugin.current);\n    })();\n    return () => plugin.current = null;\n  }, [])\n\n\n  useEffect(() => {\n    loadStructure(modelFile, trajFile, plugin.current);\n  }, [modelFile, trajFile])\n\n\n  useEffect(() => {\n    if (plugin.current) {\n      if (!showAxes) {\n        // eslint-disable-next-line\n        plugin.current.canvas3d?.setProps({\n          camera: {\n            helper: {\n              axes: {\n                name: \"off\", params: {}\n              }\n            }\n          }\n        })\n      } else {\n        // eslint-disable-next-line\n        plugin.current.canvas3d?.setProps({\n          camera: {\n            helper: {\n              axes: ParamDefinition.getDefaultValues(CameraHelperParams).axes\n            }\n          }\n        })\n      }\n    }\n  }, [showAxes])\n\n  \n\n  const loadStructure = async (modelFile, trajFile, plugin) => {\n    if (plugin) {\n      plugin.clear();\n      if (trajFile) {\n\n        await addTrajectory(plugin, {\n          model: {\n            kind: (modelFile.url ? 'model-url' : 'model-data'),\n            url: (modelFile.url ? modelFile.url : undefined),\n            data: (modelFile.data ? modelFile.data : undefined),\n            format: modelFile.format,\n          },\n          \n          coordinates: {\n            kind: (trajFile.url ? 'coordinates-url' : 'coordinates-data'),\n            url: (trajFile.url ? trajFile.url : undefined),\n            data: (trajFile.data ? trajFile.data : undefined),\n            format: trajFile.format,\n            isBinary: true,\n          },\n          preset: 'all-models',\n        });\n      } else if (modelFile.data) {\n        const asset = Asset.File(new File([modelFile.data], modelFile.name));\n        // const data = await OpenFiles(plugin, {\n        //   files: [asset],\n        //    format: { name: 'auto', params: {} },\n        //    visuals: true\n        // });\n        //PluginCommands.State.Snapshots.OpenFile(plugin, { file: new File([modelFile.data], modelFile.name)});\n        const a = await plugin.runTask(plugin.state.data.applyAction(OpenFiles, {\n          files: [asset],\n           format: { name: 'auto', params: {} },\n           visuals: true\n        })); \n      } else {\n        const data = await plugin.builders.data.download(\n          { url: modelFile.url }, { state: { isGhost: true } }\n        );\n        const asset = Asset.File(new File([data.obj.data], modelFile.name));\n        plugin.runTask(plugin.state.data.applyAction(OpenFiles, {\n          files: [asset],\n            format: { name: 'auto', params: {} },\n            visuals: true\n        })); \n      }\n    }\n  }\n  return (\n    <div style={{ position: \"absolute\", width, height, overflow: \"hidden\" }}>\n      <div ref={parentRef} style={{ position: \"absolute\", left: 0, top: 0, right: 0, bottom: 0 }} />\n    </div>\n  )\n};\n\nMolstar.propTypes = {\n  modelFile: PropTypes.object,\n  trajFile: PropTypes.object,\n\n  // Viz Control\n  showAxes: PropTypes.bool,\n  showControls: PropTypes.bool,\n  showExpand: PropTypes.bool,\n  showAnimation: PropTypes.bool,\n  showSettings: PropTypes.bool,\n  showSelectionMode: PropTypes.bool,\n  showTrajectoryControls: PropTypes.bool,\n  defaultShowControls: PropTypes.bool,\n\n  // More\n  width: PropTypes.string,\n  height: PropTypes.string,\n};\n\nexport default Molstar;","import {\n  StreamlitComponentBase,\n  withStreamlitConnection,\n} from \"streamlit-component-lib\"\nimport React, { ReactNode } from \"react\"\nimport { FullScreen, useFullScreenHandle } from \"react-full-screen\"\n// @ts-ignore\n//import Molstar from \"molstar-react\";\nimport Molstar from \"./Molstar.jsx\"\nimport \"./MolstarComponent.css\"\n\ninterface State {}\n\nconst MyFullScreen = (props: any) => {\n  const handler = useFullScreenHandle()\n  return (\n    <>\n      <button className=\"fullscreen-button\" onClick={handler.enter}>\n        <span></span>\n        <span></span>\n        <span></span>\n        <span></span>\n      </button>\n      <FullScreen className=\"myfullscreen\" handle={handler}>\n        {props.children}\n      </FullScreen>\n    </>\n  )\n}\n\nclass MolstarComponent extends StreamlitComponentBase<State> {\n  public render = (): ReactNode => {\n    const height = this.props.args[\"height\"]\n    const modelFile = this.props.args[\"modelFile\"]\n    const trajFile = this.props.args[\"trajFile\"]\n\n    if (modelFile && modelFile.data) {\n      modelFile.data = this.props.args[\"modelFile_data\"]\n    }\n    if (trajFile && trajFile.data) {\n      trajFile.data = this.props.args[\"trajFile_data\"];\n    }\n    return (\n      <div style={{ height: height }}>\n        <MyFullScreen>\n          <Molstar\n            modelFile={modelFile}\n            trajFile={trajFile}\n            showExpand={false}\n            showAnimation={true}\n          />\n        </MyFullScreen>\n      </div>\n    )\n  }\n}\n\n// \"withStreamlitConnection\" is a wrapper function. It bootstraps the\n// connection between your component and the Streamlit app, and handles\n// passing arguments from Python -> Component.\n//\n// You don't need to edit withStreamlitConnection (but you're welcome to!).\nexport default withStreamlitConnection(MolstarComponent)\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\n// @ts-ignore\nimport MolstarComponent from \"./MolstarComponent\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <MolstarComponent />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)"],"sourceRoot":""}