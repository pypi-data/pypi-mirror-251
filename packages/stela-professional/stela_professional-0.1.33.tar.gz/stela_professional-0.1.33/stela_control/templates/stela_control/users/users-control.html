{% extends 'stela_control/index.html' %}
{% load i18n %}
{% load static %}
{% load humanize %}
{% load crispy_forms_tags %}
{% block side_title %}
    {% if call == "subs" %}
        <h3 class="oxanium mx-4 text-end"><b>STELA {% trans "CONTROL DYNAMIC" %} | {% trans "Subscribers" %}</b></h3>
    {% else %}
        <h3 class="oxanium mx-4 text-end"><b>STELA {% trans "CONTROL DYNAMIC" %} | {% trans "Users Control" %}</b></h3>
    {% endif %}
{% endblock  %}
{% block title %}
{% if userdata.is_superuser is True %}
    <h1 class="h2 oxanium text-dark ml-3"><i class="fa-solid fa-user-shield color-stela"></i> {% trans "Superuser" %} # {{userdata.id}} {{userdata.username}} </h1>
{% else %}
    <h1 class="h2 oxanium text-dark ml-3"><i class="fa-solid fa-user color-stela"></i> {% trans "User" %} # {{userdata.id}} {{userdata.username}}</h1>
{% endif %}
{% endblock  %} 
{% block section_content %}
        <div class="row justify-content-center main-data wow fadeIn mt-5" ata-wow-duration="1s" data-wow-delay="0.5s">
            <div class="col-lg-7 mb-3">
                <div class="card p-0 ml-4">
                    <div class="card-body">
                        {% block user_handler %}
                        {% endblock  %}
                    </div>
                </div>
            </div>
            <div class="col-lg-5 mb-3 mt-2">
                <div class="d-flex justify-content-end p-4">
                    <small>{% trans "Last Login" %}: {{userdata.last_login|naturaltime}}</small>
                </div>
                <div class="d-flex justify-content-center">
                    {% if user.image %}
                        <img class="stela-profile-image rounded mb-3" src="{{user.image.url}}" alt="">
                    {% else %}
                        <img class="stela-profile-image rounded mb-3" src="{% static 'img/stela/icons/profile.png' %}" alt="">
                    {% endif %}
                    
                </div>
                <ul class="no-list mx-4">
                    <li class="mb-3">
                        <button class="btn-block btn btn-shappire" data-bs-toggle="modal" data-bs-target="#message" onclick="loadMessage({{user.pk}}, 'checkEditUser', 'editUserForm')">{% trans "Send Message" %}</button>
                    </li>
                    <li class="mb-3">
                        <button class="btn-block btn btn-danger" data-bs-toggle="modal" data-bs-target="#suspendUser" onclick="removeRequest()">{% trans "Suspend Account" %}</button>
                    </li>
                </ul>
            </div>
            <div class="col-lg-10">
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-6">
                                <h3 class="fs-5 oxanium pt-2 m-0">{% trans "Address" %}</h3>
                                <p class="m-0 p-0 text-dark">{{userdata.address}}</p>
                                <h3 class="fs-5 oxanium pt-2 m-0">{% trans "City" %}</h3>
                                <p class="m-0 p-0 text-dark">{{userdata.city_profile}}</p>
                                <h3 class="fs-5 oxanium pt-2 m-0">{% trans "Country" %}</h3>
                                <p class="m-0 p-0 text-dark">{{userdata.country_profile}}</p>
                            </div>
                            <div class="col-lg-6 text-right">
                                <div class="d-flex mb-2 justify-content-center">
                                    {% if user.owner_social.all %}
                                        {% for link in user.owner_social.all %}
                                            {% if link.social == "Instagram" %}
                                                <a href="{{link.url.url}}" class="social-icon h-bg-instagram">
                                                    <i class="bi-instagram"></i>
                                                    <i class="bi-instagram"></i>
                                                </a>
                                            {% elif link.social == "Facebook" %}
                                                <a href="{{link.url.url}}" class="social-icon text-white bg-facebook" data-animate="slideInLeft">
                                                    <i class="fa-brands fa-facebook-f"></i>
                                                    <i class="fa-brands fa-facebook-f"></i>
                                                </a>
                                            {% elif link.social == "X" %}
                                                <a href="{{link.url.url}}" class="social-icon h-bg-x-twitter">
                                                    <i class="fa-brands fa-x-twitter"></i>
                                                    <i class="fa-brands fa-x-twitter"></i>
                                                </a>
                                            {% elif link.social == "Wikipedia" %}
                                                <a href="{{link.url.url}}" class="social-icon text-white bg-wikipedia" data-animate="slideInLeft" data-delay="700">
                                                    <i class="fa-brands fa-wikipedia-w"></i>
                                                    <i class="fa-brands fa-wikipedia-w"></i>
                                                </a>
                                            {% elif link.social == "Tiktok" %}
                                                <a href="{{link.url.url}}" class="social-icon h-bg-tiktok">
                                                    <i class="fa-brands fa-tiktok"></i>
                                                    <i class="fa-brands fa-tiktok"></i>
                                                </a>
                                            {% elif link.social == "Linkedin" %}
                                                <a href="{{link.url.url}}" class="social-icon h-bg-linkedin">
                                                    <i class="fa-brands fa-linkedin"></i>
                                                    <i class="fa-brands fa-linkedin"></i>
                                                </a>
                                            {% elif link.social == "Youtube" %}
                                                <a href="{{link.url.url}}" class="social-icon h-bg-youtube">
                                                    <i class="fa-brands fa-youtube"></i>
                                                    <i class="fa-brands fa-youtube"></i>
                                                </a>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                    {% endif %}
                                </div>
                                <div class="row">
                                    <ul>
                                        <li>{% trans "Full Name" %}: {{userdata.full_name}}</li>
                                        <li>{% trans "Phone" %}: {{userdata.phone_number}}</li>
                                        <li>{% trans "Email" %}: {{userdata.email}}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal fade" id="message" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title oxanium" id="staticBackdropLabel">{% trans "New Message" %}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body mid-modal-scroll form-cage d-none">  
                        <form action="" method="post" enctype="multipart/form-data" id="formMessage">
                            <div id="formContent">
                                
                                
                            </div> 
                            <div class="row justify-content-end">
                                <div class="col-lg-3">
                                    <button type="submit" class="btn btn-block btn-shappire oxanium form-btn-main d-flex justify-content-center align-items-center">{% trans "Send" %} <i class='bx bxs-send fs-4'></i></button>
                                </div>
                            </div>
                        </form>
                    </div>    
                    <div class="preload-cage-sendgrid vh-50 fade-in">
                        <h3 class="text-preload-sendgrid fs-6">{% trans "Proccess data, please wait" %}...</h3>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade max-overlay" id="suspendUser" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="mb-3">
                <div class="container">
                    <div class="row">
                        <div class="col-12"> 
                            <h3 class="text-center alert-title oxanium">{% trans "Are you sure?" %}</h3>
                            <div class="iconhigh">
                                <div id="anicon">
    
                                </div> 
                            </div>
                            <div id="contentAlert">
                                <p class="text-center text-dark">{% trans "This option cannot be reversed" %}.</p>   
                                <div class="d-flex justify-content-center">
                                    <input type="hidden" id="removeData">
                                    <button onclick="suspendUser('{{userdata.pk}}')" class="btn btn-danger remove-btn">{% trans "Remove" %}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>                   
            </div>
            </div>
        </div>
{% endblock  %}
{% block inside_scripts %}
{% comment %} <script>
    $('#formUserData').submit(function(event) {
        event.preventDefault(); 
        document.querySelector('.form-btn-main').disabled = true
        document.querySelector('.form-btn-main').innerHTML = "<div class='loader'></div>";
        formCage.classList.add('d-none')
        preloadCage2.classList.remove('d-none');
        var formData = new FormData(this)
        $.ajax({
            type: 'POST',
            url: accountValidatorUrl,
            data: formData,
            processData: false,
            contentType: false,
            success: function(json) {
                if (json.success) {
                    innerSuccess.innerHTML = json.success
                    alertSuccess.classList.remove('d-none')
                    setInterval(refresh, 3000);
            }
    
                if (json.alert) {
                    formContent.innerHTML = json.formset_html;
                    innerDanger.innerHTML = json.alert
                    alertDanger.classList.remove('d-none')
                    preloadCage2.classList.add('d-none')
                    formCage.classList.remove('d-none');
                    document.querySelector('.form-btn-main').disabled = false;
                    document.querySelector('.form-btn-main').innerHTML = FormText
                } 
            },
            error: function(xhr, status, error) {
        
            },
        });
    });
    
    $('#formMessage').submit(function(event) {
        event.preventDefault(); 
        document.querySelector('.form-btn-main').disabled = true
        document.querySelector('.form-btn-main').innerHTML = "<div class='loader'></div>";
        formCage.classList.add('d-none')
        preloadCage2.classList.remove('d-none');
        const ckeditor = document.querySelectorAll('.ck-editor__editable');
            ckeditor.forEach(ckeditor => {
            document.querySelector('.ck-editor__editable').ckeditorInstance.destroy()
        });
        var formData = new FormData(this)
        $.ajax({
            type: 'POST',
            url: messagesUrl,
            data: formData,
            processData: false,
            contentType: false,
            success: function(json) {
                if (json.success) {
                    innerSuccess.innerHTML = json.success
                    alertSuccess.classList.remove('d-none')
                    setInterval(refresh, 3000);
            }
                if (json.alert) {
                    formContent.innerHTML = json.formset_html;
                    innerDanger.innerHTML = json.alert
                    alertDanger.classList.remove('d-none')
                    preloadCage2.classList.add('d-none')
                    formCage.classList.remove('d-none');
                    document.querySelector('.form-btn-main').disabled = false;
                    document.querySelector('.form-btn-main').innerHTML = FormText
                } 
            },
            error: function(xhr, status, error) {
    
            },
            });
    });
    
    function loadProfileEdit(userID, actionID, form_name) {
        formCage.classList.add('d-none')
        preloadCage2.classList.remove('d-none')
        $.ajax({
            url: accountValidatorUrl,
            method:"POST",
            data:{
                userid: userID,
                action: actionID,
                form_name: form_name,
                csrfmiddlewaretoken:CSRF_TOKEN
            },
            success:function(json){
                if(json.content){ 
                    formContent.innerHTML = json.content
                    preloadCage2.classList.add('d-none')
                    formCage.classList.remove('d-none')
                    var script = document.createElement('script');
                    script.src = checkInputs;
                    script.src = formsetHandlers;
                    document.head.appendChild(script);
                }
            }
        })
    }
    
    function loadMessage(user_id) {
        formCage.classList.add('d-none')
        preloadCage2.classList.remove('d-none')   
        data = {
            user_id:user_id,
            csrfmiddlewaretoken:CSRF_TOKEN,
            action: 'loadMessageForm',
        }
        $.ajax({
            url: messagesUrl,
            method:"POST",
            data:data,
            success:function(json){
                formContent.innerHTML = json.content
                activateMessageCKE()
                preloadCage2.classList.add('d-none')
                formCage.classList.remove('d-none')
            }
        })
    }

    function suspendUser(user_id) {
        formCage.classList.add('d-none')
        preloadCage2.classList.remove('d-none')   
        data = {
            user_id:user_id,
            csrfmiddlewaretoken:CSRF_TOKEN,
            action: 'loadMessageForm',
        }
        $.ajax({
            url: '/validations/suspend-account/'+user_id+'/',
            method:"POST",
            data:data,
            success:function(json){
                document.querySelector('.alert-title').innerHTML = removeSuccessTitle
                const anicon = document.getElementById('anicon');
                const contentData = document.getElementById('contentAlert');
                anicon.classList.add('fade-in')
                anicon.innerHTML = '<div id="iconsuccess"></div>';
                contentData.classList.add('fade-in')
                contentData.innerHTML = json.success;
                bodymovin.loadAnimation({
                    container: document.getElementById('iconsuccess'),
                    path: checkmark,
                    loop: false,
                });
            }
        })
    }
</script> {% endcomment %}
    <script src="https://stelacdn.s3.amazonaws.com/static/js/stela/users/user-profile.js"></script>
{% endblock  %}