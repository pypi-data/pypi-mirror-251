{"version":3,"file":"draftReviewModelTests.js","names":["suite","model","parentObject","beforeEach","RB","BaseResource","links","reviews","href","DraftReview","rspNamespace","describe","spyOn","Backbone","Model","prototype","and","callFake","options","_","isFunction","success","resolveTo","it","expect","isNew","toBe","get","ready","toHaveBeenCalled","_retrieveDraft","set","id","not","done","console","warn","error","fail","publish","trigger","toHaveBeenCalledWith"],"sources":["../../../../../../../static/rb/js/resources/models/tests/draftReviewModelTests.es6.js"],"sourcesContent":["suite('rb/resources/models/DraftReview', function() {\n    let model;\n    let parentObject;\n\n    beforeEach(function() {\n        parentObject = new RB.BaseResource({\n            links: {\n                reviews: {\n                    href: '/api/foos/'\n                },\n            },\n        });\n\n        model = new RB.DraftReview({\n            parentObject: parentObject,\n        });\n        model.rspNamespace = 'foo';\n    });\n\n    describe('Methods', function() {\n        describe('ready', function() {\n            beforeEach(function() {\n                spyOn(Backbone.Model.prototype, 'fetch')\n                    .and.callFake(options => {\n                        if (options && _.isFunction(options.success)) {\n                            options.success();\n                        }\n                    });\n                spyOn(parentObject, 'ready').and.resolveTo();\n                spyOn(model, '_retrieveDraft').and.resolveTo();\n            });\n\n            it('With isNew=true', async function() {\n                expect(model.isNew()).toBe(true);\n                expect(model.get('loaded')).toBe(false);\n\n                await model.ready();\n\n                expect(parentObject.ready).toHaveBeenCalled();\n                expect(model._retrieveDraft).toHaveBeenCalled();\n            });\n\n            it('With isNew=false', async function() {\n                model.set({\n                    id: 123,\n                });\n\n                await model.ready();\n\n                expect(parentObject.ready).toHaveBeenCalled();\n                expect(model._retrieveDraft).not.toHaveBeenCalled();\n            });\n\n            it('With callbacks', function(done) {\n                expect(model.isNew()).toBe(true);\n                expect(model.get('loaded')).toBe(false);\n\n                spyOn(console, 'warn');\n\n                model.ready({\n                    success: () => {\n                        expect(parentObject.ready).toHaveBeenCalled();\n                        expect(model._retrieveDraft).toHaveBeenCalled();\n                        expect(console.warn).toHaveBeenCalled();\n\n                        done();\n                    },\n                    error: () => done.fail(),\n                });\n            });\n        });\n\n        describe('publish', function() {\n            beforeEach(function() {\n                spyOn(model, 'save').and.resolveTo();\n                spyOn(model, 'ready').and.resolveTo();\n            });\n\n            it('Triggers \"publishing\" event before publish', async function() {\n                spyOn(model, 'trigger');\n\n                await model.publish();\n                expect(model.trigger).toHaveBeenCalledWith('publishing');\n            });\n\n            it('Triggers \"published\" event after publish', async function() {\n                spyOn(model, 'trigger');\n\n                await model.publish();\n                expect(model.trigger).toHaveBeenCalledWith('published');\n            });\n\n            it('Sets \"public\" to true', async function() {\n                expect(model.get('public')).toBe(false);\n\n                await model.publish();\n                expect(model.get('public')).toBe(true);\n            });\n        });\n    });\n});\n"],"mappings":"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"}