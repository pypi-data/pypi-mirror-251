{"version":3,"file":"dashboardModel.js","names":["RB","Dashboard","DatagridPage","extend","rowObjectType","ReviewRequest","closeReviewRequests","options","reviewRequests","selection","clone","successes","failures","closeNext","length","reset","trigger","onDone","reviewRequest","shift","close","type","closeType","success","push","error","complete","bind","call","updateVisibility","visibilityFunc","hideNext","then","catch"],"sources":["../../../../../../static/rb/js/pages/models/dashboardModel.es6.js"],"sourcesContent":["/**\n * Models the dashboard and its operations.\n *\n * This will keep track of any selected review requests, and can\n * perform operations on them.\n */\nRB.Dashboard = RB.DatagridPage.extend({\n    rowObjectType: RB.ReviewRequest,\n\n    /**\n     * Close all selected review requests.\n     *\n     * This will keep track of all the successes and failures and report\n     * them back to the caller once completed.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the operation.\n     *\n     * Option Args:\n     *     closeType (string):\n     *         The close type to use (submitted or discarded).\n     *\n     *     onDone (function):\n     *         A function to call when the operation is complete.\n     */\n    closeReviewRequests(options) {\n        const reviewRequests = this.selection.clone();\n        const successes = [];\n        const failures = [];\n\n        function closeNext() {\n            if (reviewRequests.length === 0) {\n                this.selection.reset();\n                this.trigger('refresh');\n                options.onDone(successes, failures);\n                return;\n            }\n\n            const reviewRequest = reviewRequests.shift();\n\n            reviewRequest.close({\n                type: options.closeType,\n                success: () => successes.push(reviewRequest),\n                error: () => failures.push(reviewRequest),\n                complete: closeNext.bind(this),\n            });\n        }\n\n        closeNext.call(this);\n    },\n\n    /**\n     * Update the visibility of the selected review requests.\n     *\n     * This expects to be passed in a properly bound function (either\n     * addImmediately or removeImmediately) on either archivedReviewRequests or\n     * mutedReviewRequests. This will keep track of all the successes and\n     * failures, reporting them back to the caller.\n     *\n     * Args:\n     *     visibilityFunc (function):\n     *         The function to call for each review request.\n     */\n    updateVisibility(visibilityFunc) {\n        const reviewRequests = this.selection.clone();\n        const successes = [];\n        const failures = [];\n\n        function hideNext() {\n            if (reviewRequests.length === 0) {\n                this.selection.reset();\n                this.trigger('refresh');\n                return;\n            }\n\n            const reviewRequest = reviewRequests.shift();\n\n            visibilityFunc(reviewRequest)\n                .then(() => {\n                    successes.push(reviewRequest);\n                    hideNext.call(this);\n                })\n                .catch(() => {\n                    failures.push(reviewRequest);\n                    hideNext.call(this);\n                });\n        }\n\n        hideNext.call(this);\n    },\n});\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,SAAS,GAAGD,EAAE,CAACE,YAAY,CAACC,MAAM,CAAC;EAClCC,aAAa,EAAEJ,EAAE,CAACK,aAAa;EAE/B;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,mBAAmBA,CAACC,OAAO,EAAE;IACzB,MAAMC,cAAc,GAAG,IAAI,CAACC,SAAS,CAACC,KAAK,CAAC,CAAC;IAC7C,MAAMC,SAAS,GAAG,EAAE;IACpB,MAAMC,QAAQ,GAAG,EAAE;IAEnB,SAASC,SAASA,CAAA,EAAG;MACjB,IAAIL,cAAc,CAACM,MAAM,KAAK,CAAC,EAAE;QAC7B,IAAI,CAACL,SAAS,CAACM,KAAK,CAAC,CAAC;QACtB,IAAI,CAACC,OAAO,CAAC,SAAS,CAAC;QACvBT,OAAO,CAACU,MAAM,CAACN,SAAS,EAAEC,QAAQ,CAAC;QACnC;MACJ;MAEA,MAAMM,aAAa,GAAGV,cAAc,CAACW,KAAK,CAAC,CAAC;MAE5CD,aAAa,CAACE,KAAK,CAAC;QAChBC,IAAI,EAAEd,OAAO,CAACe,SAAS;QACvBC,OAAO,EAAEA,CAAA,KAAMZ,SAAS,CAACa,IAAI,CAACN,aAAa,CAAC;QAC5CO,KAAK,EAAEA,CAAA,KAAMb,QAAQ,CAACY,IAAI,CAACN,aAAa,CAAC;QACzCQ,QAAQ,EAAEb,SAAS,CAACc,IAAI,CAAC,IAAI;MACjC,CAAC,CAAC;IACN;IAEAd,SAAS,CAACe,IAAI,CAAC,IAAI,CAAC;EACxB,CAAC;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,gBAAgBA,CAACC,cAAc,EAAE;IAC7B,MAAMtB,cAAc,GAAG,IAAI,CAACC,SAAS,CAACC,KAAK,CAAC,CAAC;IAC7C,MAAMC,SAAS,GAAG,EAAE;IACpB,MAAMC,QAAQ,GAAG,EAAE;IAEnB,SAASmB,QAAQA,CAAA,EAAG;MAChB,IAAIvB,cAAc,CAACM,MAAM,KAAK,CAAC,EAAE;QAC7B,IAAI,CAACL,SAAS,CAACM,KAAK,CAAC,CAAC;QACtB,IAAI,CAACC,OAAO,CAAC,SAAS,CAAC;QACvB;MACJ;MAEA,MAAME,aAAa,GAAGV,cAAc,CAACW,KAAK,CAAC,CAAC;MAE5CW,cAAc,CAACZ,aAAa,CAAC,CACxBc,IAAI,CAAC,MAAM;QACRrB,SAAS,CAACa,IAAI,CAACN,aAAa,CAAC;QAC7Ba,QAAQ,CAACH,IAAI,CAAC,IAAI,CAAC;MACvB,CAAC,CAAC,CACDK,KAAK,CAAC,MAAM;QACTrB,QAAQ,CAACY,IAAI,CAACN,aAAa,CAAC;QAC5Ba,QAAQ,CAACH,IAAI,CAAC,IAAI,CAAC;MACvB,CAAC,CAAC;IACV;IAEAG,QAAQ,CAACH,IAAI,CAAC,IAAI,CAAC;EACvB;AACJ,CAAC,CAAC"}