{"version":3,"file":"fileAttachmentThumbnailViewTests.js","names":["suite","reviewRequest","model","view","beforeEach","RB","ReviewRequest","FileAttachment","downloadURL","filename","spyOn","and","callThrough","describe","expectElements","expect","$","length","toBe","options","canEdit","get","expectAttributeMatches","attr","text","it","$el","addClass","FileAttachmentThumbnail","prototype","className","html","template","_","defaults","caption","captionClass","attributes","set","renderThumbnail","el","$testsScratch","append","render","is","children","id","url","_captionEditorView","startEdit","trigger","toHaveBeenCalledWith","cancel","done","callFake","save","toHaveBeenCalled","val","triggerHandler","submit","success","ajax","destroy","calls","argsFor","fadeOut","click"],"sources":["../../../../../../static/rb/js/views/tests/fileAttachmentThumbnailViewTests.es6.js"],"sourcesContent":["suite('rb/views/FileAttachmentThumbnail', function() {\n    let reviewRequest;\n    let model;\n    let view;\n\n    beforeEach(function() {\n        reviewRequest = new RB.ReviewRequest();\n        model = new RB.FileAttachment({\n            downloadURL: 'http://example.com/file.png',\n            filename: 'file.png',\n        });\n\n        spyOn(model, 'trigger').and.callThrough();\n    });\n\n    describe('Rendering', function() {\n        function expectElements() {\n            expect(view.$('a.edit').length).toBe(1);\n            expect(view.$('.file-caption').length).toBe(1);\n            expect(view.$('.file-actions').length).toBe(1);\n            expect(view.$('.file-delete').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n            expect(view.$('.file-update').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n        }\n\n        function expectAttributeMatches() {\n            expect(view.$('.file-download').attr('href')).toBe(\n                model.get('downloadURL'));\n            expect(view.$('.file-caption .edit').text()).toBe(\n                model.get('caption'));\n        }\n\n        it('Using existing elements', function() {\n            const $el = $('<div/>')\n                .addClass(RB.FileAttachmentThumbnail.prototype.className)\n                .html(RB.FileAttachmentThumbnail.prototype.template(\n                    _.defaults({\n                        caption: 'No caption',\n                        captionClass: 'edit empty-caption',\n                    }, model.attributes)));\n\n            model.set('loaded', true);\n\n            view = new RB.FileAttachmentThumbnail({\n                renderThumbnail: true,\n                reviewRequest: reviewRequest,\n                el: $el,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').is(':visible')).toBe(true);\n            expect(view.$('.fa-spinner').length).toBe(0);\n        });\n\n        it('Rendered thumbnail with unloaded model', function() {\n            view = new RB.FileAttachmentThumbnail({\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').children().length).toBe(0);\n            expect(view.$('.fa-spinner').length).toBe(1);\n        });\n\n        describe('Rendered thumbnail with loaded model', function() {\n            beforeEach(function() {\n                model.id = 123;\n                model.attributes.id = 123;\n                model.set('caption', 'My Caption');\n                model.set('loaded', true);\n                model.url = '/api/file-attachments/123/';\n            });\n\n            it('With review UI', function() {\n                model.set('reviewURL', '/review/');\n\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(1);\n                expect(view.$('.file-add-comment').length).toBe(0);\n            });\n\n            it('No review UI', function() {\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(0);\n                expect(view.$('.file-add-comment').length).toBe(1);\n            });\n        });\n    });\n\n    describe('Actions', function() {\n        beforeEach(function() {\n            model.id = 123;\n            model.attributes.id = 123;\n            model.set('loaded', true);\n            model.url = '/api/file-attachments/123/';\n\n            view = new RB.FileAttachmentThumbnail({\n                canEdit: true,\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            spyOn(view, 'trigger').and.callThrough();\n        });\n\n        it('Begin caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n        });\n\n        it('Cancel caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view._captionEditorView.cancel();\n            expect(view.trigger).toHaveBeenCalledWith('endEdit');\n        });\n\n        it('Save caption', function(done) {\n            spyOn(model, 'save').and.callFake(() => {\n                expect(view.trigger).toHaveBeenCalledWith('endEdit');\n                expect(model.get('caption')).toBe('Foo');\n                expect(model.save).toHaveBeenCalled();\n\n                done();\n            });\n\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view.$('input')\n                .val('Foo')\n                .triggerHandler('keyup');\n\n            view._captionEditorView.submit();\n        });\n\n        it('Delete', function(done) {\n            spyOn(model, 'destroy').and.callThrough();\n            spyOn($, 'ajax').and.callFake(options => options.success());\n            spyOn(view.$el, 'fadeOut').and.callFake(done => done());\n            spyOn(view, 'remove').and.callFake(() => {\n                expect($.ajax).toHaveBeenCalled();\n                expect(model.destroy).toHaveBeenCalled();\n                expect(model.trigger.calls.argsFor(2)[0]).toBe('destroying');\n                expect(view.$el.fadeOut).toHaveBeenCalled();\n\n                done();\n            });\n\n            view.$('.file-delete').click();\n        });\n    });\n});\n"],"mappings":"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"}