{"version":3,"file":"draftReviewModelTests.js","names":["suite","model","parentObject","beforeEach","RB","BaseResource","links","reviews","href","DraftReview","rspNamespace","describe","callbacks","ready","success","error","spyOn","Backbone","Model","prototype","and","callFake","options","_","isFunction","context","call","expect","isNew","toBe","get","it","toHaveBeenCalled","_retrieveDraft","set","id","not","publish","trigger","toHaveBeenCalledWith"],"sources":["draftReviewModelTests.es6.js"],"sourcesContent":["suite('rb/resources/models/DraftReview', function() {\n    let model;\n    let parentObject;\n\n    beforeEach(function() {\n        parentObject = new RB.BaseResource({\n            links: {\n                reviews: {\n                    href: '/api/foos/'\n                },\n            },\n        });\n\n        model = new RB.DraftReview({\n            parentObject: parentObject,\n        });\n        model.rspNamespace = 'foo';\n    });\n\n    describe('Methods', function() {\n        let callbacks;\n\n        beforeEach(function() {\n            callbacks = {\n                ready: function() {},\n                success: function() {},\n                error: function() {},\n            };\n\n            spyOn(callbacks, 'ready');\n            spyOn(callbacks, 'success');\n            spyOn(callbacks, 'error');\n        });\n\n        describe('ready', function() {\n            beforeEach(function() {\n                spyOn(Backbone.Model.prototype, 'fetch')\n                    .and.callFake(options => {\n                        if (options && _.isFunction(options.success)) {\n                            options.success();\n                        }\n                    });\n                spyOn(parentObject, 'ready')\n                    .and.callFake((options, context) => {\n                        if (options && _.isFunction(options.ready)) {\n                            options.ready.call(context);\n                        }\n                    });\n                spyOn(model, '_retrieveDraft')\n                    .and.callFake((options, context) => {\n                        if (options && _.isFunction(options.ready)) {\n                            options.ready.call(context);\n                        }\n                    });\n            });\n\n            describe('With isNew=true', function() {\n                beforeEach(function() {\n                    expect(model.isNew()).toBe(true);\n                    expect(model.get('loaded')).toBe(false);\n                });\n\n                it('With callbacks', function() {\n                    model.ready(callbacks);\n\n                    expect(parentObject.ready).toHaveBeenCalled();\n                    expect(model._retrieveDraft).toHaveBeenCalled();\n                    expect(callbacks.ready).toHaveBeenCalled();\n                });\n            });\n\n            describe('With isNew=false', function() {\n                beforeEach(function() {\n                    model.set({\n                        id: 123,\n                    });\n                });\n\n                it('With callbacks', function() {\n                    model.ready(callbacks);\n\n                    expect(parentObject.ready).toHaveBeenCalled();\n                    expect(model._retrieveDraft).not.toHaveBeenCalled();\n                    expect(callbacks.ready).toHaveBeenCalled();\n                });\n            });\n        });\n\n        describe('publish', function() {\n            beforeEach(function() {\n                spyOn(model, 'save').and.callFake((options, context) => {\n                    options.success.call(context);\n                });\n            });\n\n            it('Triggers \"publishing\" event before publish', function() {\n                spyOn(model, 'trigger');\n                spyOn(model, 'ready');\n\n                model.publish();\n\n                expect(model.trigger).toHaveBeenCalledWith('publishing');\n            });\n\n            it('Triggers \"published\" event after publish', function() {\n                spyOn(model, 'trigger');\n\n                spyOn(model, 'ready').and.callFake((options, context) => {\n                    options.ready.call(context);\n                });\n\n                model.publish(callbacks);\n\n                expect(callbacks.success).toHaveBeenCalled();\n                expect(model.trigger).toHaveBeenCalledWith('published');\n            });\n\n            it('Sets \"public\" to true', function() {\n                spyOn(model, 'ready').and.callFake((options, context) => {\n                    options.ready.call(context);\n                });\n\n                expect(model.get('public')).toBe(false);\n\n                model.publish(callbacks);\n\n                expect(callbacks.success).toHaveBeenCalled();\n                expect(model.get('public')).toBe(true);\n            });\n        });\n    });\n});\n"],"mappings":"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"}