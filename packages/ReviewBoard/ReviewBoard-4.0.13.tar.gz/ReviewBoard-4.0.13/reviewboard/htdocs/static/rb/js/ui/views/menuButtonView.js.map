{"version":3,"file":"menuButtonView.js","names":["RB","MenuButtonView","Backbone","View","extend","className","events","template","_","initialize","options","arguments","length","undefined","_ariaMenuLabel","ariaMenuLabel","gettext","_menuItems","menuItems","_menuType","menuType","MenuView","TYPE_STANDARD_MENU","_buttonText","text","_buttonOnClick","onPrimaryButtonClick","_hasPrimaryButton","hasPrimaryButton","menu","$primaryButton","_$buttonGroup","_openDirection","remove","prototype","call","render","labelID","uniqueId","$el","addClass","attr","html","buttonText","menuLabel","$","on","bind","console","assert","_$dropDownButton","ariaLabelledBy","$controller","type","listenTo","_updateMenuPosition","removeClass","i","addItem","appendTo","$button","buttonY1","offset","top","buttonY2","innerHeight","pageY1","window","pageYOffset","pageY2","direction","menuHeight","outerHeight","toggleClass","css","_openMenu","open","_closeMenu","close","_onFocusOut","evt","stopPropagation","currentTarget","contains","relatedTarget","animate","_onToggleButtonKeyDown","which","ui","keyCode","DOWN","RETURN","SPACE","UP","focusLastItem","focusFirstItem","ESCAPE"],"sources":["menuButtonView.es6.js"],"sourcesContent":["/**\n * A button that offers a drop-down menu when clicked.\n *\n * Menu buttons have the appearance of a button with a drop-down indicator.\n * When clicked, they display a menu either below or above the button\n * (depending on their position on the screen).\n *\n * They may also be grouped into two buttons, one primary button (which works\n * as a standard, independent button) and one drop-down button (which works\n * as above, but just shows the drop-down indicator).\n *\n * Version Added:\n *     4.0\n *\n * Attributes:\n *     $primaryButton (jQuery):\n *         The primary button, if one is configured separate from the drop-down\n *         button.\n *\n *     menu (RB.MenuView):\n *         The menu associated with the button.\n */\nRB.MenuButtonView = Backbone.View.extend({\n    className: 'rb-c-menu-button',\n\n    events: {\n        'mouseenter .rb-c-menu-button__toggle': '_openMenu',\n        'focusout': '_onFocusOut',\n        'mouseleave': '_closeMenu',\n        'keydown .rb-c-menu-button__toggle': '_onToggleButtonKeyDown',\n    },\n\n    template: _.template(dedent`\n        <% if (hasPrimaryButton) { %>\n         <div class=\"rb-c-button-group\" role=\"group\">\n          <button class=\"rb-c-menu-button__primary rb-c-button\"\n                  type=\"button\"><%- buttonText %></button>\n          <button class=\"rb-c-menu-button__toggle rb-c-button\"\n                  id=\"<%- labelID %>\"\n                  type=\"button\"\n                  aria-label=\"<%- menuLabel %>\">\n           <span class=\"rb-icon rb-icon-dropdown-arrow\"></span>\n          </button>\n         </div>\n        <% } else { %>\n         <button class=\"rb-c-button rb-c-menu-button__toggle\"\n                 id=\"<%- labelID %>\"\n                 type=\"button\">\n          <%- buttonText %>\n          <span class=\"rb-icon rb-icon-dropdown-arrow\"></span>\n         </button>\n        <% } %>\n    `),\n\n    /**\n     * Initialize the menu button.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     ariaMenuLabel (string, optional):\n     *         A descriptive label for the drop-down menu, for screen readers.\n     *         This is only needed if a primary button was added. Otherwise,\n     *         ``text`` is used as the label.\n     *\n     *     hasPrimaryButton (boolean, optional):\n     *         Whether there should be a primary button separate from the\n     *         drop-down button.\n     *\n     *     menuItems (Array of object, optional):\n     *         A list of menu items. Each will be passed to\n     *         :js:meth:`RB.MenuView.prototype.addItem`. If not provided,\n     *         explicit items should be added to the menu.\n     *\n     *     menuType (number, optional):\n     *         The type of menu to use. If provided, this must be one of\n     *         :js:attr:`RB.MenuView.TYPE_STANDARD_MENU` or\n     *         :js:attr:`RB.MenuView.TYPE_BUTTON_MENU`. If not provided,\n     *         this will be a standard menu.\n     *\n     *     onPrimaryButtonClick (function, optional):\n     *         The handler for click events on the primary button. If set,\n     *         this implies ``hasPrimaryButton: true``.\n     *\n     *     text (string):\n     *         The text shown on the button.\n     */\n    initialize(options={}) {\n        this._ariaMenuLabel = options.ariaMenuLabel || gettext('More options');\n        this._menuItems = options.menuItems || [];\n        this._menuType = options.menuType || RB.MenuView.TYPE_STANDARD_MENU;\n        this._buttonText = options.text;\n        this._buttonOnClick = options.onPrimaryButtonClick;\n        this._hasPrimaryButton = (!!this._buttonOnClick ||\n                                  options.hasPrimaryButton);\n\n        this.menu = null;\n        this.$primaryButton = null;\n\n        this._$buttonGroup = null;\n        this._openDirection = 'down';\n    },\n\n    /**\n     * Remove the view from the DOM.\n     */\n    remove() {\n        this.menu.remove();\n\n        Backbone.View.prototype.remove.call(this);\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.MenuButtonView:\n     *     This object, for chaining.\n     */\n    render() {\n        const labelID = _.uniqueId('__rb-menubuttonview__label');\n        const hasPrimaryButton = this._hasPrimaryButton;\n\n        this.$el\n            .addClass(this.className)\n            .attr('role', 'group')\n            .html(this.template({\n                buttonText: this._buttonText,\n                hasPrimaryButton: hasPrimaryButton,\n                labelID: labelID,\n                menuLabel: this._ariaMenuLabel,\n            }));\n\n        if (hasPrimaryButton) {\n            this.$primaryButton = this.$('.rb-c-menu-button__primary')\n                .on('click', this._buttonOnClick.bind(this));\n            console.assert(this.$primaryButton.length === 1);\n        }\n\n        this._$dropDownButton = this.$('.rb-c-menu-button__toggle');\n        console.assert(this._$dropDownButton.length === 1);\n\n        /* Create and populate the drop-down menu. */\n        const menu = new RB.MenuView({\n            ariaLabelledBy: labelID,\n            $controller: this._$dropDownButton,\n            type: this._menuType,\n        });\n        menu.render();\n\n        this.listenTo(menu, 'opening', () => {\n            this._$dropDownButton.addClass('js-hover');\n            this._updateMenuPosition();\n        });\n\n        this.listenTo(menu, 'closing', () => {\n            this._$dropDownButton.removeClass('js-hover');\n        });\n\n        for (let i = 0; i < this._menuItems.length; i++) {\n            menu.addItem(this._menuItems[i]);\n        }\n\n        menu.$el.appendTo(this.$el);\n\n        this.menu = menu;\n\n        return this;\n    },\n\n    /**\n     * Position the drop-down menu above or below the button.\n     *\n     * This will attempt to determine whether there's enough space below\n     * the button for the menu to fully appear. If there is not, then the\n     * menu will appear above the button instead.\n     *\n     * The resulting direction will also impact the styling of the button and\n     * menu, helping to create a connected appearance.\n     */\n    _updateMenuPosition() {\n        const $button = this._$dropDownButton;\n        const buttonY1 = $button.offset().top;\n        const buttonY2 = buttonY1 + $button.innerHeight();\n        const pageY1 = window.pageYOffset;\n        const pageY2 = window.pageYOffset + window.innerHeight;\n        let direction;\n\n        if (pageY1 >= buttonY1) {\n            /*\n             * The button is at least partially off-screen, above the current\n             * viewport. Drop the menu down.\n             */\n            direction = 'down';\n        } else if (pageY2 <= buttonY2) {\n            /*\n             * The button is at least partially off-screen, below the current\n             * viewport. Drop the menu up.\n             */\n            direction = 'up';\n        } else {\n            const menuHeight = this.menu.$el.outerHeight();\n\n            /*\n             * The button is fully on-screen. See if there's enough room below\n             * the button for the menu.\n             */\n            if (pageY2 >= buttonY2 + menuHeight) {\n                /* The menu can fully fit below the button. */\n                direction = 'down';\n            } else {\n                /* The menu cannot fully fit below the button. */\n                direction = 'up';\n            }\n        }\n\n        this._openDirection = direction;\n\n        this.$el.toggleClass('-opens-up', direction === 'up');\n        this.menu.$el.css(direction === 'down' ? 'top' : 'bottom',\n                          $button.innerHeight());\n    },\n\n    /**\n     * Show the menu.\n     *\n     * Args:\n     *     options (object):\n     *         Options to pass to :js:meth:`RB.MenuView.prototype.open`.\n     */\n    _openMenu(options) {\n        this.menu.open(options);\n    },\n\n    /**\n     * Close the menu.\n     *\n     * Args:\n     *     options (object):\n     *         Options to pass to :js:meth:`RB.MenuView.prototype.close`.\n     */\n    _closeMenu(options) {\n        this.menu.close(options);\n    },\n\n    /**\n     * Handle a focus-out event.\n     *\n     * This will immediately hide the menu, if the newly-focused item is\n     * not a child of this view.\n     *\n     * Args:\n     *     evt (jQuery.Event):\n     *         The focus-in event.\n     */\n    _onFocusOut(evt) {\n        evt.stopPropagation();\n\n        /*\n         * Only close the menu if focus has moved to something outside of\n         * this component.\n         */\n        if (!evt.currentTarget.contains(evt.relatedTarget)) {\n            this._closeMenu({\n                animate: false,\n            });\n        }\n    },\n\n    /**\n     * Handle a keydown event.\n     *\n     * When the drop-down button has focus, this will take care of handling\n     * keyboard-based navigation, allowing the menu to be opened or closed.\n     * Opening the menu will transfer focus to the menu items.\n     *\n     * Args:\n     *     evt (jQuery.Event):\n     *         The keydown event.\n     *\n     * Returns:\n     *     boolean:\n     *     ``True`` if the event was handled explicitly by the menu button.\n     *     ``False`` if it should bubble up or invoke default behavior.\n     */\n    _onToggleButtonKeyDown(evt) {\n        switch (evt.which) {\n            case $.ui.keyCode.DOWN:\n            case $.ui.keyCode.RETURN:\n            case $.ui.keyCode.SPACE:\n            case $.ui.keyCode.UP:\n                this._openMenu({\n                    animate: false,\n                });\n\n                if (this._openDirection === 'up') {\n                    this.menu.focusLastItem();\n                } else if (this._openDirection === 'down') {\n                    this.menu.focusFirstItem();\n                }\n\n                return false;\n\n            case $.ui.keyCode.ESCAPE:\n                this._closeMenu({\n                    animate: false,\n                });\n                return false;\n        }\n    },\n});\n"],"mappings":"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"}