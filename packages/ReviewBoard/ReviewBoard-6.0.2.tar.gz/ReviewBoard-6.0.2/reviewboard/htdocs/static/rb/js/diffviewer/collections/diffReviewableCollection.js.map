{"version":3,"file":"diffReviewableCollection.js","names":["RB","DiffReviewableCollection","Backbone","Collection","extend","model","DiffReviewable","initialize","models","options","reviewRequest","watchFiles","files","listenTo","_populateFromFiles","console","assert","reset","trigger","each","file","filediff","get","interfilediff","interdiffRevision","revision","add","baseFileDiffID","fileDiffID","id","interFileDiffID","public","serializedCommentBlocks"],"sources":["../../../../../../static/rb/js/diffviewer/collections/diffReviewableCollection.es6.js"],"sourcesContent":["/**\n * A collection of RB.DiffReviewable instances.\n *\n * This manages a collection of :js:class:`RB.DiffReviewable`s and can\n * populate itself based on changes to a collection of files.\n *\n * When repopulating, this will emit a ``populating`` event. After populating,\n * it will emit a ``populated`` event.\n */\nRB.DiffReviewableCollection = Backbone.Collection.extend({\n    model: RB.DiffReviewable,\n\n    /**\n     * Initialize the collection.\n     *\n     * Args:\n     *     models (Array):\n     *         Optional array of models.\n     *\n     *     options (object):\n     *         Options for the collection.\n     *\n     * Option Args:\n     *     reviewRequest (RB.ReviewRequest):\n     *         The review request for the collection. This must be provided.\n     */\n    initialize(models, options) {\n        this.reviewRequest = options.reviewRequest;\n    },\n\n    /**\n     * Watch for changes to a collection of files.\n     *\n     * When the files change (and when invoking this method), this collection\n     * will be rebuilt based on those files.\n     *\n     * Args:\n     *     files (RB.DiffFileCollection):\n     *         The collection of files to watch.\n     */\n    watchFiles(files) {\n        this.listenTo(files, 'reset', () => this._populateFromFiles(files));\n        this._populateFromFiles(files);\n    },\n\n    /**\n     * Populate this collection from a collection of files.\n     *\n     * This will clear this collection and then loop through each file,\n     * adding a corresponding :js:class:`RB.DiffReviewable`.\n     *\n     * After clearing, but prior to adding any entries, this will emit a\n     * ``populating`` event. After all reviewables have been added, this\n     * will emit a ``populated`` event.\n     *\n     * Args:\n     *     files (RB.DiffFileCollection):\n     *         The collection of files to populate from.\n     */\n    _populateFromFiles(files) {\n        const reviewRequest = this.reviewRequest;\n\n        console.assert(reviewRequest,\n                       'RB.DiffReviewableCollection.reviewRequest must be set');\n\n        this.reset();\n        this.trigger('populating');\n\n        files.each(file => {\n            const filediff = file.get('filediff');\n            const interfilediff = file.get('interfilediff');\n            let interdiffRevision = null;\n\n            if (interfilediff) {\n                interdiffRevision = interfilediff.revision;\n            } else if (file.get('forceInterdiff')) {\n                interdiffRevision = file.get('forceInterdiffRevision');\n            }\n\n            this.add({\n                baseFileDiffID: file.get('baseFileDiffID'),\n                reviewRequest: reviewRequest,\n                file: file,\n                fileDiffID: filediff.id,\n                interFileDiffID: interfilediff ? interfilediff.id : null,\n                revision: filediff.revision,\n                interdiffRevision: interdiffRevision,\n                public: file.get('public'),\n                serializedCommentBlocks: file.get('commentCounts'),\n            });\n        });\n\n        this.trigger('populated');\n    },\n});\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,wBAAwB,GAAGC,QAAQ,CAACC,UAAU,CAACC,MAAM,CAAC;EACrDC,KAAK,EAAEL,EAAE,CAACM,cAAc;EAExB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,UAAU,CAACC,MAAM,EAAEC,OAAO,EAAE;IACxB,IAAI,CAACC,aAAa,GAAGD,OAAO,CAACC,aAAa;EAC9C,CAAC;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,UAAU,CAACC,KAAK,EAAE;IACd,IAAI,CAACC,QAAQ,CAACD,KAAK,EAAE,OAAO,EAAE,MAAM,IAAI,CAACE,kBAAkB,CAACF,KAAK,CAAC,CAAC;IACnE,IAAI,CAACE,kBAAkB,CAACF,KAAK,CAAC;EAClC,CAAC;EAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIE,kBAAkB,CAACF,KAAK,EAAE;IACtB,MAAMF,aAAa,GAAG,IAAI,CAACA,aAAa;IAExCK,OAAO,CAACC,MAAM,CAACN,aAAa,EACb,uDAAuD,CAAC;IAEvE,IAAI,CAACO,KAAK,EAAE;IACZ,IAAI,CAACC,OAAO,CAAC,YAAY,CAAC;IAE1BN,KAAK,CAACO,IAAI,CAACC,IAAI,IAAI;MACf,MAAMC,QAAQ,GAAGD,IAAI,CAACE,GAAG,CAAC,UAAU,CAAC;MACrC,MAAMC,aAAa,GAAGH,IAAI,CAACE,GAAG,CAAC,eAAe,CAAC;MAC/C,IAAIE,iBAAiB,GAAG,IAAI;MAE5B,IAAID,aAAa,EAAE;QACfC,iBAAiB,GAAGD,aAAa,CAACE,QAAQ;MAC9C,CAAC,MAAM,IAAIL,IAAI,CAACE,GAAG,CAAC,gBAAgB,CAAC,EAAE;QACnCE,iBAAiB,GAAGJ,IAAI,CAACE,GAAG,CAAC,wBAAwB,CAAC;MAC1D;MAEA,IAAI,CAACI,GAAG,CAAC;QACLC,cAAc,EAAEP,IAAI,CAACE,GAAG,CAAC,gBAAgB,CAAC;QAC1CZ,aAAa,EAAEA,aAAa;QAC5BU,IAAI,EAAEA,IAAI;QACVQ,UAAU,EAAEP,QAAQ,CAACQ,EAAE;QACvBC,eAAe,EAAEP,aAAa,GAAGA,aAAa,CAACM,EAAE,GAAG,IAAI;QACxDJ,QAAQ,EAAEJ,QAAQ,CAACI,QAAQ;QAC3BD,iBAAiB,EAAEA,iBAAiB;QACpCO,MAAM,EAAEX,IAAI,CAACE,GAAG,CAAC,QAAQ,CAAC;QAC1BU,uBAAuB,EAAEZ,IAAI,CAACE,GAAG,CAAC,eAAe;MACrD,CAAC,CAAC;IACN,CAAC,CAAC;IAEF,IAAI,CAACJ,OAAO,CAAC,WAAW,CAAC;EAC7B;AACJ,CAAC,CAAC"}