{"version":3,"file":"draftReviewBannerView.js","names":["RB","DraftReviewBannerView","Backbone","View","extend","events","initialize","options","render","_$buttons","$","_$banner","model","listenTo","prop","errorText","alert","_publishButton","MenuButtonView","ariaMenuLabel","el","id","menuItems","onClick","_onPublishClicked","publishToOwnerOnly","text","publishAndArchive","onPrimaryButtonClick","$el","show","addClass","height","outerHeight","scrollManager","markForUpdate","removeClass","css","maxHeight","scrollYOffset","markUpdated","hide","_","delay","hideAndReload","defer","navigateTo","get","getHeight","remove","_super","call","_onEditReviewClicked","ReviewDialogView","create","review","reviewRequestEditor","set","publish","attrs","_onDiscardClicked","modalBox","buttons","val","click","destroy","title","instance"],"sources":["../../../../../static/rb/js/views/draftReviewBannerView.es6.js"],"sourcesContent":["/**\n * A banner that represents a pending draft review.\n *\n * The banner displays at the top of the page and provides buttons for\n * editing the review, publishing, and discarding.\n *\n * The banner is a singleton. There's only ever one at a time.\n */\nRB.DraftReviewBannerView = Backbone.View.extend({\n    events: {\n        'click #review-banner-discard': '_onDiscardClicked',\n        'click #review-banner-edit': '_onEditReviewClicked',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     reviewRequestEditor (RB.ReviewRequestEditor):\n     *         The review request editor.\n     */\n    initialize(options) {\n        this.options = options;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.DraftReviewBannerView:\n     *     This object, for chaining.\n     */\n    render() {\n        this._$buttons = this.$('input');\n        this._$banner = this.$('.banner');\n\n        const model = this.model;\n        this.listenTo(model, 'saving destroying',\n                      () => this._$buttons.prop('disabled', true));\n        this.listenTo(model, 'saved destroyed',\n                      () => this._$buttons.prop('disabled', false));\n        this.listenTo(model, 'publishError', errorText => alert(errorText));\n\n        this._publishButton = new RB.MenuButtonView({\n            ariaMenuLabel: gettext('More publishing options'),\n            el: this.$('#review-banner-publish-container'),\n            id: 'review-banner-publish',\n            menuItems: [\n                {\n                    id: 'review-banner-publish-submitter-only',\n                    onClick: () => this._onPublishClicked({\n                        publishToOwnerOnly: true,\n                    }),\n                    text: _`... and only e-mail the owner`,\n                },\n                {\n                    id: 'review-banner-publish-and-archive',\n                    onClick: () => this._onPublishClicked({\n                        publishAndArchive: true,\n                    }),\n                    text: _`... and archive the review request`,\n                },\n            ],\n            onPrimaryButtonClick: () => this._onPublishClicked(),\n            text: gettext('Publish Review'),\n        });\n\n        this._publishButton.render();\n\n        if (!this.$el.prop('hidden')) {\n            this.show();\n        }\n\n        this.$el.addClass('ui-ready');\n\n        return this;\n    },\n\n    /*\n     * Show the banner.\n     *\n     * The banner will appear to slide down from the top of the page.\n     */\n    show() {\n        const height = this._$banner.outerHeight();\n\n        RB.scrollManager.markForUpdate(this.$el);\n\n        this.$el\n            .prop('hidden', false)\n            .removeClass('hidden')\n            .css({\n                height: height,\n                maxHeight: height,\n            });\n        RB.scrollManager.scrollYOffset += height;\n        RB.scrollManager.markUpdated(this.$el);\n    },\n\n    /*\n     * Hide the banner.\n     *\n     * The banner will slide up to the top of the page.\n     */\n    hide() {\n        RB.scrollManager.markForUpdate(this.$el);\n\n        const height = this._$banner.outerHeight();\n\n        this.$el\n            .prop('hidden', true)\n            .addClass('hidden')\n            .css('max-height', '');\n\n        /*\n         * If we set the height immediately, the browser will appear to not\n         * animate, since it can't transition heights (only max-heights). So\n         * we delay for a short period after we know the transition will have\n         * completed.\n         */\n        _.delay(\n            () => {\n                this.$el.css('height', '');\n                RB.scrollManager.markUpdated(this.$el);\n                RB.scrollManager.scrollYOffset -= height;\n            },\n            500);\n    },\n\n    /**\n     * Hide the banner and reloads the page.\n     *\n     * XXX Remove this function when we make the pages more dynamic.\n     */\n    hideAndReload() {\n        this.hide();\n\n        /*\n         * hideAndReload might have been called from within a $.funcQueue.\n         * With Firefox, later async functions that are queued in the\n         * $.funcQueue will not run when we change window.location, which\n         * means that we might miss out on some teardown that was\n         * scheduled. We defer changing the location until the next tick\n         * of the event loop to let any teardown occur.\n         */\n        _.defer(() => {\n            RB.navigateTo(this.model.get('parentObject').get('reviewURL'));\n        });\n    },\n\n    /**\n     * Return the height of the banner.\n     *\n     * Returns:\n     *     number:\n     *     The height of the banner.\n     */\n    getHeight() {\n        return this._$banner.outerHeight();\n    },\n\n    /**\n     * Remove the banner from the page.\n     */\n    remove() {\n        if (this._publishButton) {\n            this._publishButton.remove();\n        }\n\n        _super(this).remove.call(this);\n    },\n\n    /**\n     * Handler for the Edit Review button.\n     *\n     * Displays the review editor dialog.\n     *\n     * Returns:\n     *     boolean:\n     *     false, always.\n     */\n    _onEditReviewClicked() {\n        RB.ReviewDialogView.create({\n            review: this.model,\n            reviewRequestEditor: this.options.reviewRequestEditor,\n        });\n\n        return false;\n    },\n\n    /**\n     * Handler for the Publish button.\n     *\n     * Publishes the review.\n     *\n     * Args:\n     *     options (object):\n     *         Options that determine special cases for submission.\n     *\n     * Option Args:\n     *     publishToOwnerOnly (boolean):\n     *         Whether or not we should only notify the submitter of the\n     *         review.\n     *\n     *     publishAndArchive (boolean):\n     *         Whether or not we should archive the review after it is\n     *         published.\n     *\n     * Returns:\n     *     boolean:\n     *     false, always.\n     */\n    _onPublishClicked(options={}) {\n        if (options.publishToOwnerOnly) {\n            this.model.set('publishToOwnerOnly', true);\n        }\n\n        if (options.publishAndArchive) {\n            this.model.set('publishAndArchive', true);\n        }\n\n        this.model.publish({\n            attrs: ['public', 'publishToOwnerOnly', 'publishAndArchive'],\n        });\n\n        return false;\n    },\n\n    /**\n     * Handler for the Discard button.\n     *\n     * Prompts the user to confirm that they want the review discarded.\n     * If they confirm, the review will be discarded.\n     *\n     * Returns:\n     *     boolean:\n     *     false, always.\n     */\n    _onDiscardClicked() {\n        $('<p>')\n            .text(_`If you discard this review, all related comments will be permanently deleted.`)\n            .modalBox({\n                buttons: [\n                    $('<input type=\"button\">')\n                        .val(_`Cancel`),\n                    $('<input type=\"button\">')\n                        .val(_`Discard`)\n                        .click(() => this.model.destroy()),\n                ],\n                title: _`'Are you sure you want to discard this review?`,\n            });\n\n        return false;\n    },\n}, {\n    instance: null,\n\n    /**\n     * Create the draft review banner singleton.\n     *\n     * Returns:\n     *     RB.DraftReviewBannerView:\n     *     The banner view.\n     */\n    create(options) {\n        if (!this.instance) {\n            this.instance = new RB.DraftReviewBannerView(options);\n            this.instance.render();\n        }\n\n        return this.instance;\n    },\n});\n"],"mappings":"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"}