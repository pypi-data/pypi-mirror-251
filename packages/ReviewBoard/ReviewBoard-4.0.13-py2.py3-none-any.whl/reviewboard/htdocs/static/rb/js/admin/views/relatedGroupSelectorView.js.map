{"version":3,"file":"relatedGroupSelectorView.js","names":["optionTemplate","_","template","RB","RelatedGroupSelectorView","Djblets","RelatedObjectSelectorView","extend","searchPlaceholderText","gettext","initialize","options","prototype","call","defaults","selectizeOptions","searchField","sortField","field","valueField","_localSitePrefix","localSitePrefix","_inviteOnly","inviteOnly","renderOption","item","loadOptions","query","callback","params","displayname","length","q","$","ajax","type","url","SITE_ROOT","data","success","results","groups","filter","obj","invite_only","map","u","name","display_name","id","error","_len","arguments","args","Array","_key","console"],"sources":["relatedGroupSelectorView.es6.js"],"sourcesContent":["(function() {\n\n\nconst optionTemplate = _.template(dedent`\n    <div>\n     <span class=\"title\"><%- name %> : <%- display_name %></span>\n    </div>\n`);\n\n\n/**\n * A widget to select related groups using search and autocomplete.\n */\nRB.RelatedGroupSelectorView = Djblets.RelatedObjectSelectorView.extend({\n    searchPlaceholderText: gettext('Search for groups...'),\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     localSitePrefix (string):\n     *         The URL prefix for the local site, if any.\n     *\n     *     multivalued (boolean):\n     *         Whether or not the widget should allow selecting multuple\n     *         values.\n     *\n     *     inviteOnly (boolean):\n     *         Whether or not we want to only search for inviteOnly review\n     *         groups.\n     */\n    initialize(options) {\n        Djblets.RelatedObjectSelectorView.prototype.initialize.call(\n            this,\n            _.defaults({\n                selectizeOptions: {\n                    searchField: ['name', 'display_name'],\n                    sortField: [\n                        {field: 'name'},\n                        {field: 'display_name'},\n                    ],\n                    valueField: 'name',\n                }\n            }, options));\n\n        this._localSitePrefix = options.localSitePrefix || '';\n        this._inviteOnly = options.inviteOnly;\n    },\n\n    /**\n     * Render an option in the drop-down menu.\n     *\n     * Args:\n     *     item (object):\n     *         The item to render.\n     *\n     * Returns:\n     *     string:\n     *     HTML to insert into the drop-down menu.\n     */\n    renderOption(item) {\n        return optionTemplate(item);\n    },\n\n    /**\n     * Load options from the server.\n     *\n     * Args:\n     *     query (string):\n     *         The string typed in by the user.\n     *\n     *     callback (function):\n     *         A callback to be called once data has been loaded. This should\n     *         be passed an array of objects, each representing an option in\n     *         the drop-down.\n     */\n    loadOptions(query, callback) {\n        const params = {\n            'only-fields': 'invite_only,name,display_name,id',\n            displayname: 1,\n        };\n\n        if (query.length !== 0) {\n            params.q = query;\n        }\n\n        $.ajax({\n            type: 'GET',\n            url: `${SITE_ROOT}${this._localSitePrefix}api/groups/`,\n            data: params,\n            success: results => {\n                /* This is done because we cannot filter using invite_only in\n                the groups api. */\n                if (this._inviteOnly === true) {\n                    results.groups = results.groups.filter(obj => {\n                        return obj.invite_only;\n                    });\n                }\n                callback(results.groups.map(u => ({\n                    name: u.name,\n                    display_name: u.display_name,\n                    id: u.id,\n                    invite_only: u.invite_only\n                })));\n            },\n            error: (...args) => {\n                console.error('Group query failed', args);\n                callback();\n            },\n        });\n    },\n});\n\n\n})();\n"],"mappings":";;AAAA,CAAC,YAAW;EAGZ,MAAMA,cAAc,GAAGC,CAAC,CAACC,QAAQ,CAAQ;AACzC;AACA,OAEC,CAAC;;EAGF;AACA;AACA;EACAC,EAAE,CAACC,wBAAwB,GAAGC,OAAO,CAACC,yBAAyB,CAACC,MAAM,CAAC;IACnEC,qBAAqB,EAAAC,OAAA,wBAAiC;IAEtD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACIC,UAAUA,CAACC,OAAO,EAAE;MAChBN,OAAO,CAACC,yBAAyB,CAACM,SAAS,CAACF,UAAU,CAACG,IAAI,CACvD,IAAI,EACJZ,CAAC,CAACa,QAAQ,CAAC;QACPC,gBAAgB,EAAE;UACdC,WAAW,EAAE,CAAC,MAAM,EAAE,cAAc,CAAC;UACrCC,SAAS,EAAE,CACP;YAACC,KAAK,EAAE;UAAM,CAAC,EACf;YAACA,KAAK,EAAE;UAAc,CAAC,CAC1B;UACDC,UAAU,EAAE;QAChB;MACJ,CAAC,EAAER,OAAO,CAAC,CAAC;MAEhB,IAAI,CAACS,gBAAgB,GAAGT,OAAO,CAACU,eAAe,IAAI,EAAE;MACrD,IAAI,CAACC,WAAW,GAAGX,OAAO,CAACY,UAAU;IACzC,CAAC;IAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACIC,YAAYA,CAACC,IAAI,EAAE;MACf,OAAOzB,cAAc,CAACyB,IAAI,CAAC;IAC/B,CAAC;IAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACIC,WAAWA,CAACC,KAAK,EAAEC,QAAQ,EAAE;MACzB,MAAMC,MAAM,GAAG;QACX,aAAa,EAAE,kCAAkC;QACjDC,WAAW,EAAE;MACjB,CAAC;MAED,IAAIH,KAAK,CAACI,MAAM,KAAK,CAAC,EAAE;QACpBF,MAAM,CAACG,CAAC,GAAGL,KAAK;MACpB;MAEAM,CAAC,CAACC,IAAI,CAAC;QACHC,IAAI,EAAE,KAAK;QACXC,GAAG,EAAG,GAAEC,SAAU,GAAE,IAAI,CAACjB,gBAAiB,aAAY;QACtDkB,IAAI,EAAET,MAAM;QACZU,OAAO,EAAEC,OAAO,IAAI;UAChB;AAChB;UACgB,IAAI,IAAI,CAAClB,WAAW,KAAK,IAAI,EAAE;YAC3BkB,OAAO,CAACC,MAAM,GAAGD,OAAO,CAACC,MAAM,CAACC,MAAM,CAACC,GAAG,IAAI;cAC1C,OAAOA,GAAG,CAACC,WAAW;YAC1B,CAAC,CAAC;UACN;UACAhB,QAAQ,CAACY,OAAO,CAACC,MAAM,CAACI,GAAG,CAACC,CAAC,KAAK;YAC9BC,IAAI,EAAED,CAAC,CAACC,IAAI;YACZC,YAAY,EAAEF,CAAC,CAACE,YAAY;YAC5BC,EAAE,EAAEH,CAAC,CAACG,EAAE;YACRL,WAAW,EAAEE,CAAC,CAACF;UACnB,CAAC,CAAC,CAAC,CAAC;QACR,CAAC;QACDM,KAAK,EAAE,SAAAA,CAAA,EAAa;UAAA,SAAAC,IAAA,GAAAC,SAAA,CAAArB,MAAA,EAATsB,IAAI,OAAAC,KAAA,CAAAH,IAAA,GAAAI,IAAA,MAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA;YAAJF,IAAI,CAAAE,IAAA,IAAAH,SAAA,CAAAG,IAAA;UAAA;UACXC,OAAO,CAACN,KAAK,CAAC,oBAAoB,EAAEG,IAAI,CAAC;UACzCzB,QAAQ,CAAC,CAAC;QACd;MACJ,CAAC,CAAC;IACN;EACJ,CAAC,CAAC;AAGF,CAAC,EAAE,CAAC"}