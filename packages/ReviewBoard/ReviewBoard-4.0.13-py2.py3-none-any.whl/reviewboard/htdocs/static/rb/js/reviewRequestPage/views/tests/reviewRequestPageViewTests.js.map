{"version":3,"file":"reviewRequestPageViewTests.js","names":["suite","template","page","pageView","entry1","entry2","beforeEach","$el","$","html","appendTo","$testsScratch","RB","DnDUploader","instance","ReviewRequestPage","checkForUpdates","reviewRequestData","editorData","fileAttachments","mutableByUser","showSendEmail","parse","ReviewRequestPageView","el","model","spyOn","IssueSummaryTableView","prototype","reviewRequest","get","addEntryView","ReviewEntryView","ReviewEntry","review","createReview","shipIt","public","bodyTop","bodyBottom","reviewRequestEditor","find","render","expect","_entryViews","length","toBe","afterEach","describe","it","$el1","$el2","hasClass","click","addClass","ReviewReplyEditorView","and","callThrough","openCommentEditor","getReviewReplyEditorView","toHaveBeenCalled","not"],"sources":["reviewRequestPageViewTests.es6.js"],"sourcesContent":["suite('rb/reviewRequestPage/views/ReviewRequestPageView', function() {\n    const template = dedent`\n        <div id=\"review-banner\"></div>\n        <a id=\"collapse-all\"></a>\n        <a id=\"expand-all\"></a>\n        <div>\n         <div class=\"review review-request-page-entry\" id=\"review123\">\n          <div class=\"review-request-page-entry-contents\">\n           <div class=\"body\">\n            <pre class=\"body_top\">Body Top</pre>\n            <div class=\"comment-section\" data-context-type=\"body_top\">\n            </div>\n            <div class=\"comment-section\" data-context-id=\"123\"\n                 data-context-type=\"diff_comments\">\n            </div>\n            <pre class=\"body_bottom\">Body Bottom</pre>\n            <div class=\"comment-section\" data-context-type=\"body_bottom\">\n            </div>\n           </div>\n         </div>\n         <div class=\"review review-request-page-entry\" id=\"review124\">\n          <div class=\"review-request-page-entry-contents\">\n           <div class=\"body\">\n            <pre class=\"body_top\">Body Top</pre>\n            <div class=\"comment-section\" data-context-type=\"body_top\">\n            </div>\n            <pre class=\"body_bottom\">Body Bottom</pre>\n            <div class=\"comment-section\" data-context-type=\"body_bottom\">\n            </div>\n           </div>\n          </div>\n         </div>\n        </div>\n    `;\n\n    let page;\n    let pageView;\n    let entry1;\n    let entry2;\n\n    beforeEach(function() {\n        const $el = $('<div/>')\n            .html(template)\n            .appendTo($testsScratch);\n\n        RB.DnDUploader.instance = null;\n\n        page = new RB.ReviewRequestPage.ReviewRequestPage({\n            checkForUpdates: false,\n            reviewRequestData: {},\n            editorData: {\n                fileAttachments: [],\n                mutableByUser: true,\n                showSendEmail: false,\n            },\n        }, {\n            parse: true,\n        });\n\n        pageView = new RB.ReviewRequestPage.ReviewRequestPageView({\n            el: $el,\n            model: page,\n        });\n\n        // Stub this out.\n        spyOn(RB.ReviewRequestPage.IssueSummaryTableView.prototype,\n              'render');\n\n        const reviewRequest = page.get('reviewRequest');\n\n        pageView.addEntryView(new RB.ReviewRequestPage.ReviewEntryView({\n            model: new RB.ReviewRequestPage.ReviewEntry({\n                review: reviewRequest.createReview(123, {\n                    shipIt: true,\n                    public: true,\n                    bodyTop: 'Body Top',\n                    bodyBottom: 'Body Bottom',\n                }),\n                reviewRequestEditor: pageView.reviewRequestEditor,\n            }),\n            el: $el.find('#review123'),\n        }));\n\n        pageView.addEntryView(new RB.ReviewRequestPage.ReviewEntryView({\n            model: new RB.ReviewRequestPage.ReviewEntry({\n                review: reviewRequest.createReview(124, {\n                    shipIt: false,\n                    public: true,\n                    bodyTop: 'Body Top',\n                    bodyBottom: 'Body Bottom',\n                }),\n                reviewRequestEditor: pageView.reviewRequestEditor,\n            }),\n            el: $el.find('#review124'),\n        }));\n\n        pageView.render();\n\n        expect(pageView._entryViews.length).toBe(2);\n        entry1 = pageView._entryViews[0];\n        entry2 = pageView._entryViews[1];\n    });\n\n    afterEach(function() {\n        RB.DnDUploader.instance = null;\n    });\n\n    describe('Actions', function() {\n        it('Collapse all', function() {\n            const $el1 = entry1.$el.find('.review-request-page-entry-contents');\n            const $el2 = entry2.$el.find('.review-request-page-entry-contents');\n\n            expect($el1.hasClass('collapsed')).toBe(false);\n            expect($el2.hasClass('collapsed')).toBe(false);\n\n            pageView.$('#collapse-all').click();\n\n            expect($el1.hasClass('collapsed')).toBe(true);\n            expect($el2.hasClass('collapsed')).toBe(true);\n        });\n\n        it('Expand all', function() {\n            const $el1 = entry1.$el.find('.review-request-page-entry-contents');\n            const $el2 = entry2.$el.find('.review-request-page-entry-contents');\n\n            $el1.addClass('collapsed');\n            $el2.addClass('collapsed');\n\n            pageView.$('#expand-all').click();\n\n            expect($el1.hasClass('collapsed')).toBe(false);\n            expect($el2.hasClass('collapsed')).toBe(false);\n        });\n    });\n\n    describe('Methods', function() {\n        describe('openCommentEditor', function() {\n            beforeEach(function() {\n                spyOn(RB.ReviewRequestPage.ReviewReplyEditorView.prototype,\n                      'openCommentEditor');\n                spyOn(entry1, 'getReviewReplyEditorView').and.callThrough();\n                spyOn(entry2, 'getReviewReplyEditorView').and.callThrough();\n            });\n\n            it('With body_top', function() {\n                pageView.openCommentEditor('body_top');\n\n                expect(entry1.getReviewReplyEditorView).toHaveBeenCalled();\n                expect(RB.ReviewRequestPage.ReviewReplyEditorView\n                       .prototype.openCommentEditor).toHaveBeenCalled();\n\n                /* We should have matched the first one. */\n                expect(entry2.getReviewReplyEditorView).not.toHaveBeenCalled();\n            });\n\n            it('With body_bottom', function() {\n                pageView.openCommentEditor('body_bottom');\n\n                expect(entry1.getReviewReplyEditorView).toHaveBeenCalled();\n                expect(RB.ReviewRequestPage.ReviewReplyEditorView\n                       .prototype.openCommentEditor).toHaveBeenCalled();\n\n                /* We should have matched the first one. */\n                expect(entry2.getReviewReplyEditorView).not.toHaveBeenCalled();\n            });\n\n            it('With comments', function() {\n                pageView.openCommentEditor('diff_comments', 123);\n\n                expect(entry1.getReviewReplyEditorView).toHaveBeenCalled();\n                expect(RB.ReviewRequestPage.ReviewReplyEditorView\n                       .prototype.openCommentEditor).toHaveBeenCalled();\n\n                /* We should have matched the first one. */\n                expect(entry2.getReviewReplyEditorView).not.toHaveBeenCalled();\n            });\n        });\n    });\n});\n"],"mappings":"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"}