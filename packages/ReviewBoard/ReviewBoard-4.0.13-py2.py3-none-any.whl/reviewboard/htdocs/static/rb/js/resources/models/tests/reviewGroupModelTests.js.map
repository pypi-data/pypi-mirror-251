{"version":3,"file":"reviewGroupModelTests.js","names":["suite","describe","url","callbacks","group","session","beforeEach","RB","UserSession","instance","create","username","watchedReviewGroupsURL","ReviewGroup","id","success","error","spyOn","watchedGroups","and","callThrough","it","$","callFake","request","expect","type","toBe","stat","setStarred","addImmediately","toHaveBeenCalled","apiCall","ajax","not","removeImmediately","name","data","addUser","set","isNew","removeUser"],"sources":["reviewGroupModelTests.es6.js"],"sourcesContent":["suite('rb/resources/models/ReviewGroup', function() {\n    describe('setStarred', function() {\n        const url = '/api/users/testuser/watched/groups/';\n        let callbacks;\n        let group;\n        let session;\n\n        beforeEach(function() {\n            RB.UserSession.instance = null;\n            session = RB.UserSession.create({\n                username: 'testuser',\n                watchedReviewGroupsURL: url,\n            });\n\n            group = new RB.ReviewGroup({\n                id: 1,\n            });\n\n            callbacks = {\n                success: function() {},\n                error: function() {},\n            };\n\n            spyOn(session.watchedGroups, 'addImmediately').and.callThrough();\n            spyOn(session.watchedGroups, 'removeImmediately').and.callThrough();\n            spyOn(RB, 'apiCall').and.callThrough();\n            spyOn(callbacks, 'success');\n            spyOn(callbacks, 'error');\n        });\n\n        it('true', function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.url).toBe(url);\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            group.setStarred(true, callbacks);\n\n            expect(session.watchedGroups.addImmediately).toHaveBeenCalled();\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n            expect(callbacks.success).toHaveBeenCalled();\n            expect(callbacks.error).not.toHaveBeenCalled();\n        });\n\n        it('false', function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n                expect(request.url).toBe(url + '1/');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            group.setStarred(false, callbacks);\n\n            expect(session.watchedGroups.removeImmediately).toHaveBeenCalled();\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n            expect(callbacks.success).toHaveBeenCalled();\n            expect(callbacks.error).not.toHaveBeenCalled();\n        });\n    });\n\n    describe('addUser', function() {\n        let callbacks;\n        let group;\n\n        beforeEach(function() {\n            group = new RB.ReviewGroup({\n                id: 1,\n                name: 'test-group',\n            });\n\n            callbacks = {\n                success: function() {},\n                error: function() {},\n            };\n\n            spyOn(RB, 'apiCall').and.callThrough();\n            spyOn(callbacks, 'success');\n            spyOn(callbacks, 'error');\n        });\n\n        it('Loaded group', function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.data.username).toBe('my-user');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            group.addUser('my-user', callbacks);\n\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n            expect(callbacks.success).toHaveBeenCalled();\n        });\n\n        it('Unloaded group', function() {\n            spyOn($, 'ajax');\n\n            group.set('id', null);\n            expect(group.isNew()).toBe(true);\n\n            group.addUser('my-user', callbacks);\n\n            expect(RB.apiCall).not.toHaveBeenCalled();\n            expect($.ajax).not.toHaveBeenCalled();\n            expect(callbacks.error).toHaveBeenCalled();\n        });\n    });\n\n    describe('removeUser', function() {\n        let callbacks;\n        let group;\n\n        beforeEach(function() {\n            group = new RB.ReviewGroup({\n                id: 1,\n                name: 'test-group',\n            });\n\n            callbacks = {\n                success: function() {},\n                error: function() {},\n            };\n\n            spyOn(RB, 'apiCall').and.callThrough();\n            spyOn(callbacks, 'success');\n            spyOn(callbacks, 'error');\n        });\n\n        it('Loaded group', function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n\n                request.success();\n            });\n\n            group.removeUser('my-user', callbacks);\n\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n            expect(callbacks.success).toHaveBeenCalled();\n        });\n\n        it('Unloaded group', function() {\n            spyOn($, 'ajax');\n\n            group.set('id', null);\n            expect(group.isNew()).toBe(true);\n\n            group.removeUser('my-user', callbacks);\n\n            expect(RB.apiCall).not.toHaveBeenCalled();\n            expect($.ajax).not.toHaveBeenCalled();\n            expect(callbacks.error).toHaveBeenCalled();\n        });\n    });\n});\n"],"mappings":"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"}