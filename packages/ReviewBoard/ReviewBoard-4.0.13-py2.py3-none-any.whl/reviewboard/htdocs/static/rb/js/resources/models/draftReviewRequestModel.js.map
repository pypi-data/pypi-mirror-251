{"version":3,"file":"draftReviewRequestModel.js","names":["RB","DraftReviewRequest","BaseResource","extend","_","defaults","branch","bugsClosed","changeDescription","changeDescriptionRichText","dependsOn","description","descriptionRichText","rawTextFields","submitter","summary","targetGroups","targetPeople","testingDone","testingDoneRichText","prototype","rspNamespace","listKey","supportsExtraData","expandedFields","extraQueryArgs","attrToJsonMap","deserializedAttrs","url","get","draft","href","createFileAttachment","attributes","DraftFileAttachment","parentObject","publish","options","arguments","length","undefined","context","ready","validationError","validate","publishing","isFunction","error","call","errorText","save","data","trivial","bind","parseResourceData","rsp","raw_text_fields","links","changedescription_text_type","description_text_type","testing_done_text_type","DraftResourceModelMixin"],"sources":["draftReviewRequestModel.es6.js"],"sourcesContent":["/**\n * The draft of a review request.\n *\n * This provides editing capabilities for a review request draft, as well\n * as the ability to publish and discard (destroy) a draft.\n */\nRB.DraftReviewRequest = RB.BaseResource.extend(_.defaults({\n    defaults() {\n        return _.defaults({\n            branch: null,\n            bugsClosed: null,\n            changeDescription: null,\n            changeDescriptionRichText: false,\n            dependsOn: [],\n            description: null,\n            descriptionRichText: false,\n            'public': null,\n            rawTextFields: null,\n            submitter: null,\n            summary: null,\n            targetGroups: [],\n            targetPeople: [],\n            testingDone: null,\n            testingDoneRichText: false\n        }, RB.BaseResource.prototype.defaults());\n    },\n\n    rspNamespace: 'draft',\n    listKey: 'draft',\n    supportsExtraData: true,\n\n    expandedFields: ['depends_on', 'target_people', 'target_groups'],\n\n    extraQueryArgs: {\n        'force-text-type': 'html',\n        'include-text-types': 'raw'\n    },\n\n    attrToJsonMap: {\n        bugsClosed: 'bugs_closed',\n        changeDescription: 'changedescription',\n        changeDescriptionRichText: 'changedescription_text_type',\n        dependsOn: 'depends_on',\n        descriptionRichText: 'description_text_type',\n        targetGroups: 'target_groups',\n        targetPeople: 'target_people',\n        testingDone: 'testing_done',\n        testingDoneRichText: 'testing_done_text_type'\n    },\n\n    deserializedAttrs: [\n        'branch',\n        'bugsClosed',\n        'changeDescription',\n        'dependsOn',\n        'description',\n        'public',\n        'summary',\n        'targetGroups',\n        'targetPeople',\n        'testingDone'\n    ],\n\n    /**\n     * Return the URL to use when syncing the model.\n     *\n     * Returns:\n     *     string:\n     *     The URL to sync.\n     */\n    url() {\n        return this.get('parentObject').get('links').draft.href;\n    },\n\n    /**\n     * Create a FileAttachment object for this draft.\n     *\n     * Args:\n     *     attributes (object):\n     *         Attributes for the file attachment model.\n     *\n     * Returns:\n     *     RB.DraftFileAttachment:\n     *     The new file attachment object.\n     */\n    createFileAttachment(attributes) {\n        return new RB.DraftFileAttachment(_.defaults({\n            parentObject: this\n        }, attributes));\n    },\n\n    /**\n     * Publish the draft.\n     *\n     * The contents of the draft will be validated before being sent to the\n     * server in order to ensure that the appropriate fields are all there.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the operation, including callbacks.\n     *\n     *     context (object):\n     *         Context to bind when calling callbacks.\n     */\n    publish(options={}, context=undefined) {\n        this.ready({\n            ready: () => {\n                const validationError = this.validate(this.attributes, {\n                    publishing: true\n                });\n\n                if (validationError) {\n                    if (_.isFunction(options.error)) {\n                        options.error.call(context, this, {\n                            errorText: validationError\n                        });\n                    }\n                } else {\n                    this.save(\n                        _.defaults({\n                            data: {\n                                'public': 1,\n                                trivial: options.trivial ? 1 : 0\n                            }\n                        }, options),\n                        context);\n                }\n            },\n            error: _.isFunction(options.error)\n                   ? _.bind(options.error, context)\n                   : undefined\n        }, this);\n    },\n\n    parseResourceData(rsp) {\n        const rawTextFields = rsp.raw_text_fields || rsp;\n        const data = RB.BaseResource.prototype.parseResourceData.call(\n            this, rsp);\n\n        data.submitter = rsp.links.submitter;\n        data.changeDescriptionRichText =\n            (rawTextFields.changedescription_text_type === 'markdown');\n        data.descriptionRichText =\n            (rawTextFields.description_text_type === 'markdown');\n        data.testingDoneRichText =\n            (rawTextFields.testing_done_text_type === 'markdown');\n        data.rawTextFields = rawTextFields || null;\n\n        return data;\n    }\n}, RB.DraftResourceModelMixin));\n"],"mappings":"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"}