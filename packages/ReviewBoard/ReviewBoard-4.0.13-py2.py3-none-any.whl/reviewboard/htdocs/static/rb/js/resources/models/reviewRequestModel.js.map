{"version":3,"file":"reviewRequestModel.js","names":["RB","ReviewRequest","BaseResource","extend","defaults","_","approved","approvalFailure","branch","bugTrackerURL","bugsClosed","commitID","closeDescription","closeDescriptionRichText","dependsOn","description","descriptionRichText","draftReview","lastUpdated","localSitePrefix","repository","reviewURL","state","summary","targetGroups","targetPeople","testingDone","testingDoneRichText","prototype","rspNamespace","extraQueryArgs","attrToJsonMap","deserializedAttrs","initialize","attrs","options","arguments","length","undefined","call","reviews","Backbone","Collection","model","Review","draft","DraftReviewRequest","parentObject","get","extraDraftAttrs","url","SITE_ROOT","isNew","id","createFromCommit","context","console","assert","set","save","createDiff","Diff","createReview","reviewID","extraAttrs","review","DraftReview","add","createScreenshot","screenshotID","Screenshot","createFileAttachment","attributes","FileAttachment","setStarred","starred","watched","UserSession","instance","watchedReviewRequests","addImmediately","removeImmediately","close","data","type","CLOSE_DISCARDED","status","CLOSE_SUBMITTED","isFunction","error","errorText","close_description","richText","close_description_text_type","postData","changingState","saveOptions","success","trigger","markUpdated","reopen","timestamp","_lastUpdateTimestamp","beginCheckForUpdates","lastUpdateTimestamp","_checkUpdatesType","ready","setTimeout","_checkForUpdates","bind","CHECK_UPDATES_MSECS","apiCall","prefix","noActivityIndicator","last_update","href","rsp","lastUpdate","toJSON","result","commit_id","create_from_commit_id","_super","apply","parseResourceData","pending","PENDING","discarded","submitted","rawTextFields","raw_text_fields","description_text_type","testing_done_text_type","VISIBILITY_VISIBLE","VISIBILITY_ARCHIVED","VISIBILITY_MUTED"],"sources":["reviewRequestModel.es6.js"],"sourcesContent":["/**\n * A review request.\n *\n * ReviewRequest is the starting point for much of the resource API. Through\n * it, the caller can create drafts, diffs, file attachments, and screenshots.\n *\n * Fields on a ReviewRequest are set by accessing the ReviewRequest.draft\n * object. Through there, fields can be set like any other model and then\n * saved.\n *\n * A review request can be closed by using the close() function, reopened\n * through reopen(), or even permanently destroyed by calling destroy().\n */\nRB.ReviewRequest = RB.BaseResource.extend({\n    defaults() {\n        return _.defaults({\n            approved: false,\n            approvalFailure: null,\n            branch: null,\n            bugTrackerURL: null,\n            bugsClosed: null,\n            commitID: null,\n            closeDescription: null,\n            closeDescriptionRichText: false,\n            dependsOn: [],\n            description: null,\n            descriptionRichText: false,\n            draftReview: null,\n            lastUpdated: null,\n            localSitePrefix: null,\n            'public': null,\n            repository: null,\n            reviewURL: null,\n            state: null,\n            summary: null,\n            targetGroups: [],\n            targetPeople: [],\n            testingDone: null,\n            testingDoneRichText: false\n        }, RB.BaseResource.prototype.defaults());\n    },\n\n    rspNamespace: 'review_request',\n\n    extraQueryArgs: {\n        'force-text-type': 'html',\n        'include-text-types': 'raw'\n    },\n\n    attrToJsonMap: {\n        approvalFailure: 'approval_failure',\n        bugsClosed: 'bugs_closed',\n        closeDescription: 'close_description',\n        closeDescriptionRichText: 'close_description_text_type',\n        dependsOn: 'depends_on',\n        descriptionRichText: 'description_text_type',\n        lastUpdated: 'last_updated',\n        reviewURL: 'url',\n        targetGroups: 'target_groups',\n        targetPeople: 'target_people',\n        testingDone: 'testing_done',\n        testingDoneRichText: 'testing_done_text_type'\n    },\n\n    deserializedAttrs: [\n        'approved',\n        'approvalFailure',\n        'branch',\n        'bugsClosed',\n        'closeDescription',\n        'dependsOn',\n        'description',\n        'lastUpdated',\n        'public',\n        'reviewURL',\n        'summary',\n        'targetGroups',\n        'targetPeople',\n        'testingDone'\n    ],\n\n    /**\n     * Initialize the model.\n     *\n     * Args:\n     *     attrs (object):\n     *         Initial values for the model attributes.\n     *\n     *     options (object):\n     *         Additional options for the object construction.\n     *\n     * Option Args:\n     *     extraDraftAttrs (object):\n     *         Additional attributes to include when creating a review request\n     *         draft.\n     */\n    initialize(attrs, options={}) {\n        RB.BaseResource.prototype.initialize.call(this, attrs, options);\n\n        this.reviews = new Backbone.Collection([], {\n            model: RB.Review\n        });\n\n        this.draft = new RB.DraftReviewRequest(_.defaults({\n            parentObject: this,\n            branch: this.get('branch'),\n            bugsClosed: this.get('bugsClosed'),\n            dependsOn: this.get('dependsOn'),\n            description: this.get('description'),\n            descriptionRichText: this.get('descriptionRichText'),\n            summary: this.get('summary'),\n            targetGroups: this.get('targetGroups'),\n            targetPeople: this.get('targetPeople'),\n            testingDone: this.get('testingDone'),\n            testingDoneRichText: this.get('testingDoneRichText')\n        }, options.extraDraftAttrs));\n    },\n\n    /**\n     * Return the URL for syncing this model.\n     *\n     * Returns:\n     *     string:\n     *     The URL for the API resource.\n     */\n    url() {\n        const url = SITE_ROOT + (this.get('localSitePrefix') || '') +\n                    'api/review-requests/';\n\n        return this.isNew() ? url : `${url}${this.id}/`;\n    },\n\n    /**\n     * Create the review request from an existing commit.\n     *\n     * This can only be used for new ReviewRequest instances, and requires\n     * a commitID option.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the save operation.\n     *\n     *     context (object):\n     *         Context to bind when calling callbacks.\n     *\n     * Option Args:\n     *     commitID (string):\n     *         The ID of the commit to create the review request from.\n     */\n    createFromCommit(options, context) {\n        console.assert(options.commitID);\n        console.assert(this.isNew());\n\n        this.set('commitID', options.commitID);\n        this.save(\n            _.extend({\n                createFromCommit: true\n            }, options),\n            context);\n    },\n\n    /**\n     * Create a Diff object for this review request.\n     *\n     * Returns:\n     *     RB.Diff:\n     *     The new diff model.\n     */\n    createDiff() {\n        return new RB.Diff({\n            parentObject: this\n        });\n    },\n\n    /**\n     * Create a Review object for this review request.\n     *\n     * If an ID is specified, the Review object will reference that ID.\n     * Otherwise, it is considered a draft review, and will either return\n     * the existing one (if the draftReview attribute is set), or create\n     * a new one (and set the attribute).\n     *\n     * Args:\n     *     reviewID (number):\n     *         The ID of the review, for existing reviews.\n     *\n     *     extraAttrs (object):\n     *         Additional attributes to set on new models.\n     *\n     * Returns:\n     *     RB.Review:\n     *     The new review object.\n     */\n    createReview(reviewID, extraAttrs={}) {\n        let review;\n\n        if (reviewID === undefined) {\n            review = this.get('draftReview');\n\n            if (review === null) {\n                review = new RB.DraftReview({\n                    parentObject: this\n                });\n\n                this.set('draftReview', review);\n            }\n        } else {\n            review = this.reviews.get(reviewID);\n\n            if (!review) {\n                review = new RB.Review(_.defaults({\n                    parentObject: this,\n                    id: reviewID\n                }, extraAttrs));\n                this.reviews.add(review);\n            }\n\n        }\n\n        return review;\n    },\n\n    /**\n     * Create a Screenshot object for this review request.\n     *\n     * Args:\n     *     screenshotID (number):\n     *         The ID of the screenshot, for existing screenshots.\n     *\n     * Returns:\n     *     RB.Screenshot:\n     *     The new screenshot object.\n     */\n    createScreenshot(screenshotID) {\n        return new RB.Screenshot({\n            parentObject: this,\n            id: screenshotID\n        });\n    },\n\n    /**\n     * Create a FileAttachment object for this review request.\n     *\n     * Args:\n     *     attributes (object):\n     *         Additional attributes to include on the new model.\n     *\n     * Returns:\n     *     RB.FileAttachment:\n     *     The new file attachment object.\n     */\n    createFileAttachment(attributes) {\n        return new RB.FileAttachment(_.defaults({\n            parentObject: this\n        }, attributes));\n    },\n\n    /**\n     * Mark a review request as starred or unstarred.\n     *\n     * Args:\n     *     starred (boolean):\n     *         Whether the review request is starred.\n     *\n     *     options (object):\n     *         Options for the save operation.\n     *\n     *     context (object):\n     *         Context to bind when calling callbacks.\n     */\n    setStarred(starred, options, context) {\n        const watched = RB.UserSession.instance.watchedReviewRequests;\n\n        if (starred) {\n            watched.addImmediately(this, options, context);\n        } else {\n            watched.removeImmediately(this, options, context);\n        }\n    },\n\n    /**\n     * Close the review request.\n     *\n     * A 'type' option must be provided, which must match one of the\n     * close types (ReviewRequest.CLOSE_DISCARDED or\n     * ReviewRequest.CLOSE_SUBMITTED).\n     *\n     * An optional description can be set by passing a 'description' option.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the save operation.\n     *\n     *     context (object):\n     *         Context to bind when calling callbacks.\n     */\n    close(options, context) {\n        const data = {};\n\n        console.assert(options);\n\n        if (options.type === RB.ReviewRequest.CLOSE_DISCARDED) {\n            data.status = 'discarded';\n        } else if (options.type === RB.ReviewRequest.CLOSE_SUBMITTED) {\n            data.status = 'submitted';\n        } else {\n            if (_.isFunction(options.error)) {\n                options.error.call(context, {\n                    errorText: 'Invalid close type'\n                });\n            }\n\n            return;\n        }\n\n        if (options.description !== undefined) {\n            data.close_description = options.description;\n        }\n\n        if (options.richText !== undefined) {\n            data.close_description_text_type =\n                (options.richText ? 'markdown' : 'plain');\n        }\n\n        if (options.postData !== undefined) {\n            _.extend(data, options.postData);\n        }\n\n        const changingState = (options.type !== this.get('state'));\n\n        const saveOptions = _.defaults({\n            data: data,\n            success: () => {\n                if (changingState) {\n                    this.trigger('closed');\n                }\n\n                this.markUpdated(this.get('lastUpdated'));\n\n                if (_.isFunction(options.success)) {\n                    options.success.call(context);\n                }\n            }\n        }, options);\n\n        delete saveOptions.type;\n        delete saveOptions.description;\n\n        this.save(saveOptions, context);\n    },\n\n    /**\n     * Reopen the review request.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the save operation.\n     *\n     *     context (object):\n     *         Context to bind when calling callbacks.\n     */\n    reopen(options={}, context=undefined) {\n        this.save(\n            _.defaults({\n                data: {\n                    status: 'pending'\n                },\n                success: () => {\n                    this.trigger('reopened');\n                    this.markUpdated(this.get('lastUpdated'));\n\n                    if (_.isFunction(options.success)) {\n                        options.success.call(context);\n                    }\n                }\n            }, options),\n            context);\n    },\n\n    /**\n     * Marks the review request as having been updated at the given timestamp.\n     *\n     * This should be used when an action will trigger an update to the\n     * review request's Last Updated timestamp, but where we don't want\n     * a notification later on. The local copy of the timestamp can be\n     * bumped to mark it as up-to-date.\n     *\n     * Args:\n     *     timestamp (string):\n     *         The timestamp to store.\n     */\n    markUpdated(timestamp) {\n        this._lastUpdateTimestamp = timestamp;\n    },\n\n    /**\n     * Begin checking for server-side updates to the review request.\n     *\n     * The 'updated' event will be triggered when there's a new update.\n     *\n     * Args:\n     *     type (string):\n     *         The type of updates to check for.\n     *\n     *     lastUpdateTimestamp (string):\n     *         The timestamp of the last known update.\n     */\n    beginCheckForUpdates(type, lastUpdateTimestamp) {\n        this._checkUpdatesType = type;\n        this._lastUpdateTimestamp = lastUpdateTimestamp;\n\n        this.ready({\n            ready: () => setTimeout(this._checkForUpdates.bind(this),\n                                    RB.ReviewRequest.CHECK_UPDATES_MSECS)\n        });\n    },\n\n    /**\n     * Check for updates.\n     *\n     * This is called periodically after an initial call to\n     * beginCheckForUpdates. It will see if there's a new update yet on the\n     * server, and if there is, trigger the 'updated' event.\n     */\n    _checkForUpdates() {\n        RB.apiCall({\n            type: 'GET',\n            prefix: this.get('sitePrefix'),\n            noActivityIndicator: true,\n            url: this.get('links').last_update.href,\n            success: rsp => {\n                const lastUpdate = rsp.last_update;\n\n                if ((!this._checkUpdatesType ||\n                     this._checkUpdatesType === lastUpdate.type) &&\n                    this._lastUpdateTimestamp !== lastUpdate.timestamp) {\n                    this.trigger('updated', lastUpdate);\n                }\n\n                this._lastUpdateTimestamp = lastUpdate.timestamp;\n\n                setTimeout(this._checkForUpdates.bind(this),\n                           RB.ReviewRequest.CHECK_UPDATES_MSECS);\n            }\n        });\n    },\n\n    /**\n     * Serialize for sending to the server.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the save operation.\n     *\n     * Option Args:\n     *     createFromCommit (boolean):\n     *         Whether this save is going to create a new review request from\n     *         an existing committed change.\n     *\n     * Returns:\n     *     object:\n     *     Data suitable for passing to JSON.stringify.\n     */\n    toJSON(options={}) {\n        if (this.isNew()) {\n            const commitID = this.get('commitID');\n            const repository = this.get('repository');\n            const result = {};\n\n            if (commitID) {\n                result.commit_id = commitID;\n\n                if (options.createFromCommit) {\n                    result.create_from_commit_id = true;\n                }\n            }\n\n            if (repository) {\n                result.repository = repository;\n            }\n\n            return result;\n        } else {\n            return _super(this).toJSON.apply(this, arguments);\n        }\n    },\n\n    /**\n     * Parse the response from the server.\n     *\n     * Args:\n     *     rsp (object):\n     *         The response from the server.\n     *\n     * Returns:\n     *     object:\n     *     Attribute values to set on the model.\n     */\n    parseResourceData(rsp) {\n        const state = {\n            pending: RB.ReviewRequest.PENDING,\n            discarded: RB.ReviewRequest.CLOSE_DISCARDED,\n            submitted: RB.ReviewRequest.CLOSE_SUBMITTED\n        }[rsp.status];\n        const rawTextFields = rsp.raw_text_fields || rsp;\n        const data = RB.BaseResource.prototype.parseResourceData.call(\n            this, rsp);\n\n        data.state = state;\n        data.closeDescriptionRichText =\n            (rawTextFields.close_description_text_type === 'markdown');\n        data.descriptionRichText =\n            (rawTextFields.description_text_type === 'markdown');\n        data.testingDoneRichText =\n            (rawTextFields.testing_done_text_type === 'markdown');\n\n        return data;\n    }\n}, {\n    CHECK_UPDATES_MSECS: 5 * 60 * 1000, // Every 5 minutes\n\n    CLOSE_DISCARDED: 1,\n    CLOSE_SUBMITTED: 2,\n    PENDING: 3,\n\n    VISIBILITY_VISIBLE: 1,\n    VISIBILITY_ARCHIVED: 2,\n    VISIBILITY_MUTED: 3\n});\n"],"mappings":"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"}