{"version":3,"file":"floatingBannerView.js","names":["RB","FloatingBannerView","Backbone","View","extend","initialize","options","_$floatSpacer","_","bindAll","render","$","window","scroll","_updateFloatPosition","resize","_updateSize","defer","remove","prototype","call","$el","hasClass","rect","parent","getBoundingClientRect","width","Math","ceil","getExtents","length","wrap","$container","$floatContainer","containerTop","offset","top","containerHeight","outerHeight","containerBottom","windowTop","scrollTop","topOffset","wasFloating","noFloatContainerClass","height","css","addClass","removeClass","position"],"sources":["../../../../../static/rb/js/views/floatingBannerView.es6.js"],"sourcesContent":["/**\n * Floats a banner on screen within a container.\n *\n * The banner will appear at the top of the container, or the screen,\n * whichever is visible, until the container is no longer on-screen.\n *\n * The banner will keep a spacer in its original location at the top\n * of the container in order to reserve space for it to anchor to.\n * This ensures that the page doesn't jump too horribly.\n */\nRB.FloatingBannerView = Backbone.View.extend({\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     $floatContainer (jQuery):\n     *         The container to use when the banner is floating.\n     *\n     *     noFloatContainerClass (string):\n     *         The class name used when the banner should not be floating.\n     */\n    initialize(options) {\n        this.options = options;\n        this._$floatSpacer = null;\n\n        _.bindAll(this, '_updateFloatPosition', '_updateSize');\n    },\n\n    /**\n     * Render the banner and listens for scroll and resize updates.\n     *\n     * Returns:\n     *     RB.FloatingBannerView:\n     *     This object, for chaining.\n     */\n    render() {\n        $(window)\n            .scroll(this._updateFloatPosition)\n            .resize(this._updateSize);\n        _.defer(this._updateFloatPosition);\n\n        return this;\n    },\n\n    /**\n     * Remove the view from the DOM.\n     *\n     * This will remove both the banner and the floating spacer (if currently\n     * in the DOM).\n     */\n    remove() {\n        if (this._$floatSpacer !== null) {\n            this._$floatSpacer.remove();\n        }\n\n        Backbone.View.prototype.remove.call(this);\n    },\n\n    /**\n     * Update the size of the banner to match the spacer.\n     */\n    _updateSize() {\n        if (this._$floatSpacer !== null) {\n            if (this.$el.hasClass('floating')) {\n                const rect =\n                    this._$floatSpacer.parent()[0].getBoundingClientRect();\n\n                this.$el.width(\n                    Math.ceil(rect.width) -\n                    this.$el.getExtents('bpm', 'lr'));\n            } else {\n                this.$el.width('auto');\n            }\n        }\n    },\n\n    /**\n     * Update the position of the banner.\n     *\n     * This will factor in how much of the container is visible, based on\n     * its size, position, and the scroll offset. It will then attempt\n     * to position the banner to the top of the visible portion of the\n     * container.\n     */\n    _updateFloatPosition() {\n        if (this.$el.parent().length === 0) {\n            return;\n        }\n\n        if (this._$floatSpacer === null) {\n            this._$floatSpacer = this.$el.wrap($('<div/>')).parent();\n            this._updateSize();\n        }\n\n        const $container = this.options.$floatContainer;\n        const containerTop = $container.offset().top;\n        const containerHeight = $container.outerHeight();\n        const containerBottom = containerTop + containerHeight;\n        const windowTop = $(window).scrollTop();\n        const topOffset = this._$floatSpacer.offset().top - windowTop;\n        const outerHeight = this.$el.outerHeight(true);\n\n        const wasFloating = this.$el.hasClass('floating');\n\n        if (!$container.hasClass(this.options.noFloatContainerClass) &&\n            topOffset < 0 &&\n            containerTop < windowTop &&\n            windowTop < containerBottom) {\n            /*\n             * We're floating! If we just entered this state, set the\n             * appropriate styles on the element.\n             *\n             * We'll then want to set the top to 0, unless the user is\n             * scrolling the banner out of view. In that case, figure out how\n             * much to show, and set the appropriate offset.\n             */\n            if (!wasFloating) {\n                /*\n                 * Set the spacer to be the dimensions of the docked banner,\n                 * so that the container doesn't change sizes when we go into\n                 * float mode.\n                 */\n                this._$floatSpacer\n                    .height(this.$el.outerHeight())\n                    .css({\n                        'margin-top': this.$el.css('margin-top'),\n                        'margin-bottom': this.$el.css('margin-bottom'),\n                    });\n\n                this.$el\n                    .addClass('floating')\n                    .css('position', 'fixed');\n            }\n\n            this.$el.css('top',\n                         windowTop > containerBottom - outerHeight\n                         ? containerBottom - outerHeight - windowTop\n                         : 0);\n\n            this._updateSize();\n        } else if (wasFloating) {\n            /*\n             * We're now longer floating. Unset the styles on the banner and\n             * on the spacer (in order to prevent the spacer from taking up\n             * any additional room.\n             */\n            this.$el\n                .removeClass('floating')\n                .css({\n                    top: '',\n                    position: '',\n                });\n            this._$floatSpacer\n                .height('auto')\n                .css('margin', 0);\n        }\n    },\n});\n"],"mappings":"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"}