{"version":3,"file":"draftReviewModel.js","names":["RB","DraftReview","Review","extend","_","defaults","publishAndArchive","publishToOwnerOnly","prototype","attrToJsonMap","serializedAttrs","concat","serializers","JSONSerializers","onlyIfValue","publish","options","context","undefined","isFunction","success","error","complete","console","warn","promiseToCallbacks","newOptions","trigger","ready","set","save","attrs","err","xhr","errorText","DraftResourceModelMixin"],"sources":["../../../../../../static/rb/js/resources/models/draftReviewModel.es6.js"],"sourcesContent":["/**\n * A draft review.\n *\n * Draft reviews are more complicated than most objects. A draft may already\n * exist on the server, in which case we need to be able to get its ID. A\n * special resource exists at /reviews/draft/ which will redirect to the\n * existing draft if one exists, and return 404 if not.\n */\nRB.DraftReview = RB.Review.extend(_.extend({\n    defaults: _.defaults({\n        publishAndArchive: false,\n        publishToOwnerOnly: false,\n    }, RB.Review.prototype.defaults()),\n\n    attrToJsonMap: _.defaults({\n        publishAndArchive: 'publish_and_archive',\n        publishToOwnerOnly: 'publish_to_owner_only',\n    }, RB.Review.prototype.attrToJsonMap),\n\n    serializedAttrs: [\n        'publishAndArchive',\n        'publishToOwnerOnly',\n    ].concat(RB.Review.prototype.serializedAttrs),\n\n    serializers: _.defaults({\n        publishAndArchive: RB.JSONSerializers.onlyIfValue,\n        publishToOwnerOnly: RB.JSONSerializers.onlyIfValue,\n    }, RB.Review.prototype.serializers),\n\n\n    /**\n     * Publish the review.\n     *\n     * Before publish, the \"publishing\" event will be triggered.\n     *\n     * After the publish has succeeded, the \"published\" event will be\n     * triggered.\n     *\n     * Version Changed:\n     *     5.0:\n     *     Deprecated the callbacks and added a promise return value.\n     *\n     * Args:\n     *     options (object, optional):\n     *         Options for the operation.\n     *\n     *     context (object, optional):\n     *         Context to bind when calling callbacks.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise which resolves when the operation is complete.\n     */\n    async publish(options={}, context=undefined) {\n        if (_.isFunction(options.success) ||\n            _.isFunction(options.error) ||\n            _.isFunction(options.complete)) {\n            console.warn('RB.DraftReview.publish was called using callbacks. ' +\n                         'Callers should be updated to use promises instead.');\n            return RB.promiseToCallbacks(\n                options, context, newOptions => this.publish(newOptions));\n        }\n\n        this.trigger('publishing');\n\n        await this.ready();\n\n        this.set('public', true);\n\n        try {\n            await this.save({ attrs: options.attrs });\n        } catch (err) {\n            this.trigger('publishError', err.xhr.errorText);\n            throw err;\n        }\n\n        this.trigger('published');\n    }\n}, RB.DraftResourceModelMixin));\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,EAAE,CAACC,WAAW,GAAGD,EAAE,CAACE,MAAM,CAACC,MAAM,CAACC,CAAC,CAACD,MAAM,CAAC;EACvCE,QAAQ,EAAED,CAAC,CAACC,QAAQ,CAAC;IACjBC,iBAAiB,EAAE,KAAK;IACxBC,kBAAkB,EAAE;EACxB,CAAC,EAAEP,EAAE,CAACE,MAAM,CAACM,SAAS,CAACH,QAAQ,CAAC,CAAC,CAAC;EAElCI,aAAa,EAAEL,CAAC,CAACC,QAAQ,CAAC;IACtBC,iBAAiB,EAAE,qBAAqB;IACxCC,kBAAkB,EAAE;EACxB,CAAC,EAAEP,EAAE,CAACE,MAAM,CAACM,SAAS,CAACC,aAAa,CAAC;EAErCC,eAAe,EAAE,CACb,mBAAmB,EACnB,oBAAoB,CACvB,CAACC,MAAM,CAACX,EAAE,CAACE,MAAM,CAACM,SAAS,CAACE,eAAe,CAAC;EAE7CE,WAAW,EAAER,CAAC,CAACC,QAAQ,CAAC;IACpBC,iBAAiB,EAAEN,EAAE,CAACa,eAAe,CAACC,WAAW;IACjDP,kBAAkB,EAAEP,EAAE,CAACa,eAAe,CAACC;EAC3C,CAAC,EAAEd,EAAE,CAACE,MAAM,CAACM,SAAS,CAACI,WAAW,CAAC;EAGnC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,MAAMG,OAAOA,CAACC,OAAO,GAAC,CAAC,CAAC,EAAEC,OAAO,GAACC,SAAS,EAAE;IACzC,IAAId,CAAC,CAACe,UAAU,CAACH,OAAO,CAACI,OAAO,CAAC,IAC7BhB,CAAC,CAACe,UAAU,CAACH,OAAO,CAACK,KAAK,CAAC,IAC3BjB,CAAC,CAACe,UAAU,CAACH,OAAO,CAACM,QAAQ,CAAC,EAAE;MAChCC,OAAO,CAACC,IAAI,CAAC,qDAAqD,GACrD,oDAAoD,CAAC;MAClE,OAAOxB,EAAE,CAACyB,kBAAkB,CACxBT,OAAO,EAAEC,OAAO,EAAES,UAAU,IAAI,IAAI,CAACX,OAAO,CAACW,UAAU,CAAC,CAAC;IACjE;IAEA,IAAI,CAACC,OAAO,CAAC,YAAY,CAAC;IAE1B,MAAM,IAAI,CAACC,KAAK,CAAC,CAAC;IAElB,IAAI,CAACC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC;IAExB,IAAI;MACA,MAAM,IAAI,CAACC,IAAI,CAAC;QAAEC,KAAK,EAAEf,OAAO,CAACe;MAAM,CAAC,CAAC;IAC7C,CAAC,CAAC,OAAOC,GAAG,EAAE;MACV,IAAI,CAACL,OAAO,CAAC,cAAc,EAAEK,GAAG,CAACC,GAAG,CAACC,SAAS,CAAC;MAC/C,MAAMF,GAAG;IACb;IAEA,IAAI,CAACL,OAAO,CAAC,WAAW,CAAC;EAC7B;AACJ,CAAC,EAAE3B,EAAE,CAACmC,uBAAuB,CAAC,CAAC"}