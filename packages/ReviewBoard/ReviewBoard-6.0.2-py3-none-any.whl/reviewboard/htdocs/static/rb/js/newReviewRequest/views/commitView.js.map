{"version":3,"file":"commitView.js","names":["RB","CommitView","Backbone","View","extend","className","template","_","_dialogBodyTemplate","events","render","model","get","$el","addClass","commitID","length","slice","date","html","defaults","revision","author","toISOString","attributes","$","timesince","_onClick","dialogView","DialogView","title","body","prefixText","summary","suffixText","buttons","id","label","primary","onClick","_createReviewRequest","bind","show","url","navigateTo","trigger","showProgress","cancelProgress","hide","strings","COMMIT_NOT_ACCESSIBLE"],"sources":["../../../../../../static/rb/js/newReviewRequest/views/commitView.es6.js"],"sourcesContent":["/**\n * A view for a committed revision.\n *\n * This is used specifically for new review request creation. A click on the\n * element will either navigate the page to the review request (if one exists),\n * or emit a 'create' event.\n */\nRB.CommitView = Backbone.View.extend({\n    className: 'commit',\n\n    /**\n     * Template for the main view.\n     */\n    template: _.template(dedent`\n        <div class=\"progress\">\n         <span class=\"djblets-o-spinner\"></span>\n        </div>\n        <% if (accessible) { %>\n         <div class=\"summary\">\n          <% if (reviewRequestURL) { %>\n           <span class=\"fa fa-arrow-circle-right jump-to-commit\"></span>\n          <% } %>\n          <%- summary %>\n         </div>\n        <% } %>\n        <div class=\"commit-info\">\n         <span class=\"revision\">\n          <span class=\"fa fa-code-fork\"></span>\n          <%- revision %>\n          <% if (!accessible) { %>\n           <%- RB.CommitView.strings.COMMIT_NOT_ACCESSIBLE %>\n          <% } %>\n         </span>\n         <% if (accessible && author) { %>\n          <span class=\"author\">\n           <span class=\"fa fa-user\"></span>\n           <%- author %>\n          </span>\n         <% } %>\n         <% if (date) { %>\n          <span class=\"time\">\n           <span class=\"fa fa-clock-o\"></span>\n           <time class=\"timesince\" datetime=\"<%- date %>\"></time>\n          </span>\n         <% } %>\n        </div>\n    `),\n\n    /**\n     * Template for the body content of the confirmation dialog.\n     */\n    _dialogBodyTemplate: _.template(dedent`\n        <p><%- prefixText %></p>\n        <p><code><%- commitID %>: <%- summary %></code></p>\n        <p><%- suffixText %></p>\n    `),\n\n    events: {\n        'click': '_onClick',\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.CommitView:\n     *     This object, for chaining.\n     */\n    render: function() {\n        if (!this.model.get('accessible')) {\n            this.$el.addClass('disabled');\n        }\n\n        let commitID = this.model.get('id');\n\n        if (commitID.length === 40) {\n            commitID = commitID.slice(0, 7);\n        }\n\n        if (this.model.get('reviewRequestURL')) {\n            this.$el.addClass('has-review-request');\n        }\n\n        const date = this.model.get('date');\n\n        this.$el.html(this.template(_.defaults({\n            revision: commitID,\n            author: this.model.get('authorName') || gettext('<unknown>'),\n            date: date ? date.toISOString() : null,\n        }, this.model.attributes)));\n\n        if (date) {\n            this.$('.timesince').timesince();\n        }\n\n        return this;\n    },\n\n    /**\n     * Handler for when the commit is clicked.\n     *\n     * Shows a confirmation dialog allowing the user to proceed or cancel.\n     */\n    _onClick() {\n        let commitID = this.model.get('id');\n\n        if (commitID.length > 7) {\n            commitID = commitID.slice(0, 7);\n        }\n\n        const dialogView = new RB.DialogView({\n            title: gettext('Create Review Request?'),\n            body: this._dialogBodyTemplate({\n                prefixText: gettext('You are creating a new review request from the following published commit:'),\n                commitID: commitID,\n                summary: this.model.get('summary'),\n                suffixText: gettext('Are you sure you want to continue?'),\n            }),\n            buttons: [\n                {\n                    id: 'cancel',\n                    label: gettext('Cancel'),\n                },\n                {\n                    id: 'create',\n                    label: gettext('Create Review Request'),\n                    primary: true,\n                    onClick: this._createReviewRequest.bind(this),\n                }\n            ]\n        });\n\n        dialogView.show();\n    },\n\n    /**\n     * Create a new review request for the selected commit.\n     *\n     * If a review request already exists for this commit, redirect the browser\n     * to it. If not, trigger the 'create' event.\n     */\n    _createReviewRequest() {\n        if (this.model.get('accessible')) {\n            const url = this.model.get('reviewRequestURL');\n\n            if (url) {\n                RB.navigateTo(url);\n            } else {\n                this.model.trigger('create', this.model);\n            }\n        }\n    },\n\n    /**\n     * Toggle a progress indicator on for this commit.\n     */\n    showProgress() {\n        this.$('.progress').show();\n    },\n\n    /**\n     * Toggle a progress indicator off for this commit.\n     */\n    cancelProgress() {\n        this.$('.progress').hide();\n    },\n}, {\n    strings: {\n        COMMIT_NOT_ACCESSIBLE: gettext('(not accessible on this repository)'),\n    },\n});\n"],"mappings":"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"}