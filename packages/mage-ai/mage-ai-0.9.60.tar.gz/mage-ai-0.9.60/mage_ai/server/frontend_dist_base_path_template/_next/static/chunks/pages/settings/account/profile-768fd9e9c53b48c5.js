(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6308],{14875:function(e,r,n){"use strict";n.d(r,{Z3:function(){return o},ms:function(){return t},s7:function(){return i}});var o=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],i="password_current",t=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:i},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},36043:function(e,r,n){"use strict";var o=n(82394),i=n(21831),t=n(75582),s=n(21764),u=n(82684),l=n(69864),d=n(71180),a=n(31882),c=n(55485),p=n(85854),v=n(44085),f=n(38276),m=n(30160),w=n(17488),h=n(35686),b=n(98464),Z=n(82359),j=n(14875),_=n(86735),y=n(50178),O=n(42122),g=n(72619),x=n(28598);function C(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,o)}return n}function P(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?C(Object(n),!0).forEach((function(r){(0,o.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}r.Z=function(e){var r=e.disabledFields,n=e.hideFields,C=e.newUser,k=e.onDeleteSuccess,S=e.onSaveSuccess,E=e.showDelete,T=e.title,D=e.user,I=(0,u.useState)(!0),M=I[0],N=I[1],q=(0,u.useState)({}),A=q[0],U=q[1],F=(0,u.useState)(null),R=F[0],G=F[1],L=((0,y.PR)()||{}).owner,B=h.ZP.statuses.list().data,H=(0,u.useMemo)((function(){var e;return(null===B||void 0===B||null===(e=B.statuses)||void 0===e?void 0:e[0])||{}}),[B]),Q=H.project_type,W=H.project_uuid,X="global",z=null,J=null;Q===Z.k.SUB?(X="project",z=W):Q===Z.k.MAIN&&(J="The roles selected here will apply to this user globally.\n                If a user has both a global role and a workspace role,\n                then the role with higher access will take precedence.");var K=h.ZP.roles.list({entity:X,entity_ids:z?[z]:[],limit_roles:!!C},{revalidateOnFocus:!1}),V=K.data,Y=(K.mutate,(0,u.useMemo)((function(){return(null===V||void 0===V?void 0:V.roles)||[]}),[null===V||void 0===V?void 0:V.roles])),$=(0,l.Db)(C?h.ZP.users.useCreate():h.ZP.users.useUpdate(null===D||void 0===D?void 0:D.id),{onSuccess:function(e){return(0,g.wD)(e,{callback:function(e){var r=e.user,n=j.Z3.concat(j.ms).map((function(e){return e.uuid}));n.push("id");var o=(0,O.GL)(r,n);G(o),s.Am.success(C?"New user created successfully.":"User profile successfully updated.",{position:s.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(r.id)}),null===S||void 0===S||S(o)},onErrorCallback:function(e){var r=e.error,n=r.errors,o=r.exception,i=r.message,t=r.type;s.Am.error((null===n||void 0===n?void 0:n.error)||o||i,{position:s.Am.POSITION.BOTTOM_RIGHT,toastId:t})}})}}),ee=(0,t.Z)($,2),re=ee[0],ne=ee[1].isLoading,oe=(0,l.Db)(h.ZP.users.useDelete(null===D||void 0===D?void 0:D.id),{onSuccess:function(e){return(0,g.wD)(e,{callback:function(){null===k||void 0===k||k()},onErrorCallback:function(e){var r=e.error,n=r.errors,o=r.message;alert(o),console.log(n)}})}}),ie=(0,t.Z)(oe,2),te=ie[0],se=ie[1].isLoading,ue=n?(0,i.Z)(n):[];C&&ue.push(j.s7);var le=!ue||!ue.includes(j.s7),de=(0,b.Z)(D);(0,u.useEffect)((function(){if(D&&(!R||(null===de||void 0===de?void 0:de.id)!==(null===D||void 0===D?void 0:D.id))){var e=j.Z3.concat(j.ms).map((function(e){return e.uuid}));G((0,O.GL)(D,e))}null!==R&&void 0!==R&&R.password||null!==R&&void 0!==R&&R.password_confirmation?(null===R||void 0===R?void 0:R.password)!==(null===R||void 0===R?void 0:R.password_confirmation)?U({password_confirmation:"Password confirmation does not match."}):!le||null!==R&&void 0!==R&&R.password_current?U(null):U({password_current:"This field is required."}):null!==R&&void 0!==R&&R.password_current&&le?null!==R&&void 0!==R&&R.password&&null!==R&&void 0!==R&&R.password_confirmation?U(null):U({password:"This field is required.",password_confirmation:"This field is required."}):null!==R&&void 0!==R&&R.password_current||null!==R&&void 0!==R&&R.password||null!==R&&void 0!==R&&R.password_confirmation||U(null)}),[R,le,D,de]);var ae=(0,u.useState)(!1),ce=ae[0],pe=ae[1],ve=(0,u.useMemo)((function(){return(ce?null===R||void 0===R?void 0:R.roles_new:null===D||void 0===D?void 0:D.roles_new)||[]}),[R,ce,D]),fe=(0,u.useMemo)((function(){var e=(null===Y||void 0===Y?void 0:Y.map((function(e){return e.id})))||[];return null===ve||void 0===ve?void 0:ve.filter((function(r){var n=r.id;return e.includes(n)}))}),[ve,Y]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(p.Z,{children:T||"Edit profile"}),(0,x.jsxs)("form",{children:[j.Z3.filter((function(e){var r=e.uuid;return!ue||!ue.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,i=e.label,t=e.required,s=e.type,u=e.uuid;return(0,x.jsx)(f.Z,{mt:2,children:(0,x.jsx)(w.Z,{autoComplete:r,disabled:n&&!C,label:i,onChange:function(e){N(!1),G((function(r){return P(P({},r),{},(0,o.Z)({},u,e.target.value))}))},primary:!0,required:t,setContentOnMount:!0,type:s,value:(null===R||void 0===R?void 0:R[u])||""})},u)})),!(null!==D&&void 0!==D&&D.owner)&&!(null!==ue&&void 0!==ue&&ue.includes("roles"))&&(0,x.jsxs)(f.Z,{mt:2,children:[J&&(0,x.jsx)(f.Z,{mb:1,children:(0,x.jsx)(m.ZP,{children:J})}),(0,x.jsx)(v.Z,{disabled:null===r||void 0===r?void 0:r.includes("roles"),label:"Roles",onChange:function(e){var r=(0,_.sE)(Y,(function(r){return r.id==e.target.value}));r&&(N(!1),pe(!0),G((function(e){var n={};return(0,_.sE)(ve,(function(e){return e.id==(null===r||void 0===r?void 0:r.id)}))||(n={roles_new:[].concat((0,i.Z)(ve),[r])}),P(P({},e),n)})))},primary:!0,setContentOnMount:!0,children:Y.map((function(e){var r=e.id,n=e.name;return(0,x.jsx)("option",{value:r,children:n},n)}))}),(0,x.jsx)(f.Z,{mb:1}),(0,x.jsx)(c.ZP,{alignItems:"center",flexWrap:"wrap",children:null===fe||void 0===fe?void 0:fe.map((function(e){var n=e.id,o=e.name;return(0,x.jsx)(f.Z,{mb:1,mr:1,children:(0,x.jsx)(a.Z,{disabled:null===r||void 0===r?void 0:r.includes("roles"),label:o,onClick:function(){N(!1),pe(!0),G((function(e){return P(P({},e),{},{roles_new:(0,_.Od)(ve,(function(e){return e.id===n}))})}))},primary:!0})},"user_roles/".concat(o))}))})]}),(0,x.jsxs)(f.Z,{mt:5,children:[(0,x.jsx)(p.Z,{children:C?"Password":"Change password"}),j.ms.filter((function(e){var r=e.uuid;return!ue||!ue.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,i=e.label,t=e.required,s=e.type,u=e.uuid;return(0,x.jsx)(f.Z,{mt:2,children:(0,x.jsx)(w.Z,{autoComplete:r,disabled:n,label:i,meta:{error:null===A||void 0===A?void 0:A[u],touched:!(null===A||void 0===A||!A[u])},onChange:function(e){N(!1),G((function(r){return P(P({},r),{},(0,o.Z)({},u,e.target.value))}))},primary:!0,required:t,setContentOnMount:!0,type:s,value:(null===R||void 0===R?void 0:R[u])||""})},u)}))]}),(0,x.jsx)(f.Z,{mt:5,children:(0,x.jsxs)(c.ZP,{children:[(0,x.jsx)(d.ZP,{disabled:M||A&&!(0,O.Qr)(A),loading:ne,onClick:function(){var e,r=P({},R);"roles_new"in r&&(r.roles_new=null===(e=R.roles_new)||void 0===e?void 0:e.map((function(e){return e.id})));re({user:r})},primary:!0,children:C?"Create new user":"Update user profile"}),E&&L&&(0,x.jsx)(f.Z,{ml:1,children:(0,x.jsx)(d.ZP,{danger:!0,loading:se,onClick:function(){window.confirm("Are you sure you want to delete ".concat(R.username||R.email,"?"))&&te()},children:"Delete user"})})]})})]})]})}},86627:function(e,r,n){"use strict";n.r(r);var o=n(77837),i=n(38860),t=n.n(i),s=n(65956),u=n(93808),l=n(28274),d=n(38276),a=n(36043),c=n(35686),p=n(70515),v=n(24755),f=n(50178),m=n(28598);function w(){var e=((0,f.PR)()||{}).id,r=c.ZP.users.detail(e),n=r.data,o=r.mutate,i=null===n||void 0===n?void 0:n.user;return(0,m.jsx)(l.Z,{uuidItemSelected:v.DQ,uuidWorkspaceSelected:v.tC,children:(0,m.jsx)(d.Z,{p:p.cd,children:(0,m.jsx)(s.Z,{children:(0,m.jsx)(a.Z,{disabledFields:["roles"],onSaveSuccess:o,user:i})})})})}w.getInitialProps=(0,o.Z)(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)}))),r.default=(0,u.Z)(w)},10736:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/account/profile",function(){return n(86627)}])}},function(e){e.O(0,[1557,5699,9774,2888,179],(function(){return r=10736,e(e.s=r);var r}));var r=e.O();_N_E=r}]);